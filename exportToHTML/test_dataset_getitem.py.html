<html>
<head>
<title>test_dataset_getitem.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #a5c261;}
.s7 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_dataset_getitem.py</font>
</center></td></tr></table>
<pre><span class="s0"># This file is part of h5py, a Python interface to the HDF5 library.</span>
<span class="s0">#</span>
<span class="s0"># http://www.h5py.org</span>
<span class="s0">#</span>
<span class="s0"># Copyright 2008-2013 Andrew Collette and contributors</span>
<span class="s0">#</span>
<span class="s0"># License:  Standard 3-clause BSD; see &quot;license.txt&quot; for full license terms</span>
<span class="s0">#           and contributor agreement.</span>

<span class="s2">&quot;&quot;&quot; 
    Tests the h5py.Dataset.__getitem__ method. 
 
    This module does not specifically test type conversion.  The &quot;type&quot; axis 
    therefore only tests objects which interact with the slicing system in 
    unreliable ways; for example, compound and array types. 
 
    See test_dataset_getitem_types for type-conversion tests. 
 
    Tests are organized into TestCases by dataset shape and type.  Test 
    methods vary by slicing arg type. 
 
    1. Dataset shape: 
        Empty 
        Scalar 
        1D 
        3D 
 
    2. Type: 
        Float 
        Compound 
        Array 
 
    3. Slicing arg types: 
        Ellipsis 
        Empty tuple 
        Regular slice 
        MultiBlockSlice 
        Indexing 
        Index list 
        Boolean mask 
        Field names 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">sys</span>

<span class="s3">import </span><span class="s1">numpy </span><span class="s3">as </span><span class="s1">np</span>
<span class="s3">import </span><span class="s1">h5py</span>

<span class="s3">from </span><span class="s4">.</span><span class="s1">common </span><span class="s3">import </span><span class="s1">ut</span><span class="s4">, </span><span class="s1">TestCase</span>


<span class="s3">class </span><span class="s1">TestEmpty</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">sid </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5s</span><span class="s4">.</span><span class="s1">create</span><span class="s4">(</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5s</span><span class="s4">.</span><span class="s1">NULL</span><span class="s4">)</span>
        <span class="s1">tid </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5t</span><span class="s4">.</span><span class="s1">C_S1</span><span class="s4">.</span><span class="s1">copy</span><span class="s4">()</span>
        <span class="s1">tid</span><span class="s4">.</span><span class="s1">set_size</span><span class="s4">(</span><span class="s5">10</span><span class="s4">)</span>
        <span class="s1">dsid </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5d</span><span class="s4">.</span><span class="s1">create</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">id</span><span class="s4">, </span><span class="s6">b'x'</span><span class="s4">, </span><span class="s1">tid</span><span class="s4">, </span><span class="s1">sid</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">Dataset</span><span class="s4">(</span><span class="s1">dsid</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">empty_obj </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">Empty</span><span class="s4">(</span><span class="s1">np</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">(</span><span class="s7">&quot;S10&quot;</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, </span><span class="s3">None</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s3">None</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_nbytes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify nbytes &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">nbytes</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...], </span><span class="s1">self</span><span class="s4">.</span><span class="s1">empty_obj</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[()], </span><span class="s1">self</span><span class="s4">.</span><span class="s1">empty_obj</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; slice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_multi_block_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; MultiBlockSlice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">MultiBlockSlice</span><span class="s4">()]</span>

    <span class="s3">def </span><span class="s1">test_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index list -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">,</span><span class="s5">5</span><span class="s4">]]</span>

    <span class="s3">def </span><span class="s1">test_mask</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; mask -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s1">mask </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">(</span><span class="s3">True</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">mask</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'field'</span><span class="s4">]</span>


<span class="s3">class </span><span class="s1">TestScalarFloat</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">(</span><span class="s5">42.5</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s1">np</span><span class="s4">.</span><span class="s1">double</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify size &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_nbytes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify nbytes &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">nbytes</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">.</span><span class="s1">itemsize</span><span class="s4">)  </span><span class="s0"># not sure if 'f' is always alias for 'f4'</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, </span><span class="s1">tuple</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Ellipsis -&gt; scalar ndarray &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertArrayEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; () -&gt; bare item &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[()]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertArrayEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">item</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">test_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; slice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_multi_block_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; MultiBlockSlice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">MultiBlockSlice</span><span class="s4">()]</span>

    <span class="s3">def </span><span class="s1">test_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>

    <span class="s0"># FIXME: NumPy has IndexError instead</span>
    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index list -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">,</span><span class="s5">5</span><span class="s4">]]</span>

    <span class="s0"># FIXME: NumPy permits this</span>
    <span class="s3">def </span><span class="s1">test_mask</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; mask -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s1">mask </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">(</span><span class="s3">True</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">mask</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; ValueError (no fields) &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'field'</span><span class="s4">]</span>


<span class="s3">class </span><span class="s1">TestScalarCompound</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">((</span><span class="s5">42.5</span><span class="s4">, -</span><span class="s5">118</span><span class="s4">, </span><span class="s7">&quot;Hello&quot;</span><span class="s4">), </span><span class="s1">dtype</span><span class="s4">=[(</span><span class="s7">'a'</span><span class="s4">, </span><span class="s7">'f'</span><span class="s4">), (</span><span class="s7">'b'</span><span class="s4">, </span><span class="s7">'i'</span><span class="s4">), (</span><span class="s7">'c'</span><span class="s4">, </span><span class="s7">'|S10'</span><span class="s4">)])</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, </span><span class="s1">tuple</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify size &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_nbytes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify nbytes &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">nbytes</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">.</span><span class="s1">itemsize</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Ellipsis -&gt; scalar ndarray &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...]</span>
        <span class="s0"># assertArrayEqual doesn't work with compounds; do manually</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertIsInstance</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ndarray</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; () -&gt; np.void instance &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[()]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertIsInstance</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">void</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; slice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_multi_block_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; MultiBlockSlice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">MultiBlockSlice</span><span class="s4">()]</span>

    <span class="s3">def </span><span class="s1">test_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>

    <span class="s0"># FIXME: NumPy has IndexError instead</span>
    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index list -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">,</span><span class="s5">5</span><span class="s4">]]</span>

    <span class="s0"># FIXME: NumPy permits this</span>
    <span class="s3">def </span><span class="s1">test_mask</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; mask -&gt; ValueError  &quot;&quot;&quot;</span>
        <span class="s1">mask </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">(</span><span class="s3">True</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">mask</span><span class="s4">]</span>

    <span class="s0"># FIXME: NumPy returns a scalar ndarray</span>
    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; bare value &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'a'</span><span class="s4">]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertIsInstance</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">float32</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'a'</span><span class="s4">])</span>


<span class="s3">class </span><span class="s1">TestScalarArray</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dt </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">(</span><span class="s7">'(3,2)f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">([(</span><span class="s5">3.2</span><span class="s4">, -</span><span class="s5">119</span><span class="s4">), (</span><span class="s5">42</span><span class="s4">, </span><span class="s5">99.8</span><span class="s4">), (</span><span class="s5">3.14</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)], </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, (), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dt</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...] = </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">2</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">0</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify size &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_nbytes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify nbytes &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">nbytes</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">.</span><span class="s1">itemsize</span><span class="s4">)  </span><span class="s0"># not sure if 'f' is always alias for 'f4'</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, (</span><span class="s5">3</span><span class="s4">, </span><span class="s5">2</span><span class="s4">))</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, </span><span class="s1">tuple</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Ellipsis -&gt; ndarray promoted to underlying shape &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertArrayEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; () -&gt; same as ellipsis &quot;&quot;&quot;</span>
        <span class="s1">out </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[...]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertArrayEqual</span><span class="s4">(</span><span class="s1">out</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; slice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_multi_block_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; MultiBlockSlice -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">MultiBlockSlice</span><span class="s4">()]</span>

    <span class="s3">def </span><span class="s1">test_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index list -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[]]</span>

    <span class="s3">def </span><span class="s1">test_mask</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; mask -&gt; ValueError &quot;&quot;&quot;</span>
        <span class="s1">mask </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">(</span><span class="s3">True</span><span class="s4">, </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">mask</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; ValueError (no fields) &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'field'</span><span class="s4">]</span>


<span class="s3">class </span><span class="s1">Test1DZeroFloat</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">((</span><span class="s5">0</span><span class="s4">,), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, (</span><span class="s5">0</span><span class="s4">,))</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Ellipsis -&gt; ndarray of matching shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[...])</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; () -&gt; same as ellipsis &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[()])</span>

    <span class="s3">def </span><span class="s1">test_slice</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; slice -&gt; ndarray of shape (0,) &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_stop_less_than_start</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">7</span><span class="s4">:</span><span class="s5">5</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_index</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index -&gt; out of range &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">IndexError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; index list &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[]])</span>

    <span class="s3">def </span><span class="s1">test_mask</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; mask -&gt; ndarray of matching shape &quot;&quot;&quot;</span>
        <span class="s1">mask </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">((</span><span class="s5">0</span><span class="s4">,), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">,</span>
            <span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">mask</span><span class="s4">],</span>
            <span class="s0"># Fast reader doesn't work with boolean masks</span>
            <span class="s1">skip_fast_reader</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; ValueError (no fields) &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'field'</span><span class="s4">]</span>


<span class="s3">class </span><span class="s1">Test1DFloat</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">13</span><span class="s4">).</span><span class="s1">astype</span><span class="s4">(</span><span class="s7">'f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">1</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, (</span><span class="s5">13</span><span class="s4">,))</span>

    <span class="s3">def </span><span class="s1">test_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[...])</span>

    <span class="s3">def </span><span class="s1">test_tuple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[()])</span>

    <span class="s3">def </span><span class="s1">test_slice_simple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">0</span><span class="s4">:</span><span class="s5">4</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_zerosize</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">4</span><span class="s4">:</span><span class="s5">4</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_strides</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">1</span><span class="s4">:</span><span class="s5">7</span><span class="s4">:</span><span class="s5">3</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_negindexes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[-</span><span class="s5">8</span><span class="s4">:-</span><span class="s5">2</span><span class="s4">:</span><span class="s5">3</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_stop_less_than_start</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">7</span><span class="s4">:</span><span class="s5">5</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_outofrange</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">100</span><span class="s4">:</span><span class="s5">400</span><span class="s4">:</span><span class="s5">3</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_slice_backwards</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; we disallow negative steps &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[::-</span><span class="s5">1</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_slice_zerostride</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[::</span><span class="s5">0</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_index_simple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s5">3</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_index_neg</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[-</span><span class="s5">4</span><span class="s4">])</span>

    <span class="s0"># FIXME: NumPy permits this... it adds a new axis in front</span>
    <span class="s3">def </span><span class="s1">test_index_none</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s3">None</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_index_illegal</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Illegal slicing argument &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[{}]</span>

    <span class="s3">def </span><span class="s1">test_index_outofrange</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">IndexError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s5">100</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_indexlist_simple</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">,</span><span class="s5">5</span><span class="s4">]])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_numpyarray</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">([</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">5</span><span class="s4">])])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_single_index_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[</span><span class="s5">0</span><span class="s4">], ...])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_numpyarray_single_index_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">([</span><span class="s5">0</span><span class="s4">]), ...])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_numpyarray_ellipsis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">np</span><span class="s4">.</span><span class="s1">array</span><span class="s4">([</span><span class="s5">1</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, </span><span class="s5">5</span><span class="s4">]), ...])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_empty</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[]])</span>

    <span class="s3">def </span><span class="s1">test_indexlist_outofrange</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">IndexError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">100</span><span class="s4">]]</span>

    <span class="s3">def </span><span class="s1">test_indexlist_nonmonotonic</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; we require index list values to be strictly increasing &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">3</span><span class="s4">,</span><span class="s5">2</span><span class="s4">]]</span>

    <span class="s3">def </span><span class="s1">test_indexlist_monotonic_negative</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># This should work: indices are logically increasing</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">,  </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[</span><span class="s5">0</span><span class="s4">, </span><span class="s5">2</span><span class="s4">, -</span><span class="s5">2</span><span class="s4">]])</span>

        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[-</span><span class="s5">2</span><span class="s4">, -</span><span class="s5">3</span><span class="s4">]]</span>

    <span class="s3">def </span><span class="s1">test_indexlist_repeated</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; we forbid repeated index values &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[[</span><span class="s5">1</span><span class="s4">,</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">]]</span>

    <span class="s3">def </span><span class="s1">test_mask_true</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">,</span>
            <span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">&gt; -</span><span class="s5">100</span><span class="s4">],</span>
            <span class="s0"># Fast reader doesn't work with boolean masks</span>
            <span class="s1">skip_fast_reader</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_mask_false</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">,</span>
            <span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">&gt; </span><span class="s5">100</span><span class="s4">],</span>
            <span class="s0"># Fast reader doesn't work with boolean masks</span>
            <span class="s1">skip_fast_reader</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_mask_partial</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">,</span>
            <span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">&gt; </span><span class="s5">5</span><span class="s4">],</span>
            <span class="s0"># Fast reader doesn't work with boolean masks</span>
            <span class="s1">skip_fast_reader</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_mask_wrongsize</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; we require the boolean mask shape to match exactly &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">((</span><span class="s5">2</span><span class="s4">,), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'bool'</span><span class="s4">)]</span>

    <span class="s3">def </span><span class="s1">test_fieldnames</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; field name -&gt; ValueError (no fields) &quot;&quot;&quot;</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">ValueError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s7">'field'</span><span class="s4">]</span>


<span class="s3">class </span><span class="s1">Test2DZeroFloat</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">((</span><span class="s5">0</span><span class="s4">,</span><span class="s5">3</span><span class="s4">), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">2</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, (</span><span class="s5">0</span><span class="s4">, </span><span class="s5">3</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; see issue #473 &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[:,[</span><span class="s5">0</span><span class="s4">,</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">]])</span>


<span class="s3">class </span><span class="s1">Test2DFloat</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">data </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">ones</span><span class="s4">((</span><span class="s5">5</span><span class="s4">,</span><span class="s5">3</span><span class="s4">), </span><span class="s1">dtype</span><span class="s4">=</span><span class="s7">'f'</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_ndim</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify number of dimensions &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">ndim</span><span class="s4">, </span><span class="s5">2</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify size &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s5">15</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_nbytes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify nbytes &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">nbytes</span><span class="s4">, </span><span class="s5">15</span><span class="s4">*</span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">.</span><span class="s1">dtype</span><span class="s4">.</span><span class="s1">itemsize</span><span class="s4">)  </span><span class="s0"># not sure if 'f' is always alias for 'f4'</span>

    <span class="s3">def </span><span class="s1">test_shape</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; Verify shape &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">shape</span><span class="s4">, (</span><span class="s5">5</span><span class="s4">, </span><span class="s5">3</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">test_indexlist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot; see issue #473 &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[:,[</span><span class="s5">0</span><span class="s4">,</span><span class="s5">1</span><span class="s4">,</span><span class="s5">2</span><span class="s4">]])</span>

    <span class="s3">def </span><span class="s1">test_index_emptylist</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[:, []])</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">data</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[]])</span>


<span class="s3">class </span><span class="s1">TestVeryLargeArray</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">TestCase</span><span class="s4">.</span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">shape</span><span class="s4">=(</span><span class="s5">2</span><span class="s4">**</span><span class="s5">15</span><span class="s4">, </span><span class="s5">2</span><span class="s4">**</span><span class="s5">16</span><span class="s4">))</span>

    <span class="s4">@</span><span class="s1">ut</span><span class="s4">.</span><span class="s1">skipIf</span><span class="s4">(</span><span class="s1">sys</span><span class="s4">.</span><span class="s1">maxsize </span><span class="s4">&lt; </span><span class="s5">2</span><span class="s4">**</span><span class="s5">31</span><span class="s4">, </span><span class="s7">'Maximum integer size &gt;= 2**31 required'</span><span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertEqual</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">.</span><span class="s1">size</span><span class="s4">, </span><span class="s5">2</span><span class="s4">**</span><span class="s5">31</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">test_read_no_fill_value</span><span class="s4">(</span><span class="s1">writable_file</span><span class="s4">):</span>
    <span class="s0"># With FILL_TIME_NEVER, HDF5 doesn't write zeros in the output array for</span>
    <span class="s0"># unallocated chunks. If we read into uninitialized memory, it can appear</span>
    <span class="s0"># to read random values. https://github.com/h5py/h5py/issues/2069</span>
    <span class="s1">dcpl </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5p</span><span class="s4">.</span><span class="s1">create</span><span class="s4">(</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5p</span><span class="s4">.</span><span class="s1">DATASET_CREATE</span><span class="s4">)</span>
    <span class="s1">dcpl</span><span class="s4">.</span><span class="s1">set_chunk</span><span class="s4">((</span><span class="s5">1</span><span class="s4">,))</span>
    <span class="s1">dcpl</span><span class="s4">.</span><span class="s1">set_fill_time</span><span class="s4">(</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5d</span><span class="s4">.</span><span class="s1">FILL_TIME_NEVER</span><span class="s4">)</span>
    <span class="s1">ds </span><span class="s4">= </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">Dataset</span><span class="s4">(</span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5d</span><span class="s4">.</span><span class="s1">create</span><span class="s4">(</span>
        <span class="s1">writable_file</span><span class="s4">.</span><span class="s1">id</span><span class="s4">, </span><span class="s6">b'a'</span><span class="s4">, </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5t</span><span class="s4">.</span><span class="s1">IEEE_F64LE</span><span class="s4">, </span><span class="s1">h5py</span><span class="s4">.</span><span class="s1">h5s</span><span class="s4">.</span><span class="s1">create_simple</span><span class="s4">((</span><span class="s5">5</span><span class="s4">,)), </span><span class="s1">dcpl</span>
    <span class="s4">))</span>
    <span class="s1">np</span><span class="s4">.</span><span class="s1">testing</span><span class="s4">.</span><span class="s1">assert_array_equal</span><span class="s4">(</span><span class="s1">ds</span><span class="s4">[:</span><span class="s5">3</span><span class="s4">], </span><span class="s1">np</span><span class="s4">.</span><span class="s1">zeros</span><span class="s4">(</span><span class="s5">3</span><span class="s4">, </span><span class="s1">np</span><span class="s4">.</span><span class="s1">float64</span><span class="s4">))</span>


<span class="s3">class </span><span class="s1">TestBoolIndex</span><span class="s4">(</span><span class="s1">TestCase</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot; 
    Tests for indexing with Boolean arrays 
    &quot;&quot;&quot;</span>
    <span class="s3">def </span><span class="s1">setUp</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">super</span><span class="s4">().</span><span class="s1">setUp</span><span class="s4">()</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">arr </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">arange</span><span class="s4">(</span><span class="s5">9</span><span class="s4">).</span><span class="s1">reshape</span><span class="s4">(</span><span class="s5">3</span><span class="s4">,-</span><span class="s5">1</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">dset </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">f</span><span class="s4">.</span><span class="s1">create_dataset</span><span class="s4">(</span><span class="s7">'x'</span><span class="s4">, </span><span class="s1">data</span><span class="s4">=</span><span class="s1">self</span><span class="s4">.</span><span class="s1">arr</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_select_first_axis</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">sel </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[</span><span class="s3">False</span><span class="s4">, </span><span class="s3">True</span><span class="s4">, </span><span class="s3">False</span><span class="s4">],:]</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">assertNumpyBehavior</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">, </span><span class="s1">self</span><span class="s4">.</span><span class="s1">arr</span><span class="s4">, </span><span class="s1">sel</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_wrong_size</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">sel </span><span class="s4">= </span><span class="s1">np</span><span class="s4">.</span><span class="s1">s_</span><span class="s4">[[</span><span class="s3">False</span><span class="s4">, </span><span class="s3">True</span><span class="s4">, </span><span class="s3">False</span><span class="s4">, </span><span class="s3">False</span><span class="s4">],:]</span>
        <span class="s3">with </span><span class="s1">self</span><span class="s4">.</span><span class="s1">assertRaises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">dset</span><span class="s4">[</span><span class="s1">sel</span><span class="s4">]</span>
</pre>
</body>
</html>