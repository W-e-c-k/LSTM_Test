<html>
<head>
<title>image_utils.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
image_utils.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Utilities related to image handling.&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">io</span>
<span class="s2">import </span><span class="s1">pathlib</span>
<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>

<span class="s2">from </span><span class="s1">keras</span><span class="s3">.</span><span class="s1">src </span><span class="s2">import </span><span class="s1">backend</span>
<span class="s2">from </span><span class="s1">keras</span><span class="s3">.</span><span class="s1">src</span><span class="s3">.</span><span class="s1">api_export </span><span class="s2">import </span><span class="s1">keras_export</span>

<span class="s2">try</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">PIL </span><span class="s2">import </span><span class="s1">Image </span><span class="s2">as </span><span class="s1">pil_image</span>

    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">pil_image_resampling </span><span class="s3">= </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">Resampling</span>
    <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
        <span class="s1">pil_image_resampling </span><span class="s3">= </span><span class="s1">pil_image</span>
<span class="s2">except </span><span class="s1">ImportError</span><span class="s3">:</span>
    <span class="s1">pil_image </span><span class="s3">= </span><span class="s2">None</span>
    <span class="s1">pil_image_resampling </span><span class="s3">= </span><span class="s2">None</span>


<span class="s2">if </span><span class="s1">pil_image_resampling </span><span class="s2">is not None</span><span class="s3">:</span>
    <span class="s1">PIL_INTERPOLATION_METHODS </span><span class="s3">= {</span>
        <span class="s4">&quot;nearest&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">NEAREST</span><span class="s3">,</span>
        <span class="s4">&quot;bilinear&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">BILINEAR</span><span class="s3">,</span>
        <span class="s4">&quot;bicubic&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">BICUBIC</span><span class="s3">,</span>
        <span class="s4">&quot;hamming&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">HAMMING</span><span class="s3">,</span>
        <span class="s4">&quot;box&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">BOX</span><span class="s3">,</span>
        <span class="s4">&quot;lanczos&quot;</span><span class="s3">: </span><span class="s1">pil_image_resampling</span><span class="s3">.</span><span class="s1">LANCZOS</span><span class="s3">,</span>
    <span class="s3">}</span>


<span class="s3">@</span><span class="s1">keras_export</span><span class="s3">(</span>
    <span class="s3">[</span>
        <span class="s4">&quot;keras.utils.array_to_img&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;keras.preprocessing.image.array_to_img&quot;</span><span class="s3">,</span>
    <span class="s3">]</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">array_to_img</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">data_format</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">scale</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Converts a 3D NumPy array to a PIL Image instance. 
 
    Example: 
 
    ```python 
    from PIL import Image 
    img = np.random.random(size=(100, 100, 3)) 
    pil_img = keras.utils.array_to_img(img) 
    ``` 
 
    Args: 
        x: Input data, in any form that can be converted to a NumPy array. 
        data_format: Image data format, can be either `&quot;channels_first&quot;` or 
            `&quot;channels_last&quot;`. Defaults to `None`, in which case the global 
            setting `keras.backend.image_data_format()` is used (unless you 
            changed it, it defaults to `&quot;channels_last&quot;`). 
        scale: Whether to rescale the image such that minimum and maximum values 
            are 0 and 255 respectively. Defaults to `True`. 
        dtype: Dtype to use. `None` means the global setting 
            `keras.backend.floatx()` is used (unless you changed it, it 
            defaults to `&quot;float32&quot;`). Defaults to `None`. 
 
    Returns: 
        A PIL Image instance. 
    &quot;&quot;&quot;</span>

    <span class="s1">data_format </span><span class="s3">= </span><span class="s1">backend</span><span class="s3">.</span><span class="s1">standardize_data_format</span><span class="s3">(</span><span class="s1">data_format</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">dtype </span><span class="s3">= </span><span class="s1">backend</span><span class="s3">.</span><span class="s1">floatx</span><span class="s3">()</span>
    <span class="s2">if </span><span class="s1">pil_image </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ImportError</span><span class="s3">(</span>
            <span class="s4">&quot;Could not import PIL.Image. &quot;</span>
            <span class="s4">&quot;The use of `array_to_img` requires PIL.&quot;</span>
        <span class="s3">)</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">x</span><span class="s3">.</span><span class="s1">ndim </span><span class="s3">!= </span><span class="s5">3</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
            <span class="s4">&quot;Expected image array to have rank 3 (single image). &quot;</span>
            <span class="s4">f&quot;Got array with shape: </span><span class="s2">{</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s3">)</span>

    <span class="s6"># Original NumPy array x has format (height, width, channel)</span>
    <span class="s6"># or (channel, height, width)</span>
    <span class="s6"># but target PIL image has format (width, height, channel)</span>
    <span class="s2">if </span><span class="s1">data_format </span><span class="s3">== </span><span class="s4">&quot;channels_first&quot;</span><span class="s3">:</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">transpose</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s3">, </span><span class="s5">0</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">scale</span><span class="s3">:</span>
        <span class="s1">x </span><span class="s3">= </span><span class="s1">x </span><span class="s3">- </span><span class="s1">np</span><span class="s3">.</span><span class="s1">min</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s1">x_max </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">x_max </span><span class="s3">!= </span><span class="s5">0</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">/= </span><span class="s1">x_max</span>
        <span class="s1">x </span><span class="s3">*= </span><span class="s5">255</span>
    <span class="s2">if </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] == </span><span class="s5">4</span><span class="s3">:</span>
        <span class="s6"># RGBA</span>
        <span class="s2">return </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">fromarray</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;uint8&quot;</span><span class="s3">), </span><span class="s4">&quot;RGBA&quot;</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] == </span><span class="s5">3</span><span class="s3">:</span>
        <span class="s6"># RGB</span>
        <span class="s2">return </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">fromarray</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;uint8&quot;</span><span class="s3">), </span><span class="s4">&quot;RGB&quot;</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] == </span><span class="s5">1</span><span class="s3">:</span>
        <span class="s6"># grayscale</span>
        <span class="s2">if </span><span class="s1">np</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) &gt; </span><span class="s5">255</span><span class="s3">:</span>
            <span class="s6"># 32-bit signed integer grayscale image. PIL mode &quot;I&quot;</span>
            <span class="s2">return </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">fromarray</span><span class="s3">(</span><span class="s1">x</span><span class="s3">[:, :, </span><span class="s5">0</span><span class="s3">].</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;int32&quot;</span><span class="s3">), </span><span class="s4">&quot;I&quot;</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">fromarray</span><span class="s3">(</span><span class="s1">x</span><span class="s3">[:, :, </span><span class="s5">0</span><span class="s3">].</span><span class="s1">astype</span><span class="s3">(</span><span class="s4">&quot;uint8&quot;</span><span class="s3">), </span><span class="s4">&quot;L&quot;</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">f&quot;Unsupported channel number: </span><span class="s2">{</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">2</span><span class="s3">]</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">keras_export</span><span class="s3">(</span>
    <span class="s3">[</span>
        <span class="s4">&quot;keras.utils.img_to_array&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;keras.preprocessing.image.img_to_array&quot;</span><span class="s3">,</span>
    <span class="s3">]</span>
<span class="s3">)</span>
<span class="s2">def </span><span class="s1">img_to_array</span><span class="s3">(</span><span class="s1">img</span><span class="s3">, </span><span class="s1">data_format</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s2">None</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Converts a PIL Image instance to a NumPy array. 
 
    Example: 
 
    ```python 
    from PIL import Image 
    img_data = np.random.random(size=(100, 100, 3)) 
    img = keras.utils.array_to_img(img_data) 
    array = keras.utils.image.img_to_array(img) 
    ``` 
 
    Args: 
        img: Input PIL Image instance. 
        data_format: Image data format, can be either `&quot;channels_first&quot;` or 
            `&quot;channels_last&quot;`. Defaults to `None`, in which case the global 
            setting `keras.backend.image_data_format()` is used (unless you 
            changed it, it defaults to `&quot;channels_last&quot;`). 
        dtype: Dtype to use. `None` means the global setting 
            `keras.backend.floatx()` is used (unless you changed it, it 
            defaults to `&quot;float32&quot;`). 
 
    Returns: 
        A 3D NumPy array. 
    &quot;&quot;&quot;</span>

    <span class="s1">data_format </span><span class="s3">= </span><span class="s1">backend</span><span class="s3">.</span><span class="s1">standardize_data_format</span><span class="s3">(</span><span class="s1">data_format</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">dtype </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s1">dtype </span><span class="s3">= </span><span class="s1">backend</span><span class="s3">.</span><span class="s1">floatx</span><span class="s3">()</span>
    <span class="s6"># NumPy array x has format (height, width, channel)</span>
    <span class="s6"># or (channel, height, width)</span>
    <span class="s6"># but original PIL image has format (width, height, channel)</span>
    <span class="s1">x </span><span class="s3">= </span><span class="s1">np</span><span class="s3">.</span><span class="s1">asarray</span><span class="s3">(</span><span class="s1">img</span><span class="s3">, </span><span class="s1">dtype</span><span class="s3">=</span><span class="s1">dtype</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) == </span><span class="s5">3</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">data_format </span><span class="s3">== </span><span class="s4">&quot;channels_first&quot;</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">transpose</span><span class="s3">(</span><span class="s5">2</span><span class="s3">, </span><span class="s5">0</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">len</span><span class="s3">(</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) == </span><span class="s5">2</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">data_format </span><span class="s3">== </span><span class="s4">&quot;channels_first&quot;</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">reshape</span><span class="s3">((</span><span class="s5">1</span><span class="s3">, </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">1</span><span class="s3">]))</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">x </span><span class="s3">= </span><span class="s1">x</span><span class="s3">.</span><span class="s1">reshape</span><span class="s3">((</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">[</span><span class="s5">1</span><span class="s3">], </span><span class="s5">1</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">f&quot;Unsupported image shape: </span><span class="s2">{</span><span class="s1">x</span><span class="s3">.</span><span class="s1">shape</span><span class="s2">}</span><span class="s4">&quot;</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">x</span>


<span class="s3">@</span><span class="s1">keras_export</span><span class="s3">([</span><span class="s4">&quot;keras.utils.save_img&quot;</span><span class="s3">, </span><span class="s4">&quot;keras.preprocessing.image.save_img&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">save_img</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">x</span><span class="s3">, </span><span class="s1">data_format</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">file_format</span><span class="s3">=</span><span class="s2">None</span><span class="s3">, </span><span class="s1">scale</span><span class="s3">=</span><span class="s2">True</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Saves an image stored as a NumPy array to a path or file object. 
 
    Args: 
        path: Path or file object. 
        x: NumPy array. 
        data_format: Image data format, either `&quot;channels_first&quot;` or 
            `&quot;channels_last&quot;`. 
        file_format: Optional file format override. If omitted, the format to 
            use is determined from the filename extension. If a file object was 
            used instead of a filename, this parameter should always be used. 
        scale: Whether to rescale image values to be within `[0, 255]`. 
        **kwargs: Additional keyword arguments passed to `PIL.Image.save()`. 
    &quot;&quot;&quot;</span>
    <span class="s1">data_format </span><span class="s3">= </span><span class="s1">backend</span><span class="s3">.</span><span class="s1">standardize_data_format</span><span class="s3">(</span><span class="s1">data_format</span><span class="s3">)</span>
    <span class="s1">img </span><span class="s3">= </span><span class="s1">array_to_img</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">data_format</span><span class="s3">=</span><span class="s1">data_format</span><span class="s3">, </span><span class="s1">scale</span><span class="s3">=</span><span class="s1">scale</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">img</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">== </span><span class="s4">&quot;RGBA&quot; </span><span class="s2">and </span><span class="s3">(</span><span class="s1">file_format </span><span class="s3">== </span><span class="s4">&quot;jpg&quot; </span><span class="s2">or </span><span class="s1">file_format </span><span class="s3">== </span><span class="s4">&quot;jpeg&quot;</span><span class="s3">):</span>
        <span class="s1">warnings</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
            <span class="s4">&quot;The JPG format does not support RGBA images, converting to RGB.&quot;</span>
        <span class="s3">)</span>
        <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">convert</span><span class="s3">(</span><span class="s4">&quot;RGB&quot;</span><span class="s3">)</span>
    <span class="s1">img</span><span class="s3">.</span><span class="s1">save</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">format</span><span class="s3">=</span><span class="s1">file_format</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">)</span>


<span class="s3">@</span><span class="s1">keras_export</span><span class="s3">([</span><span class="s4">&quot;keras.utils.load_img&quot;</span><span class="s3">, </span><span class="s4">&quot;keras.preprocessing.image.load_img&quot;</span><span class="s3">])</span>
<span class="s2">def </span><span class="s1">load_img</span><span class="s3">(</span>
    <span class="s1">path</span><span class="s3">,</span>
    <span class="s1">color_mode</span><span class="s3">=</span><span class="s4">&quot;rgb&quot;</span><span class="s3">,</span>
    <span class="s1">target_size</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">interpolation</span><span class="s3">=</span><span class="s4">&quot;nearest&quot;</span><span class="s3">,</span>
    <span class="s1">keep_aspect_ratio</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
<span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Loads an image into PIL format. 
 
    Example: 
 
    ```python 
    image = keras.utils.load_img(image_path) 
    input_arr = keras.utils.img_to_array(image) 
    input_arr = np.array([input_arr])  # Convert single image to a batch. 
    predictions = model.predict(input_arr) 
    ``` 
 
    Args: 
        path: Path to image file. 
        color_mode: One of `&quot;grayscale&quot;`, `&quot;rgb&quot;`, `&quot;rgba&quot;`. Default: `&quot;rgb&quot;`. 
            The desired image format. 
        target_size: Either `None` (default to original size) or tuple of ints 
            `(img_height, img_width)`. 
        interpolation: Interpolation method used to resample the image if the 
            target size is different from that of the loaded image. Supported 
            methods are `&quot;nearest&quot;`, `&quot;bilinear&quot;`, and `&quot;bicubic&quot;`. 
            If PIL version 1.1.3 or newer is installed, `&quot;lanczos&quot;` 
            is also supported. If PIL version 3.4.0 or newer is installed, 
            `&quot;box&quot;` and `&quot;hamming&quot;` are also 
            supported. By default, `&quot;nearest&quot;` is used. 
        keep_aspect_ratio: Boolean, whether to resize images to a target 
            size without aspect ratio distortion. The image is cropped in 
            the center with target aspect ratio before resizing. 
 
    Returns: 
        A PIL Image instance. 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">pil_image </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ImportError</span><span class="s3">(</span>
            <span class="s4">&quot;Could not import PIL.Image. The use of `load_img` requires PIL.&quot;</span>
        <span class="s3">)</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">io</span><span class="s3">.</span><span class="s1">BytesIO</span><span class="s3">):</span>
        <span class="s1">img </span><span class="s3">= </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">open</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, (</span><span class="s1">pathlib</span><span class="s3">.</span><span class="s1">Path</span><span class="s3">, </span><span class="s1">bytes</span><span class="s3">, </span><span class="s1">str</span><span class="s3">)):</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s1">pathlib</span><span class="s3">.</span><span class="s1">Path</span><span class="s3">):</span>
            <span class="s1">path </span><span class="s3">= </span><span class="s1">str</span><span class="s3">(</span><span class="s1">path</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">())</span>
        <span class="s2">with </span><span class="s1">open</span><span class="s3">(</span><span class="s1">path</span><span class="s3">, </span><span class="s4">&quot;rb&quot;</span><span class="s3">) </span><span class="s2">as </span><span class="s1">f</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">pil_image</span><span class="s3">.</span><span class="s1">open</span><span class="s3">(</span><span class="s1">io</span><span class="s3">.</span><span class="s1">BytesIO</span><span class="s3">(</span><span class="s1">f</span><span class="s3">.</span><span class="s1">read</span><span class="s3">()))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span>
            <span class="s4">f&quot;path should be path-like or io.BytesIO, not </span><span class="s2">{</span><span class="s1">type</span><span class="s3">(</span><span class="s1">path</span><span class="s3">)</span><span class="s2">}</span><span class="s4">&quot;</span>
        <span class="s3">)</span>

    <span class="s2">if </span><span class="s1">color_mode </span><span class="s3">== </span><span class="s4">&quot;grayscale&quot;</span><span class="s3">:</span>
        <span class="s6"># if image is not already an 8-bit, 16-bit or 32-bit grayscale image</span>
        <span class="s6"># convert it to an 8-bit grayscale image.</span>
        <span class="s2">if </span><span class="s1">img</span><span class="s3">.</span><span class="s1">mode </span><span class="s2">not in </span><span class="s3">(</span><span class="s4">&quot;L&quot;</span><span class="s3">, </span><span class="s4">&quot;I;16&quot;</span><span class="s3">, </span><span class="s4">&quot;I&quot;</span><span class="s3">):</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">convert</span><span class="s3">(</span><span class="s4">&quot;L&quot;</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">color_mode </span><span class="s3">== </span><span class="s4">&quot;rgba&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">img</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">!= </span><span class="s4">&quot;RGBA&quot;</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">convert</span><span class="s3">(</span><span class="s4">&quot;RGBA&quot;</span><span class="s3">)</span>
    <span class="s2">elif </span><span class="s1">color_mode </span><span class="s3">== </span><span class="s4">&quot;rgb&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">img</span><span class="s3">.</span><span class="s1">mode </span><span class="s3">!= </span><span class="s4">&quot;RGB&quot;</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">convert</span><span class="s3">(</span><span class="s4">&quot;RGB&quot;</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s4">'color_mode must be &quot;grayscale&quot;, &quot;rgb&quot;, or &quot;rgba&quot;'</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">target_size </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s1">width_height_tuple </span><span class="s3">= (</span><span class="s1">target_size</span><span class="s3">[</span><span class="s5">1</span><span class="s3">], </span><span class="s1">target_size</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])</span>
        <span class="s2">if </span><span class="s1">img</span><span class="s3">.</span><span class="s1">size </span><span class="s3">!= </span><span class="s1">width_height_tuple</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">interpolation </span><span class="s2">not in </span><span class="s1">PIL_INTERPOLATION_METHODS</span><span class="s3">:</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                    <span class="s4">&quot;Invalid interpolation method {} specified. Supported &quot;</span>
                    <span class="s4">&quot;methods are {}&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span>
                        <span class="s1">interpolation</span><span class="s3">,</span>
                        <span class="s4">&quot;, &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">PIL_INTERPOLATION_METHODS</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()),</span>
                    <span class="s3">)</span>
                <span class="s3">)</span>
            <span class="s1">resample </span><span class="s3">= </span><span class="s1">PIL_INTERPOLATION_METHODS</span><span class="s3">[</span><span class="s1">interpolation</span><span class="s3">]</span>

            <span class="s2">if </span><span class="s1">keep_aspect_ratio</span><span class="s3">:</span>
                <span class="s1">width</span><span class="s3">, </span><span class="s1">height </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">size</span>
                <span class="s1">target_width</span><span class="s3">, </span><span class="s1">target_height </span><span class="s3">= </span><span class="s1">width_height_tuple</span>

                <span class="s1">crop_height </span><span class="s3">= (</span><span class="s1">width </span><span class="s3">* </span><span class="s1">target_height</span><span class="s3">) // </span><span class="s1">target_width</span>
                <span class="s1">crop_width </span><span class="s3">= (</span><span class="s1">height </span><span class="s3">* </span><span class="s1">target_width</span><span class="s3">) // </span><span class="s1">target_height</span>

                <span class="s6"># Set back to input height / width</span>
                <span class="s6"># if crop_height / crop_width is not smaller.</span>
                <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">height</span><span class="s3">, </span><span class="s1">crop_height</span><span class="s3">)</span>
                <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">min</span><span class="s3">(</span><span class="s1">width</span><span class="s3">, </span><span class="s1">crop_width</span><span class="s3">)</span>

                <span class="s1">crop_box_hstart </span><span class="s3">= (</span><span class="s1">height </span><span class="s3">- </span><span class="s1">crop_height</span><span class="s3">) // </span><span class="s5">2</span>
                <span class="s1">crop_box_wstart </span><span class="s3">= (</span><span class="s1">width </span><span class="s3">- </span><span class="s1">crop_width</span><span class="s3">) // </span><span class="s5">2</span>
                <span class="s1">crop_box_wend </span><span class="s3">= </span><span class="s1">crop_box_wstart </span><span class="s3">+ </span><span class="s1">crop_width</span>
                <span class="s1">crop_box_hend </span><span class="s3">= </span><span class="s1">crop_box_hstart </span><span class="s3">+ </span><span class="s1">crop_height</span>
                <span class="s1">crop_box </span><span class="s3">= [</span>
                    <span class="s1">crop_box_wstart</span><span class="s3">,</span>
                    <span class="s1">crop_box_hstart</span><span class="s3">,</span>
                    <span class="s1">crop_box_wend</span><span class="s3">,</span>
                    <span class="s1">crop_box_hend</span><span class="s3">,</span>
                <span class="s3">]</span>
                <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">resize</span><span class="s3">(</span><span class="s1">width_height_tuple</span><span class="s3">, </span><span class="s1">resample</span><span class="s3">, </span><span class="s1">box</span><span class="s3">=</span><span class="s1">crop_box</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">.</span><span class="s1">resize</span><span class="s3">(</span><span class="s1">width_height_tuple</span><span class="s3">, </span><span class="s1">resample</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">img</span>


<span class="s3">@</span><span class="s1">keras_export</span><span class="s3">(</span><span class="s4">&quot;keras.preprocessing.image.smart_resize&quot;</span><span class="s3">)</span>
<span class="s2">def </span><span class="s1">smart_resize</span><span class="s3">(</span>
    <span class="s1">x</span><span class="s3">,</span>
    <span class="s1">size</span><span class="s3">,</span>
    <span class="s1">interpolation</span><span class="s3">=</span><span class="s4">&quot;bilinear&quot;</span><span class="s3">,</span>
    <span class="s1">data_format</span><span class="s3">=</span><span class="s4">&quot;channels_last&quot;</span><span class="s3">,</span>
    <span class="s1">backend_module</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Resize images to a target size without aspect ratio distortion. 
 
    Image datasets typically yield images that have each a different 
    size. However, these images need to be batched before they can be 
    processed by Keras layers. To be batched, images need to share the same 
    height and width. 
 
    You could simply do, in TF (or JAX equivalent): 
 
    ```python 
    size = (200, 200) 
    ds = ds.map(lambda img: resize(img, size)) 
    ``` 
 
    However, if you do this, you distort the aspect ratio of your images, since 
    in general they do not all have the same aspect ratio as `size`. This is 
    fine in many cases, but not always (e.g. for image generation models 
    this can be a problem). 
 
    Note that passing the argument `preserve_aspect_ratio=True` to `resize` 
    will preserve the aspect ratio, but at the cost of no longer respecting the 
    provided target size. 
 
    This calls for: 
 
    ```python 
    size = (200, 200) 
    ds = ds.map(lambda img: smart_resize(img, size)) 
    ``` 
 
    Your output images will actually be `(200, 200)`, and will not be distorted. 
    Instead, the parts of the image that do not fit within the target size 
    get cropped out. 
 
    The resizing process is: 
 
    1. Take the largest centered crop of the image that has the same aspect 
    ratio as the target size. For instance, if `size=(200, 200)` and the input 
    image has size `(340, 500)`, we take a crop of `(340, 340)` centered along 
    the width. 
    2. Resize the cropped image to the target size. In the example above, 
    we resize the `(340, 340)` crop to `(200, 200)`. 
 
    Args: 
        x: Input image or batch of images (as a tensor or NumPy array). 
            Must be in format `(height, width, channels)` 
            or `(batch_size, height, width, channels)`. 
        size: Tuple of `(height, width)` integer. Target size. 
        interpolation: String, interpolation to use for resizing. 
            Supports `&quot;bilinear&quot;`, `&quot;nearest&quot;`, `&quot;bicubic&quot;`, 
            `&quot;lanczos3&quot;`, `&quot;lanczos5&quot;`. 
            Defaults to `&quot;bilinear&quot;`. 
        data_format: `&quot;channels_last&quot;` or `&quot;channels_first&quot;`. 
        backend_module: Backend module to use (if different from the default 
            backend). 
 
    Returns: 
        Array with shape `(size[0], size[1], channels)`. 
        If the input image was a NumPy array, the output is a NumPy array, 
        and if it was a backend-native tensor, 
        the output is a backend-native tensor. 
    &quot;&quot;&quot;</span>
    <span class="s1">backend_module </span><span class="s3">= </span><span class="s1">backend_module </span><span class="s2">or </span><span class="s1">backend</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">size</span><span class="s3">) != </span><span class="s5">2</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
            <span class="s4">f&quot;Expected `size` to be a tuple of 2 integers, but got: </span><span class="s2">{</span><span class="s1">size</span><span class="s2">}</span><span class="s4">.&quot;</span>
        <span class="s3">)</span>
    <span class="s1">img </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">convert_to_tensor</span><span class="s3">(</span><span class="s1">x</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) </span><span class="s2">is not None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) &lt; </span><span class="s5">3 </span><span class="s2">or </span><span class="s1">len</span><span class="s3">(</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) &gt; </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                <span class="s4">&quot;Expected an image array with shape `(height, width, &quot;</span>
                <span class="s4">&quot;channels)`, or `(batch_size, height, width, channels)`, but &quot;</span>
                <span class="s4">f&quot;got input with incorrect rank, of shape </span><span class="s2">{</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s2">}</span><span class="s4">.&quot;</span>
            <span class="s3">)</span>
    <span class="s1">shape </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">(</span><span class="s1">img</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">data_format </span><span class="s3">== </span><span class="s4">&quot;channels_last&quot;</span><span class="s3">:</span>
        <span class="s1">height</span><span class="s3">, </span><span class="s1">width </span><span class="s3">= </span><span class="s1">shape</span><span class="s3">[-</span><span class="s5">3</span><span class="s3">], </span><span class="s1">shape</span><span class="s3">[-</span><span class="s5">2</span><span class="s3">]</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">height</span><span class="s3">, </span><span class="s1">width </span><span class="s3">= </span><span class="s1">shape</span><span class="s3">[-</span><span class="s5">2</span><span class="s3">], </span><span class="s1">shape</span><span class="s3">[-</span><span class="s5">1</span><span class="s3">]</span>
    <span class="s1">target_height</span><span class="s3">, </span><span class="s1">target_width </span><span class="s3">= </span><span class="s1">size</span>

    <span class="s6"># Set back to input height / width if crop_height / crop_width is not</span>
    <span class="s6"># smaller.</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">height</span><span class="s3">, </span><span class="s1">int</span><span class="s3">) </span><span class="s2">and </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">width</span><span class="s3">, </span><span class="s1">int</span><span class="s3">):</span>
        <span class="s6"># For JAX, we need to keep the slice indices as static integers</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">width </span><span class="s3">* </span><span class="s1">target_height</span><span class="s3">) / </span><span class="s1">target_width</span><span class="s3">)</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">min</span><span class="s3">(</span><span class="s1">height</span><span class="s3">, </span><span class="s1">crop_height</span><span class="s3">), </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">height </span><span class="s3">* </span><span class="s1">target_width</span><span class="s3">) / </span><span class="s1">target_height</span><span class="s3">)</span>
        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">max</span><span class="s3">(</span><span class="s1">min</span><span class="s3">(</span><span class="s1">width</span><span class="s3">, </span><span class="s1">crop_width</span><span class="s3">), </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">crop_box_hstart </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">height </span><span class="s3">- </span><span class="s1">crop_height</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">)</span>
        <span class="s1">crop_box_wstart </span><span class="s3">= </span><span class="s1">int</span><span class="s3">(</span><span class="s1">float</span><span class="s3">(</span><span class="s1">width </span><span class="s3">- </span><span class="s1">crop_width</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span>
            <span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">width </span><span class="s3">* </span><span class="s1">target_height</span><span class="s3">, </span><span class="s4">&quot;float32&quot;</span><span class="s3">)</span>
            <span class="s3">/ </span><span class="s1">target_width</span><span class="s3">,</span>
            <span class="s4">&quot;int32&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">minimum</span><span class="s3">(</span><span class="s1">height</span><span class="s3">, </span><span class="s1">crop_height</span><span class="s3">)</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">maximum</span><span class="s3">(</span><span class="s1">crop_height</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">crop_height </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">crop_height</span><span class="s3">, </span><span class="s4">&quot;int32&quot;</span><span class="s3">)</span>

        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span>
            <span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">height </span><span class="s3">* </span><span class="s1">target_width</span><span class="s3">, </span><span class="s4">&quot;float32&quot;</span><span class="s3">)</span>
            <span class="s3">/ </span><span class="s1">target_height</span><span class="s3">,</span>
            <span class="s4">&quot;int32&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">minimum</span><span class="s3">(</span><span class="s1">width</span><span class="s3">, </span><span class="s1">crop_width</span><span class="s3">)</span>
        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">numpy</span><span class="s3">.</span><span class="s1">maximum</span><span class="s3">(</span><span class="s1">crop_width</span><span class="s3">, </span><span class="s5">1</span><span class="s3">)</span>
        <span class="s1">crop_width </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">crop_width</span><span class="s3">, </span><span class="s4">&quot;int32&quot;</span><span class="s3">)</span>

        <span class="s1">crop_box_hstart </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span>
            <span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">height </span><span class="s3">- </span><span class="s1">crop_height</span><span class="s3">, </span><span class="s4">&quot;float32&quot;</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;int32&quot;</span>
        <span class="s3">)</span>
        <span class="s1">crop_box_wstart </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span>
            <span class="s1">backend_module</span><span class="s3">.</span><span class="s1">cast</span><span class="s3">(</span><span class="s1">width </span><span class="s3">- </span><span class="s1">crop_width</span><span class="s3">, </span><span class="s4">&quot;float32&quot;</span><span class="s3">) / </span><span class="s5">2</span><span class="s3">, </span><span class="s4">&quot;int32&quot;</span>
        <span class="s3">)</span>

    <span class="s2">if </span><span class="s1">data_format </span><span class="s3">== </span><span class="s4">&quot;channels_last&quot;</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) == </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">[</span>
                <span class="s3">:,</span>
                <span class="s1">crop_box_hstart </span><span class="s3">: </span><span class="s1">crop_box_hstart </span><span class="s3">+ </span><span class="s1">crop_height</span><span class="s3">,</span>
                <span class="s1">crop_box_wstart </span><span class="s3">: </span><span class="s1">crop_box_wstart </span><span class="s3">+ </span><span class="s1">crop_width</span><span class="s3">,</span>
                <span class="s3">:,</span>
            <span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">[</span>
                <span class="s1">crop_box_hstart </span><span class="s3">: </span><span class="s1">crop_box_hstart </span><span class="s3">+ </span><span class="s1">crop_height</span><span class="s3">,</span>
                <span class="s1">crop_box_wstart </span><span class="s3">: </span><span class="s1">crop_box_wstart </span><span class="s3">+ </span><span class="s1">crop_width</span><span class="s3">,</span>
                <span class="s3">:,</span>
            <span class="s3">]</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">img</span><span class="s3">.</span><span class="s1">shape</span><span class="s3">) == </span><span class="s5">4</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">[</span>
                <span class="s3">:,</span>
                <span class="s3">:,</span>
                <span class="s1">crop_box_hstart </span><span class="s3">: </span><span class="s1">crop_box_hstart </span><span class="s3">+ </span><span class="s1">crop_height</span><span class="s3">,</span>
                <span class="s1">crop_box_wstart </span><span class="s3">: </span><span class="s1">crop_box_wstart </span><span class="s3">+ </span><span class="s1">crop_width</span><span class="s3">,</span>
            <span class="s3">]</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">img </span><span class="s3">= </span><span class="s1">img</span><span class="s3">[</span>
                <span class="s3">:,</span>
                <span class="s1">crop_box_hstart </span><span class="s3">: </span><span class="s1">crop_box_hstart </span><span class="s3">+ </span><span class="s1">crop_height</span><span class="s3">,</span>
                <span class="s1">crop_box_wstart </span><span class="s3">: </span><span class="s1">crop_box_wstart </span><span class="s3">+ </span><span class="s1">crop_width</span><span class="s3">,</span>
            <span class="s3">]</span>

    <span class="s1">img </span><span class="s3">= </span><span class="s1">backend_module</span><span class="s3">.</span><span class="s1">image</span><span class="s3">.</span><span class="s1">resize</span><span class="s3">(</span>
        <span class="s1">img</span><span class="s3">, </span><span class="s1">size</span><span class="s3">=</span><span class="s1">size</span><span class="s3">, </span><span class="s1">interpolation</span><span class="s3">=</span><span class="s1">interpolation</span><span class="s3">, </span><span class="s1">data_format</span><span class="s3">=</span><span class="s1">data_format</span>
    <span class="s3">)</span>

    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">np</span><span class="s3">.</span><span class="s1">ndarray</span><span class="s3">):</span>
        <span class="s2">return </span><span class="s1">np</span><span class="s3">.</span><span class="s1">array</span><span class="s3">(</span><span class="s1">img</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">img</span>
</pre>
</body>
</html>