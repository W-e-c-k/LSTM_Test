<html>
<head>
<title>markdown.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #7a7e85;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
markdown.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">annotations</span>

<span class="s0">import </span><span class="s1">sys</span>
<span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">ClassVar</span><span class="s2">, </span><span class="s1">Iterable</span>

<span class="s0">from </span><span class="s1">markdown_it </span><span class="s0">import </span><span class="s1">MarkdownIt</span>
<span class="s0">from </span><span class="s1">markdown_it</span><span class="s2">.</span><span class="s1">token </span><span class="s0">import </span><span class="s1">Token</span>

<span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info </span><span class="s2">&gt;= (</span><span class="s3">3</span><span class="s2">, </span><span class="s3">8</span><span class="s2">):</span>
    <span class="s0">from </span><span class="s1">typing </span><span class="s0">import </span><span class="s1">get_args</span>
<span class="s0">else</span><span class="s2">:</span>
    <span class="s0">from </span><span class="s1">typing_extensions </span><span class="s0">import </span><span class="s1">get_args  </span><span class="s4"># pragma: no cover</span>

<span class="s0">from </span><span class="s1">rich</span><span class="s2">.</span><span class="s1">table </span><span class="s0">import </span><span class="s1">Table</span>

<span class="s0">from </span><span class="s2">. </span><span class="s0">import </span><span class="s1">box</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_loop </span><span class="s0">import </span><span class="s1">loop_first</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">_stack </span><span class="s0">import </span><span class="s1">Stack</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">console </span><span class="s0">import </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">ConsoleOptions</span><span class="s2">, </span><span class="s1">JustifyMethod</span><span class="s2">, </span><span class="s1">RenderResult</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">containers </span><span class="s0">import </span><span class="s1">Renderables</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">jupyter </span><span class="s0">import </span><span class="s1">JupyterMixin</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">panel </span><span class="s0">import </span><span class="s1">Panel</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">rule </span><span class="s0">import </span><span class="s1">Rule</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">segment </span><span class="s0">import </span><span class="s1">Segment</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">style </span><span class="s0">import </span><span class="s1">Style</span><span class="s2">, </span><span class="s1">StyleStack</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">syntax </span><span class="s0">import </span><span class="s1">Syntax</span>
<span class="s0">from </span><span class="s2">.</span><span class="s1">text </span><span class="s0">import </span><span class="s1">Text</span><span class="s2">, </span><span class="s1">TextType</span>


<span class="s0">class </span><span class="s1">MarkdownElement</span><span class="s2">:</span>
    <span class="s1">new_line</span><span class="s2">: </span><span class="s1">ClassVar</span><span class="s2">[</span><span class="s1">bool</span><span class="s2">] = </span><span class="s0">True</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; MarkdownElement</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Factory to create markdown element, 
 
        Args: 
            markdown (Markdown): The parent Markdown object. 
            token (Token): A node from markdown-it. 
 
        Returns: 
            MarkdownElement: A new markdown element 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Called when the node is entered. 
 
        Args: 
            context (MarkdownContext): The markdown context. 
        &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">TextType</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Called when text is parsed. 
 
        Args: 
            context (MarkdownContext): The markdown context. 
        &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">on_leave</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Called when the parser leaves the element. 
 
        Args: 
            context (MarkdownContext): [description] 
        &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Called when a child element is closed. 
 
        This method allows a parent element to take over rendering of its children. 
 
        Args: 
            context (MarkdownContext): The markdown context. 
            child (MarkdownElement): The child markdown element. 
 
        Returns: 
            bool: Return True to render the element, or False to not render the element. 
        &quot;&quot;&quot;</span>
        <span class="s0">return True</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">UnknownElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;An unknown element. 
 
    Hopefully there will be no unknown elements, and we will have a MarkdownElement for 
    everything in the document. 
 
    &quot;&quot;&quot;</span>


<span class="s0">class </span><span class="s1">TextElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Base class for elements that render text.&quot;&quot;&quot;</span>

    <span class="s1">style_name </span><span class="s2">= </span><span class="s6">&quot;none&quot;</span>

    <span class="s0">def </span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">style </span><span class="s2">= </span><span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style_name</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">justify</span><span class="s2">=</span><span class="s6">&quot;left&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">TextType</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">text</span><span class="s2">, </span><span class="s1">context</span><span class="s2">.</span><span class="s1">current_style </span><span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">text</span><span class="s2">, </span><span class="s1">str</span><span class="s2">) </span><span class="s0">else None</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">on_leave</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>


<span class="s0">class </span><span class="s1">Paragraph</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A Paragraph.&quot;&quot;&quot;</span>

    <span class="s1">style_name </span><span class="s2">= </span><span class="s6">&quot;markdown.paragraph&quot;</span>
    <span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; Paragraph</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">justify</span><span class="s2">=</span><span class="s1">markdown</span><span class="s2">.</span><span class="s1">justify </span><span class="s0">or </span><span class="s6">&quot;left&quot;</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">justify </span><span class="s2">= </span><span class="s1">justify</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">justify </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">justify</span>
        <span class="s0">yield </span><span class="s1">self</span><span class="s2">.</span><span class="s1">text</span>


<span class="s0">class </span><span class="s1">Heading</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A heading.&quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; Heading</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">()</span>
        <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style_name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tag</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">= </span><span class="s1">tag</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">style_name </span><span class="s2">= </span><span class="s6">f&quot;markdown.</span><span class="s0">{</span><span class="s1">tag</span><span class="s0">}</span><span class="s6">&quot;</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">text</span>
        <span class="s1">text</span><span class="s2">.</span><span class="s1">justify </span><span class="s2">= </span><span class="s6">&quot;center&quot;</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">== </span><span class="s6">&quot;h1&quot;</span><span class="s2">:</span>
            <span class="s4"># Draw a border around h1s</span>
            <span class="s0">yield </span><span class="s1">Panel</span><span class="s2">(</span>
                <span class="s1">text</span><span class="s2">,</span>
                <span class="s1">box</span><span class="s2">=</span><span class="s1">box</span><span class="s2">.</span><span class="s1">HEAVY</span><span class="s2">,</span>
                <span class="s1">style</span><span class="s2">=</span><span class="s6">&quot;markdown.h1.border&quot;</span><span class="s2">,</span>
            <span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s4"># Styled text for h2 and beyond</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">== </span><span class="s6">&quot;h2&quot;</span><span class="s2">:</span>
                <span class="s0">yield </span><span class="s1">Text</span><span class="s2">(</span><span class="s6">&quot;&quot;</span><span class="s2">)</span>
            <span class="s0">yield </span><span class="s1">text</span>


<span class="s0">class </span><span class="s1">CodeBlock</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A code block with syntax highlighting.&quot;&quot;&quot;</span>

    <span class="s1">style_name </span><span class="s2">= </span><span class="s6">&quot;markdown.code_block&quot;</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; CodeBlock</span><span class="s2">:</span>
        <span class="s1">node_info </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">info </span><span class="s0">or </span><span class="s6">&quot;&quot;</span>
        <span class="s1">lexer_name </span><span class="s2">= </span><span class="s1">node_info</span><span class="s2">.</span><span class="s1">partition</span><span class="s2">(</span><span class="s6">&quot; &quot;</span><span class="s2">)[</span><span class="s3">0</span><span class="s2">]</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">lexer_name </span><span class="s0">or </span><span class="s6">&quot;text&quot;</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">.</span><span class="s1">code_theme</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">lexer_name</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">theme</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">lexer_name </span><span class="s2">= </span><span class="s1">lexer_name</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">theme </span><span class="s2">= </span><span class="s1">theme</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">code </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">text</span><span class="s2">).</span><span class="s1">rstrip</span><span class="s2">()</span>
        <span class="s1">syntax </span><span class="s2">= </span><span class="s1">Syntax</span><span class="s2">(</span>
            <span class="s1">code</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lexer_name</span><span class="s2">, </span><span class="s1">theme</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">theme</span><span class="s2">, </span><span class="s1">word_wrap</span><span class="s2">=</span><span class="s0">True</span><span class="s2">, </span><span class="s1">padding</span><span class="s2">=</span><span class="s3">1</span>
        <span class="s2">)</span>
        <span class="s0">yield </span><span class="s1">syntax</span>


<span class="s0">class </span><span class="s1">BlockQuote</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A block quote.&quot;&quot;&quot;</span>

    <span class="s1">style_name </span><span class="s2">= </span><span class="s6">&quot;markdown.block_quote&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">: </span><span class="s1">Renderables </span><span class="s2">= </span><span class="s1">Renderables</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">render_options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s1">options</span><span class="s2">.</span><span class="s1">max_width </span><span class="s2">- </span><span class="s3">4</span><span class="s2">)</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">render_lines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">, </span><span class="s1">render_options</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">style</span>
        <span class="s1">new_line </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot;</span><span class="s0">\n</span><span class="s6">&quot;</span><span class="s2">)</span>
        <span class="s1">padding </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot;▌ &quot;</span><span class="s2">, </span><span class="s1">style</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">lines</span><span class="s2">:</span>
            <span class="s0">yield </span><span class="s1">padding</span>
            <span class="s0">yield from </span><span class="s1">line</span>
            <span class="s0">yield </span><span class="s1">new_line</span>


<span class="s0">class </span><span class="s1">HorizontalRule</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A horizontal rule to divide sections.&quot;&quot;&quot;</span>

    <span class="s1">new_line </span><span class="s2">= </span><span class="s0">False</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s6">&quot;markdown.hr&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>
        <span class="s0">yield </span><span class="s1">Rule</span><span class="s2">(</span><span class="s1">style</span><span class="s2">=</span><span class="s1">style</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">TableElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;MarkdownElement corresponding to `table_open`.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">header</span><span class="s2">: </span><span class="s1">TableHeaderElement </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">body</span><span class="s2">: </span><span class="s1">TableBodyElement </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">TableHeaderElement</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">header </span><span class="s2">= </span><span class="s1">child</span>
        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">TableBodyElement</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">body </span><span class="s2">= </span><span class="s1">child</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">RuntimeError</span><span class="s2">(</span><span class="s6">&quot;Couldn't process markdown table.&quot;</span><span class="s2">)</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">table </span><span class="s2">= </span><span class="s1">Table</span><span class="s2">(</span><span class="s1">box</span><span class="s2">=</span><span class="s1">box</span><span class="s2">.</span><span class="s1">SIMPLE_HEAVY</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">header </span><span class="s0">is not None and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">header</span><span class="s2">.</span><span class="s1">row </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">column </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">header</span><span class="s2">.</span><span class="s1">row</span><span class="s2">.</span><span class="s1">cells</span><span class="s2">:</span>
                <span class="s1">table</span><span class="s2">.</span><span class="s1">add_column</span><span class="s2">(</span><span class="s1">column</span><span class="s2">.</span><span class="s1">content</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">body </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">rows</span><span class="s2">:</span>
                <span class="s1">row_content </span><span class="s2">= [</span><span class="s1">element</span><span class="s2">.</span><span class="s1">content </span><span class="s0">for </span><span class="s1">element </span><span class="s0">in </span><span class="s1">row</span><span class="s2">.</span><span class="s1">cells</span><span class="s2">]</span>
                <span class="s1">table</span><span class="s2">.</span><span class="s1">add_row</span><span class="s2">(*</span><span class="s1">row_content</span><span class="s2">)</span>

        <span class="s0">yield </span><span class="s1">table</span>


<span class="s0">class </span><span class="s1">TableHeaderElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;MarkdownElement corresponding to `thead_open` and `thead_close`.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">row</span><span class="s2">: </span><span class="s1">TableRowElement </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">TableRowElement</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">row </span><span class="s2">= </span><span class="s1">child</span>
        <span class="s0">return False</span>


<span class="s0">class </span><span class="s1">TableBodyElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;MarkdownElement corresponding to `tbody_open` and `tbody_close`.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rows</span><span class="s2">: </span><span class="s1">list</span><span class="s2">[</span><span class="s1">TableRowElement</span><span class="s2">] = []</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">TableRowElement</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">rows</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s0">return False</span>


<span class="s0">class </span><span class="s1">TableRowElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;MarkdownElement corresponding to `tr_open` and `tr_close`.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cells</span><span class="s2">: </span><span class="s1">list</span><span class="s2">[</span><span class="s1">TableDataElement</span><span class="s2">] = []</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">TableDataElement</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">cells</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s0">return False</span>


<span class="s0">class </span><span class="s1">TableDataElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;MarkdownElement corresponding to `td_open` and `td_close` 
    and `th_open` and `th_close`.&quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; MarkdownElement</span><span class="s2">:</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">&quot;style&quot;</span><span class="s2">)) </span><span class="s0">or </span><span class="s6">&quot;&quot;</span>

        <span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod</span>
        <span class="s0">if </span><span class="s6">&quot;text-align:right&quot; </span><span class="s0">in </span><span class="s1">style</span><span class="s2">:</span>
            <span class="s1">justify </span><span class="s2">= </span><span class="s6">&quot;right&quot;</span>
        <span class="s0">elif </span><span class="s6">&quot;text-align:center&quot; </span><span class="s0">in </span><span class="s1">style</span><span class="s2">:</span>
            <span class="s1">justify </span><span class="s2">= </span><span class="s6">&quot;center&quot;</span>
        <span class="s0">elif </span><span class="s6">&quot;text-align:left&quot; </span><span class="s0">in </span><span class="s1">style</span><span class="s2">:</span>
            <span class="s1">justify </span><span class="s2">= </span><span class="s6">&quot;left&quot;</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">justify </span><span class="s2">= </span><span class="s6">&quot;default&quot;</span>

        <span class="s0">assert </span><span class="s1">justify </span><span class="s0">in </span><span class="s1">get_args</span><span class="s2">(</span><span class="s1">JustifyMethod</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">justify</span><span class="s2">=</span><span class="s1">justify</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">: </span><span class="s1">Text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s6">&quot;&quot;</span><span class="s2">, </span><span class="s1">justify</span><span class="s2">=</span><span class="s1">justify</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">justify </span><span class="s2">= </span><span class="s1">justify</span>

    <span class="s0">def </span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">TextType</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">text</span><span class="s2">) </span><span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">text</span><span class="s2">, </span><span class="s1">str</span><span class="s2">) </span><span class="s0">else </span><span class="s1">text</span>
        <span class="s1">text</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">context</span><span class="s2">.</span><span class="s1">current_style</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">content</span><span class="s2">.</span><span class="s1">append_text</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span>


<span class="s0">class </span><span class="s1">ListElement</span><span class="s2">(</span><span class="s1">MarkdownElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A list element.&quot;&quot;&quot;</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; ListElement</span><span class="s2">:</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">&quot;start&quot;</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)))</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">list_type</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">list_start</span><span class="s2">: </span><span class="s1">int </span><span class="s2">| </span><span class="s0">None</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">items</span><span class="s2">: </span><span class="s1">list</span><span class="s2">[</span><span class="s1">ListItem</span><span class="s2">] = []</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">list_type </span><span class="s2">= </span><span class="s1">list_type</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">list_start </span><span class="s2">= </span><span class="s1">list_start</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">child</span><span class="s2">, </span><span class="s1">ListItem</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">items</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">list_type </span><span class="s2">== </span><span class="s6">&quot;bullet_list_open&quot;</span><span class="s2">:</span>
            <span class="s0">for </span><span class="s1">item </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">items</span><span class="s2">:</span>
                <span class="s0">yield from </span><span class="s1">item</span><span class="s2">.</span><span class="s1">render_bullet</span><span class="s2">(</span><span class="s1">console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">number </span><span class="s2">= </span><span class="s3">1 </span><span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">list_start </span><span class="s0">is None else </span><span class="s1">self</span><span class="s2">.</span><span class="s1">list_start</span>
            <span class="s1">last_number </span><span class="s2">= </span><span class="s1">number </span><span class="s2">+ </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">items</span><span class="s2">)</span>
            <span class="s0">for </span><span class="s1">index</span><span class="s2">, </span><span class="s1">item </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">items</span><span class="s2">):</span>
                <span class="s0">yield from </span><span class="s1">item</span><span class="s2">.</span><span class="s1">render_number</span><span class="s2">(</span>
                    <span class="s1">console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">, </span><span class="s1">number </span><span class="s2">+ </span><span class="s1">index</span><span class="s2">, </span><span class="s1">last_number</span>
                <span class="s2">)</span>


<span class="s0">class </span><span class="s1">ListItem</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;An item in a list.&quot;&quot;&quot;</span>

    <span class="s1">style_name </span><span class="s2">= </span><span class="s6">&quot;markdown.item&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">: </span><span class="s1">Renderables </span><span class="s2">= </span><span class="s1">Renderables</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">, </span><span class="s1">child</span><span class="s2">: </span><span class="s1">MarkdownElement</span><span class="s2">) </span><span class="s1">-&gt; bool</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">.</span><span class="s1">append</span><span class="s2">(</span><span class="s1">child</span><span class="s2">)</span>
        <span class="s0">return False</span>

    <span class="s0">def </span><span class="s1">render_bullet</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span><span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">render_options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s1">options</span><span class="s2">.</span><span class="s1">max_width </span><span class="s2">- </span><span class="s3">3</span><span class="s2">)</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">render_lines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">, </span><span class="s1">render_options</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s1">bullet_style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s6">&quot;markdown.item.bullet&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>

        <span class="s1">bullet </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot; • &quot;</span><span class="s2">, </span><span class="s1">bullet_style</span><span class="s2">)</span>
        <span class="s1">padding </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot; &quot; </span><span class="s2">* </span><span class="s3">3</span><span class="s2">, </span><span class="s1">bullet_style</span><span class="s2">)</span>
        <span class="s1">new_line </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot;</span><span class="s0">\n</span><span class="s6">&quot;</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">first</span><span class="s2">, </span><span class="s1">line </span><span class="s0">in </span><span class="s1">loop_first</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">):</span>
            <span class="s0">yield </span><span class="s1">bullet </span><span class="s0">if </span><span class="s1">first </span><span class="s0">else </span><span class="s1">padding</span>
            <span class="s0">yield from </span><span class="s1">line</span>
            <span class="s0">yield </span><span class="s1">new_line</span>

    <span class="s0">def </span><span class="s1">render_number</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span><span class="s2">, </span><span class="s1">number</span><span class="s2">: </span><span class="s1">int</span><span class="s2">, </span><span class="s1">last_number</span><span class="s2">: </span><span class="s1">int</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">number_width </span><span class="s2">= </span><span class="s1">len</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">last_number</span><span class="s2">)) + </span><span class="s3">2</span>
        <span class="s1">render_options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">width</span><span class="s2">=</span><span class="s1">options</span><span class="s2">.</span><span class="s1">max_width </span><span class="s2">- </span><span class="s1">number_width</span><span class="s2">)</span>
        <span class="s1">lines </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">render_lines</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">, </span><span class="s1">render_options</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s1">number_style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s6">&quot;markdown.item.number&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>

        <span class="s1">new_line </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot;</span><span class="s0">\n</span><span class="s6">&quot;</span><span class="s2">)</span>
        <span class="s1">padding </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">&quot; &quot; </span><span class="s2">* </span><span class="s1">number_width</span><span class="s2">, </span><span class="s1">number_style</span><span class="s2">)</span>
        <span class="s1">numeral </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">(</span><span class="s6">f&quot;</span><span class="s0">{</span><span class="s1">number</span><span class="s0">}</span><span class="s6">&quot;</span><span class="s2">.</span><span class="s1">rjust</span><span class="s2">(</span><span class="s1">number_width </span><span class="s2">- </span><span class="s3">1</span><span class="s2">) + </span><span class="s6">&quot; &quot;</span><span class="s2">, </span><span class="s1">number_style</span><span class="s2">)</span>
        <span class="s0">for </span><span class="s1">first</span><span class="s2">, </span><span class="s1">line </span><span class="s0">in </span><span class="s1">loop_first</span><span class="s2">(</span><span class="s1">lines</span><span class="s2">):</span>
            <span class="s0">yield </span><span class="s1">numeral </span><span class="s0">if </span><span class="s1">first </span><span class="s0">else </span><span class="s1">padding</span>
            <span class="s0">yield from </span><span class="s1">line</span>
            <span class="s0">yield </span><span class="s1">new_line</span>


<span class="s0">class </span><span class="s1">Link</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; MarkdownElement</span><span class="s2">:</span>
        <span class="s1">url </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">&quot;href&quot;</span><span class="s2">, </span><span class="s6">&quot;#&quot;</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">str</span><span class="s2">(</span><span class="s1">url</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">href</span><span class="s2">: </span><span class="s1">str</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">href </span><span class="s2">= </span><span class="s1">href</span>


<span class="s0">class </span><span class="s1">ImageItem</span><span class="s2">(</span><span class="s1">TextElement</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Renders a placeholder for an image.&quot;&quot;&quot;</span>

    <span class="s1">new_line </span><span class="s2">= </span><span class="s0">False</span>

    <span class="s2">@</span><span class="s1">classmethod</span>
    <span class="s0">def </span><span class="s1">create</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">markdown</span><span class="s2">: </span><span class="s1">Markdown</span><span class="s2">, </span><span class="s1">token</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">) </span><span class="s1">-&gt; MarkdownElement</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Factory to create markdown element, 
 
        Args: 
            markdown (Markdown): The parent Markdown object. 
            token (Any): A token from markdown-it. 
 
        Returns: 
            MarkdownElement: A new markdown element 
        &quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">cls</span><span class="s2">(</span><span class="s1">str</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">&quot;src&quot;</span><span class="s2">, </span><span class="s6">&quot;&quot;</span><span class="s2">)), </span><span class="s1">markdown</span><span class="s2">.</span><span class="s1">hyperlinks</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">destination</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">hyperlinks</span><span class="s2">: </span><span class="s1">bool</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">destination </span><span class="s2">= </span><span class="s1">destination</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">hyperlinks </span><span class="s2">= </span><span class="s1">hyperlinks</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">link</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">context</span><span class="s2">: </span><span class="s1">MarkdownContext</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">link </span><span class="s2">= </span><span class="s1">context</span><span class="s2">.</span><span class="s1">current_style</span><span class="s2">.</span><span class="s1">link</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">justify</span><span class="s2">=</span><span class="s6">&quot;left&quot;</span><span class="s2">)</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">context</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s1">link_style </span><span class="s2">= </span><span class="s1">Style</span><span class="s2">(</span><span class="s1">link</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">link </span><span class="s0">or </span><span class="s1">self</span><span class="s2">.</span><span class="s1">destination </span><span class="s0">or None</span><span class="s2">)</span>
        <span class="s1">title </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">text </span><span class="s0">or </span><span class="s1">Text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">destination</span><span class="s2">.</span><span class="s1">strip</span><span class="s2">(</span><span class="s6">&quot;/&quot;</span><span class="s2">).</span><span class="s1">rsplit</span><span class="s2">(</span><span class="s6">&quot;/&quot;</span><span class="s2">, </span><span class="s3">1</span><span class="s2">)[-</span><span class="s3">1</span><span class="s2">])</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hyperlinks</span><span class="s2">:</span>
            <span class="s1">title</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">link_style</span><span class="s2">)</span>
        <span class="s1">text </span><span class="s2">= </span><span class="s1">Text</span><span class="s2">.</span><span class="s1">assemble</span><span class="s2">(</span><span class="s6">&quot;🌆 &quot;</span><span class="s2">, </span><span class="s1">title</span><span class="s2">, </span><span class="s6">&quot; &quot;</span><span class="s2">, </span><span class="s1">end</span><span class="s2">=</span><span class="s6">&quot;&quot;</span><span class="s2">)</span>
        <span class="s0">yield </span><span class="s1">text</span>


<span class="s0">class </span><span class="s1">MarkdownContext</span><span class="s2">:</span>
    <span class="s5">&quot;&quot;&quot;Manages the console render state.&quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">,</span>
        <span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">Style</span><span class="s2">,</span>
        <span class="s1">inline_code_lexer</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">inline_code_theme</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s6">&quot;monokai&quot;</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">console </span><span class="s2">= </span><span class="s1">console</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">options </span><span class="s2">= </span><span class="s1">options</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">style_stack</span><span class="s2">: </span><span class="s1">StyleStack </span><span class="s2">= </span><span class="s1">StyleStack</span><span class="s2">(</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">: </span><span class="s1">Stack</span><span class="s2">[</span><span class="s1">MarkdownElement</span><span class="s2">] = </span><span class="s1">Stack</span><span class="s2">()</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_syntax</span><span class="s2">: </span><span class="s1">Syntax </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">if </span><span class="s1">inline_code_lexer </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_syntax </span><span class="s2">= </span><span class="s1">Syntax</span><span class="s2">(</span><span class="s6">&quot;&quot;</span><span class="s2">, </span><span class="s1">inline_code_lexer</span><span class="s2">, </span><span class="s1">theme</span><span class="s2">=</span><span class="s1">inline_code_theme</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">current_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Style</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Current style which is the product of all styles on the stack.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">style_stack</span><span class="s2">.</span><span class="s1">current</span>

    <span class="s0">def </span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">: </span><span class="s1">str</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">: </span><span class="s1">str</span><span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Called when the parser visits text.&quot;&quot;&quot;</span>
        <span class="s0">if </span><span class="s1">node_type </span><span class="s0">in </span><span class="s2">{</span><span class="s6">&quot;fence&quot;</span><span class="s2">, </span><span class="s6">&quot;code_inline&quot;</span><span class="s2">} </span><span class="s0">and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_syntax </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">highlight_text </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_syntax</span><span class="s2">.</span><span class="s1">highlight</span><span class="s2">(</span><span class="s1">text</span><span class="s2">)</span>
            <span class="s1">highlight_text</span><span class="s2">.</span><span class="s1">rstrip</span><span class="s2">()</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">top</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">, </span><span class="s1">Text</span><span class="s2">.</span><span class="s1">assemble</span><span class="s2">(</span><span class="s1">highlight_text</span><span class="s2">, </span><span class="s1">style</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style_stack</span><span class="s2">.</span><span class="s1">current</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">top</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">text</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">style_name</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s1">Style</span><span class="s2">) </span><span class="s1">-&gt; Style</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Enter a style context.&quot;&quot;&quot;</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s1">style_name</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">style_stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">style</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">current_style</span>

    <span class="s0">def </span><span class="s1">leave_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) </span><span class="s1">-&gt; Style</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Leave a style context.&quot;&quot;&quot;</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">style_stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
        <span class="s0">return </span><span class="s1">style</span>


<span class="s0">class </span><span class="s1">Markdown</span><span class="s2">(</span><span class="s1">JupyterMixin</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A Markdown renderable. 
 
    Args: 
        markup (str): A string containing markdown. 
        code_theme (str, optional): Pygments theme for code blocks. Defaults to &quot;monokai&quot;. See https://pygments.org/styles/ for code themes. 
        justify (JustifyMethod, optional): Justify value for paragraphs. Defaults to None. 
        style (Union[str, Style], optional): Optional style to apply to markdown. 
        hyperlinks (bool, optional): Enable hyperlinks. Defaults to ``True``. 
        inline_code_lexer: (str, optional): Lexer to use if inline code highlighting is 
            enabled. Defaults to None. 
        inline_code_theme: (Optional[str], optional): Pygments theme for inline code 
            highlighting, or None for no highlighting. Defaults to None. 
    &quot;&quot;&quot;</span>

    <span class="s1">elements</span><span class="s2">: </span><span class="s1">ClassVar</span><span class="s2">[</span><span class="s1">dict</span><span class="s2">[</span><span class="s1">str</span><span class="s2">, </span><span class="s1">type</span><span class="s2">[</span><span class="s1">MarkdownElement</span><span class="s2">]]] = {</span>
        <span class="s6">&quot;paragraph_open&quot;</span><span class="s2">: </span><span class="s1">Paragraph</span><span class="s2">,</span>
        <span class="s6">&quot;heading_open&quot;</span><span class="s2">: </span><span class="s1">Heading</span><span class="s2">,</span>
        <span class="s6">&quot;fence&quot;</span><span class="s2">: </span><span class="s1">CodeBlock</span><span class="s2">,</span>
        <span class="s6">&quot;code_block&quot;</span><span class="s2">: </span><span class="s1">CodeBlock</span><span class="s2">,</span>
        <span class="s6">&quot;blockquote_open&quot;</span><span class="s2">: </span><span class="s1">BlockQuote</span><span class="s2">,</span>
        <span class="s6">&quot;hr&quot;</span><span class="s2">: </span><span class="s1">HorizontalRule</span><span class="s2">,</span>
        <span class="s6">&quot;bullet_list_open&quot;</span><span class="s2">: </span><span class="s1">ListElement</span><span class="s2">,</span>
        <span class="s6">&quot;ordered_list_open&quot;</span><span class="s2">: </span><span class="s1">ListElement</span><span class="s2">,</span>
        <span class="s6">&quot;list_item_open&quot;</span><span class="s2">: </span><span class="s1">ListItem</span><span class="s2">,</span>
        <span class="s6">&quot;image&quot;</span><span class="s2">: </span><span class="s1">ImageItem</span><span class="s2">,</span>
        <span class="s6">&quot;table_open&quot;</span><span class="s2">: </span><span class="s1">TableElement</span><span class="s2">,</span>
        <span class="s6">&quot;tbody_open&quot;</span><span class="s2">: </span><span class="s1">TableBodyElement</span><span class="s2">,</span>
        <span class="s6">&quot;thead_open&quot;</span><span class="s2">: </span><span class="s1">TableHeaderElement</span><span class="s2">,</span>
        <span class="s6">&quot;tr_open&quot;</span><span class="s2">: </span><span class="s1">TableRowElement</span><span class="s2">,</span>
        <span class="s6">&quot;td_open&quot;</span><span class="s2">: </span><span class="s1">TableDataElement</span><span class="s2">,</span>
        <span class="s6">&quot;th_open&quot;</span><span class="s2">: </span><span class="s1">TableDataElement</span><span class="s2">,</span>
    <span class="s2">}</span>

    <span class="s1">inlines </span><span class="s2">= {</span><span class="s6">&quot;em&quot;</span><span class="s2">, </span><span class="s6">&quot;strong&quot;</span><span class="s2">, </span><span class="s6">&quot;code&quot;</span><span class="s2">, </span><span class="s6">&quot;s&quot;</span><span class="s2">}</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">markup</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
        <span class="s1">code_theme</span><span class="s2">: </span><span class="s1">str </span><span class="s2">= </span><span class="s6">&quot;monokai&quot;</span><span class="s2">,</span>
        <span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">style</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s1">Style </span><span class="s2">= </span><span class="s6">&quot;none&quot;</span><span class="s2">,</span>
        <span class="s1">hyperlinks</span><span class="s2">: </span><span class="s1">bool </span><span class="s2">= </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s1">inline_code_lexer</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">inline_code_theme</span><span class="s2">: </span><span class="s1">str </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">) </span><span class="s1">-&gt; </span><span class="s0">None</span><span class="s2">:</span>
        <span class="s1">parser </span><span class="s2">= </span><span class="s1">MarkdownIt</span><span class="s2">().</span><span class="s1">enable</span><span class="s2">(</span><span class="s6">&quot;strikethrough&quot;</span><span class="s2">).</span><span class="s1">enable</span><span class="s2">(</span><span class="s6">&quot;table&quot;</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">markup </span><span class="s2">= </span><span class="s1">markup</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">parsed </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">markup</span><span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">code_theme </span><span class="s2">= </span><span class="s1">code_theme</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">justify</span><span class="s2">: </span><span class="s1">JustifyMethod </span><span class="s2">| </span><span class="s0">None </span><span class="s2">= </span><span class="s1">justify</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">style </span><span class="s2">= </span><span class="s1">style</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">hyperlinks </span><span class="s2">= </span><span class="s1">hyperlinks</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">inline_code_lexer </span><span class="s2">= </span><span class="s1">inline_code_lexer</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">inline_code_theme </span><span class="s2">= </span><span class="s1">inline_code_theme </span><span class="s0">or </span><span class="s1">code_theme</span>

    <span class="s0">def </span><span class="s1">_flatten_tokens</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">tokens</span><span class="s2">: </span><span class="s1">Iterable</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">]) </span><span class="s1">-&gt; Iterable</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">]:</span>
        <span class="s5">&quot;&quot;&quot;Flattens the token stream.&quot;&quot;&quot;</span>
        <span class="s0">for </span><span class="s1">token </span><span class="s0">in </span><span class="s1">tokens</span><span class="s2">:</span>
            <span class="s1">is_fence </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s6">&quot;fence&quot;</span>
            <span class="s1">is_image </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">tag </span><span class="s2">== </span><span class="s6">&quot;img&quot;</span>
            <span class="s0">if </span><span class="s1">token</span><span class="s2">.</span><span class="s1">children </span><span class="s0">and not </span><span class="s2">(</span><span class="s1">is_image </span><span class="s0">or </span><span class="s1">is_fence</span><span class="s2">):</span>
                <span class="s0">yield from </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_flatten_tokens</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">children</span><span class="s2">)</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">yield </span><span class="s1">token</span>

    <span class="s0">def </span><span class="s1">__rich_console__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">, </span><span class="s1">console</span><span class="s2">: </span><span class="s1">Console</span><span class="s2">, </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ConsoleOptions</span>
    <span class="s2">) </span><span class="s1">-&gt; RenderResult</span><span class="s2">:</span>
        <span class="s5">&quot;&quot;&quot;Render markdown to the console.&quot;&quot;&quot;</span>
        <span class="s1">style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">style</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">height</span><span class="s2">=</span><span class="s0">None</span><span class="s2">)</span>
        <span class="s1">context </span><span class="s2">= </span><span class="s1">MarkdownContext</span><span class="s2">(</span>
            <span class="s1">console</span><span class="s2">,</span>
            <span class="s1">options</span><span class="s2">,</span>
            <span class="s1">style</span><span class="s2">,</span>
            <span class="s1">inline_code_lexer</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">inline_code_lexer</span><span class="s2">,</span>
            <span class="s1">inline_code_theme</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">inline_code_theme</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">tokens </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">parsed</span>
        <span class="s1">inline_style_tags </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">inlines</span>
        <span class="s1">new_line </span><span class="s2">= </span><span class="s0">False</span>
        <span class="s1">_new_line_segment </span><span class="s2">= </span><span class="s1">Segment</span><span class="s2">.</span><span class="s1">line</span><span class="s2">()</span>

        <span class="s0">for </span><span class="s1">token </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_flatten_tokens</span><span class="s2">(</span><span class="s1">tokens</span><span class="s2">):</span>
            <span class="s1">node_type </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type</span>
            <span class="s1">tag </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">tag</span>

            <span class="s1">entering </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">nesting </span><span class="s2">== </span><span class="s3">1</span>
            <span class="s1">exiting </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">nesting </span><span class="s2">== -</span><span class="s3">1</span>
            <span class="s1">self_closing </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">nesting </span><span class="s2">== </span><span class="s3">0</span>

            <span class="s0">if </span><span class="s1">node_type </span><span class="s2">== </span><span class="s6">&quot;text&quot;</span><span class="s2">:</span>
                <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">node_type </span><span class="s2">== </span><span class="s6">&quot;hardbreak&quot;</span><span class="s2">:</span>
                <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s6">&quot;</span><span class="s0">\n</span><span class="s6">&quot;</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">node_type </span><span class="s2">== </span><span class="s6">&quot;softbreak&quot;</span><span class="s2">:</span>
                <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s6">&quot; &quot;</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s1">node_type </span><span class="s2">== </span><span class="s6">&quot;link_open&quot;</span><span class="s2">:</span>
                <span class="s1">href </span><span class="s2">= </span><span class="s1">str</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">attrs</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s6">&quot;href&quot;</span><span class="s2">, </span><span class="s6">&quot;&quot;</span><span class="s2">))</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hyperlinks</span><span class="s2">:</span>
                    <span class="s1">link_style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s6">&quot;markdown.link_url&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>
                    <span class="s1">link_style </span><span class="s2">+= </span><span class="s1">Style</span><span class="s2">(</span><span class="s1">link</span><span class="s2">=</span><span class="s1">href</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">link_style</span><span class="s2">)</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">Link</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">token</span><span class="s2">))</span>
            <span class="s0">elif </span><span class="s1">node_type </span><span class="s2">== </span><span class="s6">&quot;link_close&quot;</span><span class="s2">:</span>
                <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">hyperlinks</span><span class="s2">:</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s1">element </span><span class="s2">= </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
                    <span class="s0">assert </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">Link</span><span class="s2">)</span>
                    <span class="s1">link_style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span><span class="s6">&quot;markdown.link&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">link_style</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">text</span><span class="s2">.</span><span class="s1">plain</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s6">&quot; (&quot;</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
                    <span class="s1">link_url_style </span><span class="s2">= </span><span class="s1">console</span><span class="s2">.</span><span class="s1">get_style</span><span class="s2">(</span>
                        <span class="s6">&quot;markdown.link_url&quot;</span><span class="s2">, </span><span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;none&quot;</span>
                    <span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s1">link_url_style</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">element</span><span class="s2">.</span><span class="s1">href</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s6">&quot;)&quot;</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
            <span class="s0">elif </span><span class="s2">(</span>
                <span class="s1">tag </span><span class="s0">in </span><span class="s1">inline_style_tags</span>
                <span class="s0">and </span><span class="s1">node_type </span><span class="s2">!= </span><span class="s6">&quot;fence&quot;</span>
                <span class="s0">and </span><span class="s1">node_type </span><span class="s2">!= </span><span class="s6">&quot;code_block&quot;</span>
            <span class="s2">):</span>
                <span class="s0">if </span><span class="s1">entering</span><span class="s2">:</span>
                    <span class="s4"># If it's an opening inline token e.g. strong, em, etc.</span>
                    <span class="s4"># Then we move into a style context i.e. push to stack.</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s6">f&quot;markdown.</span><span class="s0">{</span><span class="s1">tag</span><span class="s0">}</span><span class="s6">&quot;</span><span class="s2">)</span>
                <span class="s0">elif </span><span class="s1">exiting</span><span class="s2">:</span>
                    <span class="s4"># If it's a closing inline style, then we pop the style</span>
                    <span class="s4"># off of the stack, to move out of the context of it...</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>
                <span class="s0">else</span><span class="s2">:</span>
                    <span class="s4"># If it's a self-closing inline style e.g. `code_inline`</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">enter_style</span><span class="s2">(</span><span class="s6">f&quot;markdown.</span><span class="s0">{</span><span class="s1">tag</span><span class="s0">}</span><span class="s6">&quot;</span><span class="s2">)</span>
                    <span class="s0">if </span><span class="s1">token</span><span class="s2">.</span><span class="s1">content</span><span class="s2">:</span>
                        <span class="s1">context</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">content</span><span class="s2">, </span><span class="s1">node_type</span><span class="s2">)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">leave_style</span><span class="s2">()</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s4"># Map the markdown tag -&gt; MarkdownElement renderable</span>
                <span class="s1">element_class </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">.</span><span class="s1">get</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type</span><span class="s2">) </span><span class="s0">or </span><span class="s1">UnknownElement</span>
                <span class="s1">element </span><span class="s2">= </span><span class="s1">element_class</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">token</span><span class="s2">)</span>

                <span class="s0">if </span><span class="s1">entering </span><span class="s0">or </span><span class="s1">self_closing</span><span class="s2">:</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">element</span><span class="s2">)</span>
                    <span class="s1">element</span><span class="s2">.</span><span class="s1">on_enter</span><span class="s2">(</span><span class="s1">context</span><span class="s2">)</span>

                <span class="s0">if </span><span class="s1">exiting</span><span class="s2">:  </span><span class="s4"># CLOSING tag</span>
                    <span class="s1">element </span><span class="s2">= </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>

                    <span class="s1">should_render </span><span class="s2">= </span><span class="s0">not </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack </span><span class="s0">or </span><span class="s2">(</span>
                        <span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span>
                        <span class="s0">and </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">top</span><span class="s2">.</span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">context</span><span class="s2">, </span><span class="s1">element</span><span class="s2">)</span>
                    <span class="s2">)</span>

                    <span class="s0">if </span><span class="s1">should_render</span><span class="s2">:</span>
                        <span class="s0">if </span><span class="s1">new_line</span><span class="s2">:</span>
                            <span class="s0">yield </span><span class="s1">_new_line_segment</span>

                        <span class="s0">yield from </span><span class="s1">console</span><span class="s2">.</span><span class="s1">render</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">context</span><span class="s2">.</span><span class="s1">options</span><span class="s2">)</span>
                <span class="s0">elif </span><span class="s1">self_closing</span><span class="s2">:  </span><span class="s4"># SELF-CLOSING tags (e.g. text, code, image)</span>
                    <span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">()</span>
                    <span class="s1">text </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">content</span>
                    <span class="s0">if </span><span class="s1">text </span><span class="s0">is not None</span><span class="s2">:</span>
                        <span class="s1">element</span><span class="s2">.</span><span class="s1">on_text</span><span class="s2">(</span><span class="s1">context</span><span class="s2">, </span><span class="s1">text</span><span class="s2">)</span>

                    <span class="s1">should_render </span><span class="s2">= (</span>
                        <span class="s0">not </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span>
                        <span class="s0">or </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span>
                        <span class="s0">and </span><span class="s1">context</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">top</span><span class="s2">.</span><span class="s1">on_child_close</span><span class="s2">(</span><span class="s1">context</span><span class="s2">, </span><span class="s1">element</span><span class="s2">)</span>
                    <span class="s2">)</span>
                    <span class="s0">if </span><span class="s1">should_render</span><span class="s2">:</span>
                        <span class="s0">if </span><span class="s1">new_line </span><span class="s0">and </span><span class="s1">node_type </span><span class="s2">!= </span><span class="s6">&quot;inline&quot;</span><span class="s2">:</span>
                            <span class="s0">yield </span><span class="s1">_new_line_segment</span>
                        <span class="s0">yield from </span><span class="s1">console</span><span class="s2">.</span><span class="s1">render</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">context</span><span class="s2">.</span><span class="s1">options</span><span class="s2">)</span>

                <span class="s0">if </span><span class="s1">exiting </span><span class="s0">or </span><span class="s1">self_closing</span><span class="s2">:</span>
                    <span class="s1">element</span><span class="s2">.</span><span class="s1">on_leave</span><span class="s2">(</span><span class="s1">context</span><span class="s2">)</span>
                    <span class="s1">new_line </span><span class="s2">= </span><span class="s1">element</span><span class="s2">.</span><span class="s1">new_line</span>


<span class="s0">if </span><span class="s1">__name__ </span><span class="s2">== </span><span class="s6">&quot;__main__&quot;</span><span class="s2">:  </span><span class="s4"># pragma: no cover</span>
    <span class="s0">import </span><span class="s1">argparse</span>
    <span class="s0">import </span><span class="s1">sys</span>

    <span class="s1">parser </span><span class="s2">= </span><span class="s1">argparse</span><span class="s2">.</span><span class="s1">ArgumentParser</span><span class="s2">(</span>
        <span class="s1">description</span><span class="s2">=</span><span class="s6">&quot;Render Markdown to the console with Rich&quot;</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;path&quot;</span><span class="s2">,</span>
        <span class="s1">metavar</span><span class="s2">=</span><span class="s6">&quot;PATH&quot;</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;path to markdown file, or - for stdin&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-c&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--force-color&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;force_color&quot;</span><span class="s2">,</span>
        <span class="s1">action</span><span class="s2">=</span><span class="s6">&quot;store_true&quot;</span><span class="s2">,</span>
        <span class="s1">default</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;force color for non-terminals&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-t&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--code-theme&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;code_theme&quot;</span><span class="s2">,</span>
        <span class="s1">default</span><span class="s2">=</span><span class="s6">&quot;monokai&quot;</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;pygments code theme&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-i&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--inline-code-lexer&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;inline_code_lexer&quot;</span><span class="s2">,</span>
        <span class="s1">default</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;inline_code_lexer&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-y&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--hyperlinks&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;hyperlinks&quot;</span><span class="s2">,</span>
        <span class="s1">action</span><span class="s2">=</span><span class="s6">&quot;store_true&quot;</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;enable hyperlinks&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-w&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--width&quot;</span><span class="s2">,</span>
        <span class="s1">type</span><span class="s2">=</span><span class="s1">int</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;width&quot;</span><span class="s2">,</span>
        <span class="s1">default</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;width of output (default will auto-detect)&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-j&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--justify&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;justify&quot;</span><span class="s2">,</span>
        <span class="s1">action</span><span class="s2">=</span><span class="s6">&quot;store_true&quot;</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;enable full text justify&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">parser</span><span class="s2">.</span><span class="s1">add_argument</span><span class="s2">(</span>
        <span class="s6">&quot;-p&quot;</span><span class="s2">,</span>
        <span class="s6">&quot;--page&quot;</span><span class="s2">,</span>
        <span class="s1">dest</span><span class="s2">=</span><span class="s6">&quot;page&quot;</span><span class="s2">,</span>
        <span class="s1">action</span><span class="s2">=</span><span class="s6">&quot;store_true&quot;</span><span class="s2">,</span>
        <span class="s1">help</span><span class="s2">=</span><span class="s6">&quot;use pager to scroll output&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s1">args </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse_args</span><span class="s2">()</span>

    <span class="s0">from </span><span class="s1">rich</span><span class="s2">.</span><span class="s1">console </span><span class="s0">import </span><span class="s1">Console</span>

    <span class="s0">if </span><span class="s1">args</span><span class="s2">.</span><span class="s1">path </span><span class="s2">== </span><span class="s6">&quot;-&quot;</span><span class="s2">:</span>
        <span class="s1">markdown_body </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">stdin</span><span class="s2">.</span><span class="s1">read</span><span class="s2">()</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">with </span><span class="s1">open</span><span class="s2">(</span><span class="s1">args</span><span class="s2">.</span><span class="s1">path</span><span class="s2">, </span><span class="s1">encoding</span><span class="s2">=</span><span class="s6">&quot;utf-8&quot;</span><span class="s2">) </span><span class="s0">as </span><span class="s1">markdown_file</span><span class="s2">:</span>
            <span class="s1">markdown_body </span><span class="s2">= </span><span class="s1">markdown_file</span><span class="s2">.</span><span class="s1">read</span><span class="s2">()</span>

    <span class="s1">markdown </span><span class="s2">= </span><span class="s1">Markdown</span><span class="s2">(</span>
        <span class="s1">markdown_body</span><span class="s2">,</span>
        <span class="s1">justify</span><span class="s2">=</span><span class="s6">&quot;full&quot; </span><span class="s0">if </span><span class="s1">args</span><span class="s2">.</span><span class="s1">justify </span><span class="s0">else </span><span class="s6">&quot;left&quot;</span><span class="s2">,</span>
        <span class="s1">code_theme</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">code_theme</span><span class="s2">,</span>
        <span class="s1">hyperlinks</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">hyperlinks</span><span class="s2">,</span>
        <span class="s1">inline_code_lexer</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">inline_code_lexer</span><span class="s2">,</span>
    <span class="s2">)</span>
    <span class="s0">if </span><span class="s1">args</span><span class="s2">.</span><span class="s1">page</span><span class="s2">:</span>
        <span class="s0">import </span><span class="s1">io</span>
        <span class="s0">import </span><span class="s1">pydoc</span>

        <span class="s1">fileio </span><span class="s2">= </span><span class="s1">io</span><span class="s2">.</span><span class="s1">StringIO</span><span class="s2">()</span>
        <span class="s1">console </span><span class="s2">= </span><span class="s1">Console</span><span class="s2">(</span>
            <span class="s1">file</span><span class="s2">=</span><span class="s1">fileio</span><span class="s2">, </span><span class="s1">force_terminal</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">force_color</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">width</span>
        <span class="s2">)</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s1">markdown</span><span class="s2">)</span>
        <span class="s1">pydoc</span><span class="s2">.</span><span class="s1">pager</span><span class="s2">(</span><span class="s1">fileio</span><span class="s2">.</span><span class="s1">getvalue</span><span class="s2">())</span>

    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">console </span><span class="s2">= </span><span class="s1">Console</span><span class="s2">(</span>
            <span class="s1">force_terminal</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">force_color</span><span class="s2">, </span><span class="s1">width</span><span class="s2">=</span><span class="s1">args</span><span class="s2">.</span><span class="s1">width</span><span class="s2">, </span><span class="s1">record</span><span class="s2">=</span><span class="s0">True</span>
        <span class="s2">)</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">print</span><span class="s2">(</span><span class="s1">markdown</span><span class="s2">)</span>
</pre>
</body>
</html>