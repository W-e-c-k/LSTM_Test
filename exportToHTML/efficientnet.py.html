<html>
<head>
<title>efficientnet.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
efficientnet.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">copy</span>
<span class="s0">import </span><span class="s1">math</span>

<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src </span><span class="s0">import </span><span class="s1">backend</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src </span><span class="s0">import </span><span class="s1">layers</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">api_export </span><span class="s0">import </span><span class="s1">keras_export</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">applications </span><span class="s0">import </span><span class="s1">imagenet_utils</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">models </span><span class="s0">import </span><span class="s1">Functional</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">ops </span><span class="s0">import </span><span class="s1">operation_utils</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">utils </span><span class="s0">import </span><span class="s1">file_utils</span>

<span class="s1">BASE_WEIGHTS_PATH </span><span class="s2">= </span><span class="s3">&quot;https://storage.googleapis.com/keras-applications/&quot;</span>

<span class="s1">WEIGHTS_HASHES </span><span class="s2">= {</span>
    <span class="s3">&quot;b0&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;902e53a9f72be733fc0bcb005b3ebbac&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;50bc09e76180e00e4465e1a485ddc09d&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b1&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;1d254153d4ab51201f1646940f018540&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;74c4e6b3e1f6a1eea24c589628592432&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b2&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;b15cce36ff4dcbd00b6dd88e7857a6ad&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;111f8e2ac8aa800a7a99e3239f7bfb39&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b3&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;ffd1fdc53d0ce67064dc6a9c7960ede0&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;af6d107764bb5b1abb91932881670226&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b4&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;18c95ad55216b8f92d7e70b3a046e2fc&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;ebc24e6d6c33eaebbd558eafbeedf1ba&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b5&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;ace28f2a6363774853a83a0b21b9421a&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;38879255a25d3c92d5e44e04ae6cec6f&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b6&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;165f6e37dce68623721b423839de8be5&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;9ecce42647a20130c1f39a5d4cb75743&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
    <span class="s3">&quot;b7&quot;</span><span class="s2">: (</span>
        <span class="s3">&quot;8c03f828fec3ef71311cd463b6759d99&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;cbcfe4450ddf6f3ad90b1b398090fe4a&quot;</span><span class="s2">,</span>
    <span class="s2">),</span>
<span class="s2">}</span>

<span class="s1">DEFAULT_BLOCKS_ARGS </span><span class="s2">= [</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">32</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">16</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">16</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">24</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">5</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">24</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">40</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">40</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">80</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">5</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">80</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">112</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">5</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">4</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">112</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">192</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">2</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
    <span class="s2">{</span>
        <span class="s3">&quot;kernel_size&quot;</span><span class="s2">: </span><span class="s4">3</span><span class="s2">,</span>
        <span class="s3">&quot;repeats&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;filters_in&quot;</span><span class="s2">: </span><span class="s4">192</span><span class="s2">,</span>
        <span class="s3">&quot;filters_out&quot;</span><span class="s2">: </span><span class="s4">320</span><span class="s2">,</span>
        <span class="s3">&quot;expand_ratio&quot;</span><span class="s2">: </span><span class="s4">6</span><span class="s2">,</span>
        <span class="s3">&quot;id_skip&quot;</span><span class="s2">: </span><span class="s0">True</span><span class="s2">,</span>
        <span class="s3">&quot;strides&quot;</span><span class="s2">: </span><span class="s4">1</span><span class="s2">,</span>
        <span class="s3">&quot;se_ratio&quot;</span><span class="s2">: </span><span class="s4">0.25</span><span class="s2">,</span>
    <span class="s2">},</span>
<span class="s2">]</span>

<span class="s1">CONV_KERNEL_INITIALIZER </span><span class="s2">= {</span>
    <span class="s3">&quot;class_name&quot;</span><span class="s2">: </span><span class="s3">&quot;VarianceScaling&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;config&quot;</span><span class="s2">: {</span>
        <span class="s3">&quot;scale&quot;</span><span class="s2">: </span><span class="s4">2.0</span><span class="s2">,</span>
        <span class="s3">&quot;mode&quot;</span><span class="s2">: </span><span class="s3">&quot;fan_out&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;distribution&quot;</span><span class="s2">: </span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">,</span>
    <span class="s2">},</span>
<span class="s2">}</span>

<span class="s1">DENSE_KERNEL_INITIALIZER </span><span class="s2">= {</span>
    <span class="s3">&quot;class_name&quot;</span><span class="s2">: </span><span class="s3">&quot;VarianceScaling&quot;</span><span class="s2">,</span>
    <span class="s3">&quot;config&quot;</span><span class="s2">: {</span>
        <span class="s3">&quot;scale&quot;</span><span class="s2">: </span><span class="s4">1.0 </span><span class="s2">/ </span><span class="s4">3.0</span><span class="s2">,</span>
        <span class="s3">&quot;mode&quot;</span><span class="s2">: </span><span class="s3">&quot;fan_out&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;distribution&quot;</span><span class="s2">: </span><span class="s3">&quot;uniform&quot;</span><span class="s2">,</span>
    <span class="s2">},</span>
<span class="s2">}</span>

<span class="s1">BASE_DOCSTRING </span><span class="s2">= </span><span class="s3">&quot;&quot;&quot;Instantiates the {name} architecture. 
 
Reference: 
- [EfficientNet: Rethinking Model Scaling for Convolutional Neural Networks]( 
    https://arxiv.org/abs/1905.11946) (ICML 2019) 
 
This function returns a Keras image classification model, 
optionally loaded with weights pre-trained on ImageNet. 
 
For image classification use cases, see 
[this page for detailed examples]( 
https://keras.io/api/applications/#usage-examples-for-image-classification-models). 
 
For transfer learning use cases, make sure to read the 
[guide to transfer learning &amp; fine-tuning]( 
https://keras.io/guides/transfer_learning/). 
 
Note: each Keras Application expects a specific kind of input preprocessing. 
For EfficientNet, input preprocessing is included as part of the model 
(as a `Rescaling` layer), and thus 
`keras.applications.efficientnet.preprocess_input` is actually a 
pass-through function. EfficientNet models expect their inputs to be float 
tensors of pixels with values in the `[0-255]` range. 
 
Args: 
    include_top: Whether to include the fully-connected 
        layer at the top of the network. Defaults to `True`. 
    weights: One of `None` (random initialization), 
        `&quot;imagenet&quot;` (pre-training on ImageNet), 
        or the path to the weights file to be loaded. 
        Defaults to `&quot;imagenet&quot;`. 
    input_tensor: Optional Keras tensor 
        (i.e. output of `layers.Input()`) 
        to use as image input for the model. 
    input_shape: Optional shape tuple, only to be specified 
        if `include_top` is False. 
        It should have exactly 3 inputs channels. 
    pooling: Optional pooling mode for feature extraction 
        when `include_top` is `False`. Defaults to `None`. 
        - `None` means that the output of the model will be 
            the 4D tensor output of the 
            last convolutional layer. 
        - `avg` means that global average pooling 
            will be applied to the output of the 
            last convolutional layer, and thus 
            the output of the model will be a 2D tensor. 
        - `max` means that global max pooling will 
            be applied. 
    classes: Optional number of classes to classify images 
        into, only to be specified if `include_top` is True, and 
        if no `weights` argument is specified. 1000 is how many 
        ImageNet classes there are. Defaults to `1000`. 
    classifier_activation: A `str` or callable. The activation function to use 
        on the &quot;top&quot; layer. Ignored unless `include_top=True`. Set 
        `classifier_activation=None` to return the logits of the &quot;top&quot; layer. 
        Defaults to `'softmax'`. 
        When loading pretrained weights, `classifier_activation` can only 
        be `None` or `&quot;softmax&quot;`. 
    name: The name of the model (string). 
 
Returns: 
    A model instance. 
&quot;&quot;&quot;</span>


<span class="s1">IMAGENET_STDDEV_RGB </span><span class="s2">= [</span><span class="s4">0.229</span><span class="s2">, </span><span class="s4">0.224</span><span class="s2">, </span><span class="s4">0.225</span><span class="s2">]</span>


<span class="s0">def </span><span class="s1">EfficientNet</span><span class="s2">(</span>
    <span class="s1">width_coefficient</span><span class="s2">,</span>
    <span class="s1">depth_coefficient</span><span class="s2">,</span>
    <span class="s1">default_size</span><span class="s2">,</span>
    <span class="s1">dropout_rate</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">,</span>
    <span class="s1">drop_connect_rate</span><span class="s2">=</span><span class="s4">0.2</span><span class="s2">,</span>
    <span class="s1">depth_divisor</span><span class="s2">=</span><span class="s4">8</span><span class="s2">,</span>
    <span class="s1">activation</span><span class="s2">=</span><span class="s3">&quot;swish&quot;</span><span class="s2">,</span>
    <span class="s1">blocks_args</span><span class="s2">=</span><span class="s3">&quot;default&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnet&quot;</span><span class="s2">,</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">weights_name</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;Instantiates the EfficientNet architecture. 
 
    Args: 
      width_coefficient: float, scaling coefficient for network width. 
      depth_coefficient: float, scaling coefficient for network depth. 
      default_size: integer, default input image size. 
      dropout_rate: float, dropout rate before final classifier layer. 
      drop_connect_rate: float, dropout rate at skip connections. 
      depth_divisor: integer, a unit of network width. 
      activation: activation function. 
      blocks_args: list of dicts, parameters to construct block modules. 
      name: string, model name. 
      include_top: whether to include the fully-connected 
          layer at the top of the network. 
      weights: one of `None` (random initialization), 
            'imagenet' (pre-training on ImageNet), 
            or the path to the weights file to be loaded. 
      input_tensor: optional Keras tensor 
          (i.e. output of `layers.Input()`) 
          to use as image input for the model. 
      input_shape: optional shape tuple, only to be specified 
          if `include_top` is False. 
          It should have exactly 3 inputs channels. 
      pooling: optional pooling mode for feature extraction 
          when `include_top` is `False`. 
          - `None` means that the output of the model will be 
              the 4D tensor output of the 
              last convolutional layer. 
          - `avg` means that global average pooling 
              will be applied to the output of the 
              last convolutional layer, and thus 
              the output of the model will be a 2D tensor. 
          - `max` means that global max pooling will 
              be applied. 
      classes: optional number of classes to classify images 
          into, only to be specified if `include_top` is True, and 
          if no `weights` argument is specified. 
      classifier_activation: A `str` or callable. The activation function to use 
          on the &quot;top&quot; layer. Ignored unless `include_top=True`. Set 
          `classifier_activation=None` to return the logits of the &quot;top&quot; layer. 
 
    Returns: 
        A model instance. 
    &quot;&quot;&quot;</span>
    <span class="s0">if </span><span class="s1">blocks_args </span><span class="s2">== </span><span class="s3">&quot;default&quot;</span><span class="s2">:</span>
        <span class="s1">blocks_args </span><span class="s2">= </span><span class="s1">DEFAULT_BLOCKS_ARGS</span>

    <span class="s0">if not </span><span class="s2">(</span><span class="s1">weights </span><span class="s0">in </span><span class="s2">{</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">, </span><span class="s0">None</span><span class="s2">} </span><span class="s0">or </span><span class="s1">file_utils</span><span class="s2">.</span><span class="s1">exists</span><span class="s2">(</span><span class="s1">weights</span><span class="s2">)):</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
            <span class="s3">&quot;The `weights` argument should be either &quot;</span>
            <span class="s3">&quot;`None` (random initialization), `imagenet` &quot;</span>
            <span class="s3">&quot;(pre-training on ImageNet), &quot;</span>
            <span class="s3">&quot;or the path to the weights file to be loaded.&quot;</span>
        <span class="s2">)</span>

    <span class="s0">if </span><span class="s1">weights </span><span class="s2">== </span><span class="s3">&quot;imagenet&quot; </span><span class="s0">and </span><span class="s1">include_top </span><span class="s0">and </span><span class="s1">classes </span><span class="s2">!= </span><span class="s4">1000</span><span class="s2">:</span>
        <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
            <span class="s3">'If using `weights=&quot;imagenet&quot;` with `include_top`'</span>
            <span class="s3">&quot; as true, `classes` should be 1000&quot;</span>
        <span class="s2">)</span>

    <span class="s6"># Determine proper input shape</span>
    <span class="s1">input_shape </span><span class="s2">= </span><span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">obtain_input_shape</span><span class="s2">(</span>
        <span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">default_size</span><span class="s2">=</span><span class="s1">default_size</span><span class="s2">,</span>
        <span class="s1">min_size</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
        <span class="s1">data_format</span><span class="s2">=</span><span class="s1">backend</span><span class="s2">.</span><span class="s1">image_data_format</span><span class="s2">(),</span>
        <span class="s1">require_flatten</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
    <span class="s2">)</span>

    <span class="s0">if </span><span class="s1">input_tensor </span><span class="s0">is None</span><span class="s2">:</span>
        <span class="s1">img_input </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Input</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">if not </span><span class="s1">backend</span><span class="s2">.</span><span class="s1">is_keras_tensor</span><span class="s2">(</span><span class="s1">input_tensor</span><span class="s2">):</span>
            <span class="s1">img_input </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Input</span><span class="s2">(</span><span class="s1">tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">img_input </span><span class="s2">= </span><span class="s1">input_tensor</span>

    <span class="s1">bn_axis </span><span class="s2">= </span><span class="s4">3 </span><span class="s0">if </span><span class="s1">backend</span><span class="s2">.</span><span class="s1">image_data_format</span><span class="s2">() == </span><span class="s3">&quot;channels_last&quot; </span><span class="s0">else </span><span class="s4">1</span>

    <span class="s0">def </span><span class="s1">round_filters</span><span class="s2">(</span><span class="s1">filters</span><span class="s2">, </span><span class="s1">divisor</span><span class="s2">=</span><span class="s1">depth_divisor</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot;Round number of filters based on depth multiplier.&quot;&quot;&quot;</span>
        <span class="s1">filters </span><span class="s2">*= </span><span class="s1">width_coefficient</span>
        <span class="s1">new_filters </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span>
            <span class="s1">divisor</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">filters </span><span class="s2">+ </span><span class="s1">divisor </span><span class="s2">/ </span><span class="s4">2</span><span class="s2">) // </span><span class="s1">divisor </span><span class="s2">* </span><span class="s1">divisor</span>
        <span class="s2">)</span>
        <span class="s6"># Make sure that round down does not go down by more than 10%.</span>
        <span class="s0">if </span><span class="s1">new_filters </span><span class="s2">&lt; </span><span class="s4">0.9 </span><span class="s2">* </span><span class="s1">filters</span><span class="s2">:</span>
            <span class="s1">new_filters </span><span class="s2">+= </span><span class="s1">divisor</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">new_filters</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">round_repeats</span><span class="s2">(</span><span class="s1">repeats</span><span class="s2">):</span>
        <span class="s5">&quot;&quot;&quot;Round number of repeats based on depth multiplier.&quot;&quot;&quot;</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">math</span><span class="s2">.</span><span class="s1">ceil</span><span class="s2">(</span><span class="s1">depth_coefficient </span><span class="s2">* </span><span class="s1">repeats</span><span class="s2">))</span>

    <span class="s6"># Build stem</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">img_input</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Rescaling</span><span class="s2">(</span><span class="s4">1.0 </span><span class="s2">/ </span><span class="s4">255.0</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Normalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">weights </span><span class="s2">== </span><span class="s3">&quot;imagenet&quot;</span><span class="s2">:</span>
        <span class="s6"># Note that the normaliztion layer uses square value of STDDEV as the</span>
        <span class="s6"># variance for the layer: result = (input - mean) / sqrt(var)</span>
        <span class="s6"># However, the original implemenetation uses (input - mean) / var to</span>
        <span class="s6"># normalize the input, we need to divide another sqrt(var) to match the</span>
        <span class="s6"># original implementation.</span>
        <span class="s6"># See https://github.com/tensorflow/tensorflow/issues/49930 for more</span>
        <span class="s6"># details</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Rescaling</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s4">1.0 </span><span class="s2">/ </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">stddev</span><span class="s2">) </span><span class="s0">for </span><span class="s1">stddev </span><span class="s0">in </span><span class="s1">IMAGENET_STDDEV_RGB</span><span class="s2">]</span>
        <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">ZeroPadding2D</span><span class="s2">(</span>
        <span class="s1">padding</span><span class="s2">=</span><span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">correct_pad</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s4">3</span><span class="s2">), </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;stem_conv_pad&quot;</span>
    <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
        <span class="s1">round_filters</span><span class="s2">(</span><span class="s4">32</span><span class="s2">),</span>
        <span class="s4">3</span><span class="s2">,</span>
        <span class="s1">strides</span><span class="s2">=</span><span class="s4">2</span><span class="s2">,</span>
        <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;valid&quot;</span><span class="s2">,</span>
        <span class="s1">use_bias</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
        <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;stem_conv&quot;</span><span class="s2">,</span>
    <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">BatchNormalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;stem_bn&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Activation</span><span class="s2">(</span><span class="s1">activation</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;stem_activation&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s6"># Build blocks</span>
    <span class="s1">blocks_args </span><span class="s2">= </span><span class="s1">copy</span><span class="s2">.</span><span class="s1">deepcopy</span><span class="s2">(</span><span class="s1">blocks_args</span><span class="s2">)</span>

    <span class="s1">b </span><span class="s2">= </span><span class="s4">0</span>
    <span class="s1">blocks </span><span class="s2">= </span><span class="s1">float</span><span class="s2">(</span><span class="s1">sum</span><span class="s2">(</span><span class="s1">round_repeats</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;repeats&quot;</span><span class="s2">]) </span><span class="s0">for </span><span class="s1">args </span><span class="s0">in </span><span class="s1">blocks_args</span><span class="s2">))</span>
    <span class="s0">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">args </span><span class="s0">in </span><span class="s1">enumerate</span><span class="s2">(</span><span class="s1">blocks_args</span><span class="s2">):</span>
        <span class="s0">assert </span><span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;repeats&quot;</span><span class="s2">] &gt; </span><span class="s4">0</span>
        <span class="s6"># Update block input and output filters based on depth multiplier.</span>
        <span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_in&quot;</span><span class="s2">] = </span><span class="s1">round_filters</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_in&quot;</span><span class="s2">])</span>
        <span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_out&quot;</span><span class="s2">] = </span><span class="s1">round_filters</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_out&quot;</span><span class="s2">])</span>

        <span class="s0">for </span><span class="s1">j </span><span class="s0">in </span><span class="s1">range</span><span class="s2">(</span><span class="s1">round_repeats</span><span class="s2">(</span><span class="s1">args</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(</span><span class="s3">&quot;repeats&quot;</span><span class="s2">))):</span>
            <span class="s6"># The first block needs to take care of stride and filter size</span>
            <span class="s6"># increase.</span>
            <span class="s0">if </span><span class="s1">j </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">:</span>
                <span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;strides&quot;</span><span class="s2">] = </span><span class="s4">1</span>
                <span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_in&quot;</span><span class="s2">] = </span><span class="s1">args</span><span class="s2">[</span><span class="s3">&quot;filters_out&quot;</span><span class="s2">]</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">block</span><span class="s2">(</span>
                <span class="s1">x</span><span class="s2">,</span>
                <span class="s1">activation</span><span class="s2">,</span>
                <span class="s1">drop_connect_rate </span><span class="s2">* </span><span class="s1">b </span><span class="s2">/ </span><span class="s1">blocks</span><span class="s2">,</span>
                <span class="s1">name</span><span class="s2">=</span><span class="s3">f&quot;block</span><span class="s0">{</span><span class="s1">i </span><span class="s2">+ </span><span class="s4">1</span><span class="s0">}{</span><span class="s1">chr</span><span class="s2">(</span><span class="s1">j </span><span class="s2">+ </span><span class="s4">97</span><span class="s2">)</span><span class="s0">}</span><span class="s3">_&quot;</span><span class="s2">,</span>
                <span class="s2">**</span><span class="s1">args</span><span class="s2">,</span>
            <span class="s2">)</span>
            <span class="s1">b </span><span class="s2">+= </span><span class="s4">1</span>

    <span class="s6"># Build top</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
        <span class="s1">round_filters</span><span class="s2">(</span><span class="s4">1280</span><span class="s2">),</span>
        <span class="s4">1</span><span class="s2">,</span>
        <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;same&quot;</span><span class="s2">,</span>
        <span class="s1">use_bias</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
        <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;top_conv&quot;</span><span class="s2">,</span>
    <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">BatchNormalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;top_bn&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Activation</span><span class="s2">(</span><span class="s1">activation</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;top_activation&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">include_top</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">GlobalAveragePooling2D</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;avg_pool&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">dropout_rate </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Dropout</span><span class="s2">(</span><span class="s1">dropout_rate</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;top_dropout&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">validate_activation</span><span class="s2">(</span><span class="s1">classifier_activation</span><span class="s2">, </span><span class="s1">weights</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Dense</span><span class="s2">(</span>
            <span class="s1">classes</span><span class="s2">,</span>
            <span class="s1">activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
            <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">DENSE_KERNEL_INITIALIZER</span><span class="s2">,</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;predictions&quot;</span><span class="s2">,</span>
        <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">pooling </span><span class="s2">== </span><span class="s3">&quot;avg&quot;</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">GlobalAveragePooling2D</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;avg_pool&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">pooling </span><span class="s2">== </span><span class="s3">&quot;max&quot;</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">GlobalMaxPooling2D</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;max_pool&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s6"># Ensure that the model takes into account</span>
    <span class="s6"># any potential predecessors of `input_tensor`.</span>
    <span class="s0">if </span><span class="s1">input_tensor </span><span class="s0">is not None</span><span class="s2">:</span>
        <span class="s1">inputs </span><span class="s2">= </span><span class="s1">operation_utils</span><span class="s2">.</span><span class="s1">get_source_inputs</span><span class="s2">(</span><span class="s1">input_tensor</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">inputs </span><span class="s2">= </span><span class="s1">img_input</span>

    <span class="s6"># Create model.</span>
    <span class="s1">model </span><span class="s2">= </span><span class="s1">Functional</span><span class="s2">(</span><span class="s1">inputs</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">)</span>

    <span class="s6"># Load weights.</span>
    <span class="s0">if </span><span class="s1">weights </span><span class="s2">== </span><span class="s3">&quot;imagenet&quot;</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">include_top</span><span class="s2">:</span>
            <span class="s1">file_suffix </span><span class="s2">= </span><span class="s3">&quot;.h5&quot;</span>
            <span class="s1">file_hash </span><span class="s2">= </span><span class="s1">WEIGHTS_HASHES</span><span class="s2">[</span><span class="s1">weights_name</span><span class="s2">][</span><span class="s4">0</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">file_suffix </span><span class="s2">= </span><span class="s3">&quot;_notop.h5&quot;</span>
            <span class="s1">file_hash </span><span class="s2">= </span><span class="s1">WEIGHTS_HASHES</span><span class="s2">[</span><span class="s1">weights_name</span><span class="s2">][</span><span class="s4">1</span><span class="s2">]</span>
        <span class="s1">file_name </span><span class="s2">= </span><span class="s1">name </span><span class="s2">+ </span><span class="s1">file_suffix</span>
        <span class="s1">weights_path </span><span class="s2">= </span><span class="s1">file_utils</span><span class="s2">.</span><span class="s1">get_file</span><span class="s2">(</span>
            <span class="s1">file_name</span><span class="s2">,</span>
            <span class="s1">BASE_WEIGHTS_PATH </span><span class="s2">+ </span><span class="s1">file_name</span><span class="s2">,</span>
            <span class="s1">cache_subdir</span><span class="s2">=</span><span class="s3">&quot;models&quot;</span><span class="s2">,</span>
            <span class="s1">file_hash</span><span class="s2">=</span><span class="s1">file_hash</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">model</span><span class="s2">.</span><span class="s1">load_weights</span><span class="s2">(</span><span class="s1">weights_path</span><span class="s2">)</span>
    <span class="s0">elif </span><span class="s1">weights </span><span class="s0">is not None</span><span class="s2">:</span>
        <span class="s1">model</span><span class="s2">.</span><span class="s1">load_weights</span><span class="s2">(</span><span class="s1">weights</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">model</span>


<span class="s0">def </span><span class="s1">block</span><span class="s2">(</span>
    <span class="s1">inputs</span><span class="s2">,</span>
    <span class="s1">activation</span><span class="s2">=</span><span class="s3">&quot;swish&quot;</span><span class="s2">,</span>
    <span class="s1">drop_rate</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;&quot;</span><span class="s2">,</span>
    <span class="s1">filters_in</span><span class="s2">=</span><span class="s4">32</span><span class="s2">,</span>
    <span class="s1">filters_out</span><span class="s2">=</span><span class="s4">16</span><span class="s2">,</span>
    <span class="s1">kernel_size</span><span class="s2">=</span><span class="s4">3</span><span class="s2">,</span>
    <span class="s1">strides</span><span class="s2">=</span><span class="s4">1</span><span class="s2">,</span>
    <span class="s1">expand_ratio</span><span class="s2">=</span><span class="s4">1</span><span class="s2">,</span>
    <span class="s1">se_ratio</span><span class="s2">=</span><span class="s4">0.0</span><span class="s2">,</span>
    <span class="s1">id_skip</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;An inverted residual block. 
 
    Args: 
        inputs: input tensor. 
        activation: activation function. 
        drop_rate: float between 0 and 1, fraction of the input units to drop. 
        name: string, block label. 
        filters_in: integer, the number of input filters. 
        filters_out: integer, the number of output filters. 
        kernel_size: integer, the dimension of the convolution window. 
        strides: integer, the stride of the convolution. 
        expand_ratio: integer, scaling coefficient for the input filters. 
        se_ratio: float between 0 and 1, fraction to squeeze the input filters. 
        id_skip: boolean. 
 
    Returns: 
        output tensor for the block. 
    &quot;&quot;&quot;</span>
    <span class="s1">bn_axis </span><span class="s2">= </span><span class="s4">3 </span><span class="s0">if </span><span class="s1">backend</span><span class="s2">.</span><span class="s1">image_data_format</span><span class="s2">() == </span><span class="s3">&quot;channels_last&quot; </span><span class="s0">else </span><span class="s4">1</span>

    <span class="s6"># Expansion phase</span>
    <span class="s1">filters </span><span class="s2">= </span><span class="s1">filters_in </span><span class="s2">* </span><span class="s1">expand_ratio</span>
    <span class="s0">if </span><span class="s1">expand_ratio </span><span class="s2">!= </span><span class="s4">1</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
            <span class="s1">filters</span><span class="s2">,</span>
            <span class="s4">1</span><span class="s2">,</span>
            <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;same&quot;</span><span class="s2">,</span>
            <span class="s1">use_bias</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
            <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;expand_conv&quot;</span><span class="s2">,</span>
        <span class="s2">)(</span><span class="s1">inputs</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">BatchNormalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;expand_bn&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Activation</span><span class="s2">(</span><span class="s1">activation</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;expand_activation&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">inputs</span>

    <span class="s6"># Depthwise Convolution</span>
    <span class="s0">if </span><span class="s1">strides </span><span class="s2">== </span><span class="s4">2</span><span class="s2">:</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">ZeroPadding2D</span><span class="s2">(</span>
            <span class="s1">padding</span><span class="s2">=</span><span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">correct_pad</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">kernel_size</span><span class="s2">),</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;dwconv_pad&quot;</span><span class="s2">,</span>
        <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">conv_pad </span><span class="s2">= </span><span class="s3">&quot;valid&quot;</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s1">conv_pad </span><span class="s2">= </span><span class="s3">&quot;same&quot;</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">DepthwiseConv2D</span><span class="s2">(</span>
        <span class="s1">kernel_size</span><span class="s2">,</span>
        <span class="s1">strides</span><span class="s2">=</span><span class="s1">strides</span><span class="s2">,</span>
        <span class="s1">padding</span><span class="s2">=</span><span class="s1">conv_pad</span><span class="s2">,</span>
        <span class="s1">use_bias</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
        <span class="s1">depthwise_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;dwconv&quot;</span><span class="s2">,</span>
    <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">BatchNormalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;bn&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Activation</span><span class="s2">(</span><span class="s1">activation</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;activation&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>

    <span class="s6"># Squeeze and Excitation phase</span>
    <span class="s0">if </span><span class="s4">0 </span><span class="s2">&lt; </span><span class="s1">se_ratio </span><span class="s2">&lt;= </span><span class="s4">1</span><span class="s2">:</span>
        <span class="s1">filters_se </span><span class="s2">= </span><span class="s1">max</span><span class="s2">(</span><span class="s4">1</span><span class="s2">, </span><span class="s1">int</span><span class="s2">(</span><span class="s1">filters_in </span><span class="s2">* </span><span class="s1">se_ratio</span><span class="s2">))</span>
        <span class="s1">se </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">GlobalAveragePooling2D</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;se_squeeze&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">bn_axis </span><span class="s2">== </span><span class="s4">1</span><span class="s2">:</span>
            <span class="s1">se_shape </span><span class="s2">= (</span><span class="s1">filters</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">se_shape </span><span class="s2">= (</span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s1">filters</span><span class="s2">)</span>
        <span class="s1">se </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Reshape</span><span class="s2">(</span><span class="s1">se_shape</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;se_reshape&quot;</span><span class="s2">)(</span><span class="s1">se</span><span class="s2">)</span>
        <span class="s1">se </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
            <span class="s1">filters_se</span><span class="s2">,</span>
            <span class="s4">1</span><span class="s2">,</span>
            <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;same&quot;</span><span class="s2">,</span>
            <span class="s1">activation</span><span class="s2">=</span><span class="s1">activation</span><span class="s2">,</span>
            <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;se_reduce&quot;</span><span class="s2">,</span>
        <span class="s2">)(</span><span class="s1">se</span><span class="s2">)</span>
        <span class="s1">se </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
            <span class="s1">filters</span><span class="s2">,</span>
            <span class="s4">1</span><span class="s2">,</span>
            <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;same&quot;</span><span class="s2">,</span>
            <span class="s1">activation</span><span class="s2">=</span><span class="s3">&quot;sigmoid&quot;</span><span class="s2">,</span>
            <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
            <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;se_expand&quot;</span><span class="s2">,</span>
        <span class="s2">)(</span><span class="s1">se</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">multiply</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">se</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;se_excite&quot;</span><span class="s2">)</span>

    <span class="s6"># Output phase</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Conv2D</span><span class="s2">(</span>
        <span class="s1">filters_out</span><span class="s2">,</span>
        <span class="s4">1</span><span class="s2">,</span>
        <span class="s1">padding</span><span class="s2">=</span><span class="s3">&quot;same&quot;</span><span class="s2">,</span>
        <span class="s1">use_bias</span><span class="s2">=</span><span class="s0">False</span><span class="s2">,</span>
        <span class="s1">kernel_initializer</span><span class="s2">=</span><span class="s1">CONV_KERNEL_INITIALIZER</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;project_conv&quot;</span><span class="s2">,</span>
    <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">BatchNormalization</span><span class="s2">(</span><span class="s1">axis</span><span class="s2">=</span><span class="s1">bn_axis</span><span class="s2">, </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;project_bn&quot;</span><span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">id_skip </span><span class="s0">and </span><span class="s1">strides </span><span class="s2">== </span><span class="s4">1 </span><span class="s0">and </span><span class="s1">filters_in </span><span class="s2">== </span><span class="s1">filters_out</span><span class="s2">:</span>
        <span class="s0">if </span><span class="s1">drop_rate </span><span class="s2">&gt; </span><span class="s4">0</span><span class="s2">:</span>
            <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">Dropout</span><span class="s2">(</span>
                <span class="s1">drop_rate</span><span class="s2">, </span><span class="s1">noise_shape</span><span class="s2">=(</span><span class="s0">None</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">, </span><span class="s4">1</span><span class="s2">), </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;drop&quot;</span>
            <span class="s2">)(</span><span class="s1">x</span><span class="s2">)</span>
        <span class="s1">x </span><span class="s2">= </span><span class="s1">layers</span><span class="s2">.</span><span class="s1">add</span><span class="s2">([</span><span class="s1">x</span><span class="s2">, </span><span class="s1">inputs</span><span class="s2">], </span><span class="s1">name</span><span class="s2">=</span><span class="s1">name </span><span class="s2">+ </span><span class="s3">&quot;add&quot;</span><span class="s2">)</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB0&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB0&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB0</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb0&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.0</span><span class="s2">,</span>
        <span class="s4">1.0</span><span class="s2">,</span>
        <span class="s4">224</span><span class="s2">,</span>
        <span class="s4">0.2</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b0&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB1&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB1&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB1</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb1&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.0</span><span class="s2">,</span>
        <span class="s4">1.1</span><span class="s2">,</span>
        <span class="s4">240</span><span class="s2">,</span>
        <span class="s4">0.2</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b1&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB2&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB2&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB2</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb2&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.1</span><span class="s2">,</span>
        <span class="s4">1.2</span><span class="s2">,</span>
        <span class="s4">260</span><span class="s2">,</span>
        <span class="s4">0.3</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b2&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB3&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB3&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB3</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb3&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.2</span><span class="s2">,</span>
        <span class="s4">1.4</span><span class="s2">,</span>
        <span class="s4">300</span><span class="s2">,</span>
        <span class="s4">0.3</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b3&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB4&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB4&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB4</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb4&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.4</span><span class="s2">,</span>
        <span class="s4">1.8</span><span class="s2">,</span>
        <span class="s4">380</span><span class="s2">,</span>
        <span class="s4">0.4</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b4&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB5&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB5&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB5</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb5&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.6</span><span class="s2">,</span>
        <span class="s4">2.2</span><span class="s2">,</span>
        <span class="s4">456</span><span class="s2">,</span>
        <span class="s4">0.4</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b5&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB6&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB6&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB6</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb6&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">1.8</span><span class="s2">,</span>
        <span class="s4">2.6</span><span class="s2">,</span>
        <span class="s4">528</span><span class="s2">,</span>
        <span class="s4">0.5</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b6&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.applications.efficientnet.EfficientNetB7&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.applications.EfficientNetB7&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">def </span><span class="s1">EfficientNetB7</span><span class="s2">(</span>
    <span class="s1">include_top</span><span class="s2">=</span><span class="s0">True</span><span class="s2">,</span>
    <span class="s1">weights</span><span class="s2">=</span><span class="s3">&quot;imagenet&quot;</span><span class="s2">,</span>
    <span class="s1">input_tensor</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">input_shape</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">pooling</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s1">classes</span><span class="s2">=</span><span class="s4">1000</span><span class="s2">,</span>
    <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s3">&quot;softmax&quot;</span><span class="s2">,</span>
    <span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;efficientnetb7&quot;</span><span class="s2">,</span>
<span class="s2">):</span>
    <span class="s0">return </span><span class="s1">EfficientNet</span><span class="s2">(</span>
        <span class="s4">2.0</span><span class="s2">,</span>
        <span class="s4">3.1</span><span class="s2">,</span>
        <span class="s4">600</span><span class="s2">,</span>
        <span class="s4">0.5</span><span class="s2">,</span>
        <span class="s1">name</span><span class="s2">=</span><span class="s1">name</span><span class="s2">,</span>
        <span class="s1">include_top</span><span class="s2">=</span><span class="s1">include_top</span><span class="s2">,</span>
        <span class="s1">weights</span><span class="s2">=</span><span class="s1">weights</span><span class="s2">,</span>
        <span class="s1">input_tensor</span><span class="s2">=</span><span class="s1">input_tensor</span><span class="s2">,</span>
        <span class="s1">input_shape</span><span class="s2">=</span><span class="s1">input_shape</span><span class="s2">,</span>
        <span class="s1">pooling</span><span class="s2">=</span><span class="s1">pooling</span><span class="s2">,</span>
        <span class="s1">classes</span><span class="s2">=</span><span class="s1">classes</span><span class="s2">,</span>
        <span class="s1">classifier_activation</span><span class="s2">=</span><span class="s1">classifier_activation</span><span class="s2">,</span>
        <span class="s1">weights_name</span><span class="s2">=</span><span class="s3">&quot;b7&quot;</span><span class="s2">,</span>
    <span class="s2">)</span>


<span class="s1">EfficientNetB0</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB0&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB1</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB1&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB2</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB2&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB3</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB3&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB4</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB4&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB5</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB5&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB6</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB6&quot;</span><span class="s2">)</span>
<span class="s1">EfficientNetB7</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">BASE_DOCSTRING</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span><span class="s1">name</span><span class="s2">=</span><span class="s3">&quot;EfficientNetB7&quot;</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span><span class="s3">&quot;keras.applications.efficientnet.preprocess_input&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">preprocess_input</span><span class="s2">(</span><span class="s1">x</span><span class="s2">, </span><span class="s1">data_format</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
    <span class="s5">&quot;&quot;&quot;A placeholder method for backward compatibility. 
 
    The preprocessing logic has been included in the efficientnet model 
    implementation. Users are no longer required to call this method to 
    normalize the input data. This method does nothing and only kept as a 
    placeholder to align the API surface between old and new version of model. 
 
    Args: 
        x: A floating point `numpy.array` or a tensor. 
        data_format: Optional data format of the image tensor/array. `None` 
            means the global setting `keras.backend.image_data_format()` 
            is used (unless you changed it, it uses `&quot;channels_last&quot;`). 
            Defaults to `None`. 
 
    Returns: 
        Unchanged `numpy.array` or tensor. 
    &quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">x</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span><span class="s3">&quot;keras.applications.efficientnet.decode_predictions&quot;</span><span class="s2">)</span>
<span class="s0">def </span><span class="s1">decode_predictions</span><span class="s2">(</span><span class="s1">preds</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s4">5</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">decode_predictions</span><span class="s2">(</span><span class="s1">preds</span><span class="s2">, </span><span class="s1">top</span><span class="s2">=</span><span class="s1">top</span><span class="s2">)</span>


<span class="s1">decode_predictions</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">imagenet_utils</span><span class="s2">.</span><span class="s1">decode_predictions</span><span class="s2">.</span><span class="s1">__doc__</span>
</pre>
</body>
</html>