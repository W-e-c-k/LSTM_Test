<html>
<head>
<title>_client_adaptations.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #2aacb8;}
.s6 { color: #6aab73;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_client_adaptations.py</font>
</center></td></tr></table>
<pre><span class="s0"># Copyright 2016 gRPC authors.</span>
<span class="s0">#</span>
<span class="s0"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s0"># you may not use this file except in compliance with the License.</span>
<span class="s0"># You may obtain a copy of the License at</span>
<span class="s0">#</span>
<span class="s0">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="s0">#</span>
<span class="s0"># Unless required by applicable law or agreed to in writing, software</span>
<span class="s0"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s0"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s0"># See the License for the specific language governing permissions and</span>
<span class="s0"># limitations under the License.</span>
<span class="s2">&quot;&quot;&quot;Translates gRPC's client-side API into gRPC's client-side Beta API.&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">grpc</span>
<span class="s3">from </span><span class="s1">grpc </span><span class="s3">import </span><span class="s1">_common</span>
<span class="s3">from </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">beta </span><span class="s3">import </span><span class="s1">_metadata</span>
<span class="s3">from </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">beta </span><span class="s3">import </span><span class="s1">interfaces</span>
<span class="s3">from </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">framework</span><span class="s4">.</span><span class="s1">common </span><span class="s3">import </span><span class="s1">cardinality</span>
<span class="s3">from </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">framework</span><span class="s4">.</span><span class="s1">foundation </span><span class="s3">import </span><span class="s1">future</span>
<span class="s3">from </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">framework</span><span class="s4">.</span><span class="s1">interfaces</span><span class="s4">.</span><span class="s1">face </span><span class="s3">import </span><span class="s1">face</span>

<span class="s0"># pylint: disable=too-many-arguments,too-many-locals,unused-argument</span>

<span class="s1">_STATUS_CODE_TO_ABORTION_KIND_AND_ABORTION_ERROR_CLASS </span><span class="s4">= {</span>
    <span class="s1">grpc</span><span class="s4">.</span><span class="s1">StatusCode</span><span class="s4">.</span><span class="s1">CANCELLED</span><span class="s4">: (</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">.</span><span class="s1">Kind</span><span class="s4">.</span><span class="s1">CANCELLED</span><span class="s4">,</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">CancellationError</span><span class="s4">,</span>
    <span class="s4">),</span>
    <span class="s1">grpc</span><span class="s4">.</span><span class="s1">StatusCode</span><span class="s4">.</span><span class="s1">UNKNOWN</span><span class="s4">: (</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">.</span><span class="s1">Kind</span><span class="s4">.</span><span class="s1">REMOTE_FAILURE</span><span class="s4">,</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">RemoteError</span><span class="s4">,</span>
    <span class="s4">),</span>
    <span class="s1">grpc</span><span class="s4">.</span><span class="s1">StatusCode</span><span class="s4">.</span><span class="s1">DEADLINE_EXCEEDED</span><span class="s4">: (</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">.</span><span class="s1">Kind</span><span class="s4">.</span><span class="s1">EXPIRED</span><span class="s4">,</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">ExpirationError</span><span class="s4">,</span>
    <span class="s4">),</span>
    <span class="s1">grpc</span><span class="s4">.</span><span class="s1">StatusCode</span><span class="s4">.</span><span class="s1">UNIMPLEMENTED</span><span class="s4">: (</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">.</span><span class="s1">Kind</span><span class="s4">.</span><span class="s1">LOCAL_FAILURE</span><span class="s4">,</span>
        <span class="s1">face</span><span class="s4">.</span><span class="s1">LocalError</span><span class="s4">,</span>
    <span class="s4">),</span>
<span class="s4">}</span>


<span class="s3">def </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">):</span>
    <span class="s1">non_none_metadata </span><span class="s4">= () </span><span class="s3">if </span><span class="s1">metadata </span><span class="s3">is None else </span><span class="s1">metadata</span>
    <span class="s3">if </span><span class="s1">metadata_transformer </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s1">non_none_metadata</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s1">metadata_transformer</span><span class="s4">(</span><span class="s1">non_none_metadata</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">grpc_call_options</span><span class="s4">):</span>
    <span class="s3">return None if </span><span class="s1">grpc_call_options </span><span class="s3">is None else </span><span class="s1">grpc_call_options</span><span class="s4">.</span><span class="s1">credentials</span>


<span class="s3">def </span><span class="s1">_abortion</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">):</span>
    <span class="s1">code </span><span class="s4">= </span><span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">code</span><span class="s4">()</span>
    <span class="s1">pair </span><span class="s4">= </span><span class="s1">_STATUS_CODE_TO_ABORTION_KIND_AND_ABORTION_ERROR_CLASS</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s1">code</span><span class="s4">)</span>
    <span class="s1">error_kind </span><span class="s4">= </span><span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">.</span><span class="s1">Kind</span><span class="s4">.</span><span class="s1">LOCAL_FAILURE </span><span class="s3">if </span><span class="s1">pair </span><span class="s3">is None else </span><span class="s1">pair</span><span class="s4">[</span><span class="s5">0</span><span class="s4">]</span>
    <span class="s3">return </span><span class="s1">face</span><span class="s4">.</span><span class="s1">Abortion</span><span class="s4">(</span>
        <span class="s1">error_kind</span><span class="s4">,</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">initial_metadata</span><span class="s4">(),</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">trailing_metadata</span><span class="s4">(),</span>
        <span class="s1">code</span><span class="s4">,</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">details</span><span class="s4">(),</span>
    <span class="s4">)</span>


<span class="s3">def </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">):</span>
    <span class="s1">code </span><span class="s4">= </span><span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">code</span><span class="s4">()</span>
    <span class="s1">pair </span><span class="s4">= </span><span class="s1">_STATUS_CODE_TO_ABORTION_KIND_AND_ABORTION_ERROR_CLASS</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s1">code</span><span class="s4">)</span>
    <span class="s1">exception_class </span><span class="s4">= </span><span class="s1">face</span><span class="s4">.</span><span class="s1">AbortionError </span><span class="s3">if </span><span class="s1">pair </span><span class="s3">is None else </span><span class="s1">pair</span><span class="s4">[</span><span class="s5">1</span><span class="s4">]</span>
    <span class="s3">return </span><span class="s1">exception_class</span><span class="s4">(</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">initial_metadata</span><span class="s4">(),</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">trailing_metadata</span><span class="s4">(),</span>
        <span class="s1">code</span><span class="s4">,</span>
        <span class="s1">rpc_error_call</span><span class="s4">.</span><span class="s1">details</span><span class="s4">(),</span>
    <span class="s4">)</span>


<span class="s3">class </span><span class="s1">_InvocationProtocolContext</span><span class="s4">(</span><span class="s1">interfaces</span><span class="s4">.</span><span class="s1">GRPCInvocationContext</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">disable_next_request_compression</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">pass  </span><span class="s0"># TODO(https://github.com/grpc/grpc/issues/4078): design, implement.</span>


<span class="s3">class </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s1">future</span><span class="s4">.</span><span class="s1">Future</span><span class="s4">, </span><span class="s1">face</span><span class="s4">.</span><span class="s1">Call</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">response_future</span><span class="s4">, </span><span class="s1">response_iterator</span><span class="s4">, </span><span class="s1">call</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_future </span><span class="s4">= </span><span class="s1">response_future</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_iterator </span><span class="s4">= </span><span class="s1">response_iterator</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_call </span><span class="s4">= </span><span class="s1">call</span>

    <span class="s3">def </span><span class="s1">cancel</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">cancel</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">cancelled</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">cancelled</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">running</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">running</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">done</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">done</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">result</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">result</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">RpcError </span><span class="s3">as </span><span class="s1">rpc_error_call</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureTimeoutError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">TimeoutError</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureCancelledError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">CancelledError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">exception</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s1">rpc_error_call </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">exception</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">)</span>
            <span class="s3">if </span><span class="s1">rpc_error_call </span><span class="s3">is None</span><span class="s4">:</span>
                <span class="s3">return None</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s3">return </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureTimeoutError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">TimeoutError</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureCancelledError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">CancelledError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">traceback</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">traceback</span><span class="s4">(</span><span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureTimeoutError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">TimeoutError</span><span class="s4">()</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">FutureCancelledError</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">future</span><span class="s4">.</span><span class="s1">CancelledError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">add_done_callback</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">fn</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_future</span><span class="s4">.</span><span class="s1">add_done_callback</span><span class="s4">(</span><span class="s3">lambda </span><span class="s1">ignored_callback</span><span class="s4">: </span><span class="s1">fn</span><span class="s4">(</span><span class="s1">self</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">__iter__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span>

    <span class="s3">def </span><span class="s1">_next</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">next</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_iterator</span><span class="s4">)</span>
        <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">RpcError </span><span class="s3">as </span><span class="s1">rpc_error_call</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">__next__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_next</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">next</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_next</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">is_active</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">is_active</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">time_remaining</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">time_remaining</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">add_abortion_callback</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">abortion_callback</span><span class="s4">):</span>
        <span class="s3">def </span><span class="s1">done_callback</span><span class="s4">():</span>
            <span class="s3">if </span><span class="s1">self</span><span class="s4">.</span><span class="s1">code</span><span class="s4">() </span><span class="s3">is not </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">StatusCode</span><span class="s4">.</span><span class="s1">OK</span><span class="s4">:</span>
                <span class="s1">abortion_callback</span><span class="s4">(</span><span class="s1">_abortion</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">))</span>

        <span class="s1">registered </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">add_callback</span><span class="s4">(</span><span class="s1">done_callback</span><span class="s4">)</span>
        <span class="s3">return None if </span><span class="s1">registered </span><span class="s3">else </span><span class="s1">done_callback</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">protocol_context</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_InvocationProtocolContext</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">initial_metadata</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">beta</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">initial_metadata</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">terminal_metadata</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">beta</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">terminal_metadata</span><span class="s4">())</span>

    <span class="s3">def </span><span class="s1">code</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">code</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">details</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_call</span><span class="s4">.</span><span class="s1">details</span><span class="s4">()</span>


<span class="s3">def </span><span class="s1">_blocking_unary_unary</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">with_call</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">unary_unary</span><span class="s4">(</span>
            <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
            <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>
        <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">with_call</span><span class="s4">:</span>
            <span class="s1">response</span><span class="s4">, </span><span class="s1">call </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">.</span><span class="s1">with_call</span><span class="s4">(</span>
                <span class="s1">request</span><span class="s4">,</span>
                <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
                <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
                <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
            <span class="s4">)</span>
            <span class="s3">return </span><span class="s1">response</span><span class="s4">, </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s1">call</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">multi_callable</span><span class="s4">(</span>
                <span class="s1">request</span><span class="s4">,</span>
                <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
                <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
                <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
            <span class="s4">)</span>
    <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">RpcError </span><span class="s3">as </span><span class="s1">rpc_error_call</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_future_unary_unary</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">unary_unary</span><span class="s4">(</span>
        <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
        <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">)</span>
    <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
    <span class="s1">response_future </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">.</span><span class="s1">future</span><span class="s4">(</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
        <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
    <span class="s4">)</span>
    <span class="s3">return </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s1">response_future</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s1">response_future</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_unary_stream</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">unary_stream</span><span class="s4">(</span>
        <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
        <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">)</span>
    <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
    <span class="s1">response_iterator </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">(</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
        <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
    <span class="s4">)</span>
    <span class="s3">return </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s1">response_iterator</span><span class="s4">, </span><span class="s1">response_iterator</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_blocking_stream_unary</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">with_call</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request_iterator</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">stream_unary</span><span class="s4">(</span>
            <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
            <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>
        <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">with_call</span><span class="s4">:</span>
            <span class="s1">response</span><span class="s4">, </span><span class="s1">call </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">.</span><span class="s1">with_call</span><span class="s4">(</span>
                <span class="s1">request_iterator</span><span class="s4">,</span>
                <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
                <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
                <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
            <span class="s4">)</span>
            <span class="s3">return </span><span class="s1">response</span><span class="s4">, </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s1">call</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">multi_callable</span><span class="s4">(</span>
                <span class="s1">request_iterator</span><span class="s4">,</span>
                <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
                <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
                <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
            <span class="s4">)</span>
    <span class="s3">except </span><span class="s1">grpc</span><span class="s4">.</span><span class="s1">RpcError </span><span class="s3">as </span><span class="s1">rpc_error_call</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">_abortion_error</span><span class="s4">(</span><span class="s1">rpc_error_call</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_future_stream_unary</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request_iterator</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">stream_unary</span><span class="s4">(</span>
        <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
        <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">)</span>
    <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
    <span class="s1">response_future </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">.</span><span class="s1">future</span><span class="s4">(</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
        <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
    <span class="s4">)</span>
    <span class="s3">return </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s1">response_future</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s1">response_future</span><span class="s4">)</span>


<span class="s3">def </span><span class="s1">_stream_stream</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">group</span><span class="s4">,</span>
    <span class="s1">method</span><span class="s4">,</span>
    <span class="s1">timeout</span><span class="s4">,</span>
    <span class="s1">protocol_options</span><span class="s4">,</span>
    <span class="s1">metadata</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request_iterator</span><span class="s4">,</span>
    <span class="s1">request_serializer</span><span class="s4">,</span>
    <span class="s1">response_deserializer</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s1">multi_callable </span><span class="s4">= </span><span class="s1">channel</span><span class="s4">.</span><span class="s1">stream_stream</span><span class="s4">(</span>
        <span class="s1">_common</span><span class="s4">.</span><span class="s1">fully_qualified_method</span><span class="s4">(</span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">),</span>
        <span class="s1">request_serializer</span><span class="s4">=</span><span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">=</span><span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">)</span>
    <span class="s1">effective_metadata </span><span class="s4">= </span><span class="s1">_effective_metadata</span><span class="s4">(</span><span class="s1">metadata</span><span class="s4">, </span><span class="s1">metadata_transformer</span><span class="s4">)</span>
    <span class="s1">response_iterator </span><span class="s4">= </span><span class="s1">multi_callable</span><span class="s4">(</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">=</span><span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s1">_metadata</span><span class="s4">.</span><span class="s1">unbeta</span><span class="s4">(</span><span class="s1">effective_metadata</span><span class="s4">),</span>
        <span class="s1">credentials</span><span class="s4">=</span><span class="s1">_credentials</span><span class="s4">(</span><span class="s1">protocol_options</span><span class="s4">),</span>
    <span class="s4">)</span>
    <span class="s3">return </span><span class="s1">_Rendezvous</span><span class="s4">(</span><span class="s3">None</span><span class="s4">, </span><span class="s1">response_iterator</span><span class="s4">, </span><span class="s1">response_iterator</span><span class="s4">)</span>


<span class="s3">class </span><span class="s1">_UnaryUnaryMultiCallable</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">UnaryUnaryMultiCallable</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel </span><span class="s4">= </span><span class="s1">channel</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_group </span><span class="s4">= </span><span class="s1">group</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_method </span><span class="s4">= </span><span class="s1">method</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer </span><span class="s4">= </span><span class="s1">metadata_transformer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer </span><span class="s4">= </span><span class="s1">request_serializer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer </span><span class="s4">= </span><span class="s1">response_deserializer</span>

    <span class="s3">def </span><span class="s1">__call__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">with_call</span><span class="s4">=</span><span class="s3">False</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_blocking_unary_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">with_call</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">future</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">request</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_future_unary_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">event</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>


<span class="s3">class </span><span class="s1">_UnaryStreamMultiCallable</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">UnaryStreamMultiCallable</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel </span><span class="s4">= </span><span class="s1">channel</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_group </span><span class="s4">= </span><span class="s1">group</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_method </span><span class="s4">= </span><span class="s1">method</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer </span><span class="s4">= </span><span class="s1">metadata_transformer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer </span><span class="s4">= </span><span class="s1">request_serializer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer </span><span class="s4">= </span><span class="s1">response_deserializer</span>

    <span class="s3">def </span><span class="s1">__call__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">request</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_unary_stream</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">event</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>


<span class="s3">class </span><span class="s1">_StreamUnaryMultiCallable</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">StreamUnaryMultiCallable</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel </span><span class="s4">= </span><span class="s1">channel</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_group </span><span class="s4">= </span><span class="s1">group</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_method </span><span class="s4">= </span><span class="s1">method</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer </span><span class="s4">= </span><span class="s1">metadata_transformer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer </span><span class="s4">= </span><span class="s1">request_serializer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer </span><span class="s4">= </span><span class="s1">response_deserializer</span>

    <span class="s3">def </span><span class="s1">__call__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">with_call</span><span class="s4">=</span><span class="s3">False</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_blocking_stream_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">with_call</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">future</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">, </span><span class="s1">request_iterator</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span>
    <span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_future_stream_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">event</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>


<span class="s3">class </span><span class="s1">_StreamStreamMultiCallable</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">StreamStreamMultiCallable</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializer</span><span class="s4">,</span>
        <span class="s1">response_deserializer</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel </span><span class="s4">= </span><span class="s1">channel</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_group </span><span class="s4">= </span><span class="s1">group</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_method </span><span class="s4">= </span><span class="s1">method</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer </span><span class="s4">= </span><span class="s1">metadata_transformer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer </span><span class="s4">= </span><span class="s1">request_serializer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer </span><span class="s4">= </span><span class="s1">response_deserializer</span>

    <span class="s3">def </span><span class="s1">__call__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">, </span><span class="s1">request_iterator</span><span class="s4">, </span><span class="s1">timeout</span><span class="s4">, </span><span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span>
    <span class="s4">):</span>
        <span class="s3">return </span><span class="s1">_stream_stream</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializer</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">event</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>


<span class="s3">class </span><span class="s1">_GenericStub</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">GenericStub</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializers</span><span class="s4">,</span>
        <span class="s1">response_deserializers</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel </span><span class="s4">= </span><span class="s1">channel</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer </span><span class="s4">= </span><span class="s1">metadata_transformer</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers </span><span class="s4">= </span><span class="s1">request_serializers </span><span class="s3">or </span><span class="s4">{}</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers </span><span class="s4">= </span><span class="s1">response_deserializers </span><span class="s3">or </span><span class="s4">{}</span>

    <span class="s3">def </span><span class="s1">blocking_unary_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">with_call</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_blocking_unary_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">with_call</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">future_unary_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_future_unary_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">inline_unary_stream</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_unary_stream</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">blocking_stream_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">with_call</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_blocking_stream_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">with_call</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">future_stream_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_future_stream_unary</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">inline_stream_stream</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request_iterator</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_stream_stream</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">timeout</span><span class="s4">,</span>
            <span class="s1">protocol_options</span><span class="s4">,</span>
            <span class="s1">metadata</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_iterator</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">event_unary_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">event_unary_stream</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">request</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">event_stream_unary</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">event_stream_stream</span><span class="s4">(</span>
        <span class="s1">self</span><span class="s4">,</span>
        <span class="s1">group</span><span class="s4">,</span>
        <span class="s1">method</span><span class="s4">,</span>
        <span class="s1">receiver</span><span class="s4">,</span>
        <span class="s1">abortion_callback</span><span class="s4">,</span>
        <span class="s1">timeout</span><span class="s4">,</span>
        <span class="s1">metadata</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
        <span class="s1">protocol_options</span><span class="s4">=</span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">unary_unary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_UnaryUnaryMultiCallable</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">unary_stream</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_UnaryStreamMultiCallable</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">stream_unary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_StreamUnaryMultiCallable</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">stream_stream</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">group</span><span class="s4">, </span><span class="s1">method</span><span class="s4">):</span>
        <span class="s1">request_serializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_request_serializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s1">response_deserializer </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_response_deserializers</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span>
            <span class="s4">(</span>
                <span class="s1">group</span><span class="s4">,</span>
                <span class="s1">method</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s4">)</span>
        <span class="s3">return </span><span class="s1">_StreamStreamMultiCallable</span><span class="s4">(</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_channel</span><span class="s4">,</span>
            <span class="s1">group</span><span class="s4">,</span>
            <span class="s1">method</span><span class="s4">,</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">_metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_serializer</span><span class="s4">,</span>
            <span class="s1">response_deserializer</span><span class="s4">,</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">__enter__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span>

    <span class="s3">def </span><span class="s1">__exit__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">exc_type</span><span class="s4">, </span><span class="s1">exc_val</span><span class="s4">, </span><span class="s1">exc_tb</span><span class="s4">):</span>
        <span class="s3">return False</span>


<span class="s3">class </span><span class="s1">_DynamicStub</span><span class="s4">(</span><span class="s1">face</span><span class="s4">.</span><span class="s1">DynamicStub</span><span class="s4">):</span>
    <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">backing_generic_stub</span><span class="s4">, </span><span class="s1">group</span><span class="s4">, </span><span class="s1">cardinalities</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_generic_stub </span><span class="s4">= </span><span class="s1">backing_generic_stub</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_group </span><span class="s4">= </span><span class="s1">group</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_cardinalities </span><span class="s4">= </span><span class="s1">cardinalities</span>

    <span class="s3">def </span><span class="s1">__getattr__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">attr</span><span class="s4">):</span>
        <span class="s1">method_cardinality </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_cardinalities</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s1">attr</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">method_cardinality </span><span class="s3">is </span><span class="s1">cardinality</span><span class="s4">.</span><span class="s1">Cardinality</span><span class="s4">.</span><span class="s1">UNARY_UNARY</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_generic_stub</span><span class="s4">.</span><span class="s1">unary_unary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">, </span><span class="s1">attr</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">method_cardinality </span><span class="s3">is </span><span class="s1">cardinality</span><span class="s4">.</span><span class="s1">Cardinality</span><span class="s4">.</span><span class="s1">UNARY_STREAM</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_generic_stub</span><span class="s4">.</span><span class="s1">unary_stream</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">, </span><span class="s1">attr</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">method_cardinality </span><span class="s3">is </span><span class="s1">cardinality</span><span class="s4">.</span><span class="s1">Cardinality</span><span class="s4">.</span><span class="s1">STREAM_UNARY</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_generic_stub</span><span class="s4">.</span><span class="s1">stream_unary</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">, </span><span class="s1">attr</span><span class="s4">)</span>
        <span class="s3">elif </span><span class="s1">method_cardinality </span><span class="s3">is </span><span class="s1">cardinality</span><span class="s4">.</span><span class="s1">Cardinality</span><span class="s4">.</span><span class="s1">STREAM_STREAM</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_generic_stub</span><span class="s4">.</span><span class="s1">stream_stream</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">_group</span><span class="s4">, </span><span class="s1">attr</span><span class="s4">)</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">AttributeError</span><span class="s4">(</span>
                <span class="s6">'_DynamicStub object has no attribute &quot;%s&quot;!' </span><span class="s4">% </span><span class="s1">attr</span>
            <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">__enter__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s1">self</span>

    <span class="s3">def </span><span class="s1">__exit__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">exc_type</span><span class="s4">, </span><span class="s1">exc_val</span><span class="s4">, </span><span class="s1">exc_tb</span><span class="s4">):</span>
        <span class="s3">return False</span>


<span class="s3">def </span><span class="s1">generic_stub</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">host</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request_serializers</span><span class="s4">,</span>
    <span class="s1">response_deserializers</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s3">return </span><span class="s1">_GenericStub</span><span class="s4">(</span>
        <span class="s1">channel</span><span class="s4">,</span>
        <span class="s1">metadata_transformer</span><span class="s4">,</span>
        <span class="s1">request_serializers</span><span class="s4">,</span>
        <span class="s1">response_deserializers</span><span class="s4">,</span>
    <span class="s4">)</span>


<span class="s3">def </span><span class="s1">dynamic_stub</span><span class="s4">(</span>
    <span class="s1">channel</span><span class="s4">,</span>
    <span class="s1">service</span><span class="s4">,</span>
    <span class="s1">cardinalities</span><span class="s4">,</span>
    <span class="s1">host</span><span class="s4">,</span>
    <span class="s1">metadata_transformer</span><span class="s4">,</span>
    <span class="s1">request_serializers</span><span class="s4">,</span>
    <span class="s1">response_deserializers</span><span class="s4">,</span>
<span class="s4">):</span>
    <span class="s3">return </span><span class="s1">_DynamicStub</span><span class="s4">(</span>
        <span class="s1">_GenericStub</span><span class="s4">(</span>
            <span class="s1">channel</span><span class="s4">,</span>
            <span class="s1">metadata_transformer</span><span class="s4">,</span>
            <span class="s1">request_serializers</span><span class="s4">,</span>
            <span class="s1">response_deserializers</span><span class="s4">,</span>
        <span class="s4">),</span>
        <span class="s1">service</span><span class="s4">,</span>
        <span class="s1">cardinalities</span><span class="s4">,</span>
    <span class="s4">)</span>
</pre>
</body>
</html>