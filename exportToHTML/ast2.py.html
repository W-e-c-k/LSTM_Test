<html>
<head>
<title>ast2.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #7a7e85;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
ast2.py</font>
</center></td></tr></table>
<pre><span class="s0">from </span><span class="s1">astn </span><span class="s0">import </span><span class="s1">AstToGAst</span><span class="s2">, </span><span class="s1">GAstToAst</span>
<span class="s0">import </span><span class="s1">ast</span>
<span class="s0">import </span><span class="s1">gast</span>


<span class="s0">class </span><span class="s1">Ast2ToGAst</span><span class="s2">(</span><span class="s1">AstToGAst</span><span class="s2">):</span>

    <span class="s3"># mod</span>
    <span class="s0">def </span><span class="s1">visit_Module</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Module</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s2">[]  </span><span class="s3"># type_ignores</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># stmt</span>
    <span class="s0">def </span><span class="s1">visit_FunctionDef</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">FunctionDef</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">decorator_list</span><span class="s2">),</span>
            <span class="s0">None</span><span class="s2">,  </span><span class="s3"># returns</span>
            <span class="s0">None</span><span class="s2">,  </span><span class="s3"># type_comment</span>
            <span class="s2">[],  </span><span class="s3"># type_params</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_ClassDef</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">ClassDef</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">bases</span><span class="s2">),</span>
            <span class="s2">[],  </span><span class="s3"># keywords</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">decorator_list</span><span class="s2">),</span>
            <span class="s2">[],  </span><span class="s3"># type_params</span>
        <span class="s2">)</span>

        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Assign</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Assign</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">targets</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">),</span>
            <span class="s0">None</span><span class="s2">,  </span><span class="s3"># type_comment</span>
        <span class="s2">)</span>

        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_For</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">For</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">target</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">iter</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">orelse</span><span class="s2">),</span>
            <span class="s2">[]  </span><span class="s3"># type_comment</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_With</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">With</span><span class="s2">(</span>
            <span class="s2">[</span><span class="s1">gast</span><span class="s2">.</span><span class="s1">withitem</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">context_expr</span><span class="s2">),</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">optional_vars</span><span class="s2">)</span>
            <span class="s2">)],</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s0">None</span><span class="s2">,  </span><span class="s3"># type_comment</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Raise</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">ntype </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type</span><span class="s2">)</span>
        <span class="s1">ninst </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">inst</span><span class="s2">)</span>
        <span class="s1">ntback </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">tback</span><span class="s2">)</span>

        <span class="s1">what </span><span class="s2">= </span><span class="s1">ntype</span>

        <span class="s0">if </span><span class="s1">ninst </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">what </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Call</span><span class="s2">(</span><span class="s1">ntype</span><span class="s2">, [</span><span class="s1">ninst</span><span class="s2">], [])</span>
            <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">what</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
            <span class="s1">what</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">what</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s0">if </span><span class="s1">ntback </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s1">attr </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Attribute</span><span class="s2">(</span><span class="s1">what</span><span class="s2">, </span><span class="s4">'with_traceback'</span><span class="s2">, </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Load</span><span class="s2">())</span>
            <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">attr</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
            <span class="s1">attr</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">attr</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>

            <span class="s1">what </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Call</span><span class="s2">(</span>
                <span class="s1">attr</span><span class="s2">,</span>
                <span class="s2">[</span><span class="s1">ntback</span><span class="s2">],</span>
                <span class="s2">[]</span>
            <span class="s2">)</span>
            <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">what</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
            <span class="s1">what</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">what</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Raise</span><span class="s2">(</span><span class="s1">what</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_TryExcept</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Try</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">handlers</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">orelse</span><span class="s2">),</span>
            <span class="s2">[]  </span><span class="s3"># finalbody</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_TryFinally</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Try</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s2">[],  </span><span class="s3"># handlers</span>
            <span class="s2">[],  </span><span class="s3"># orelse</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">finalbody</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># expr</span>

    <span class="s0">def </span><span class="s1">visit_Name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">id</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">ctx</span><span class="s2">),</span>
            <span class="s0">None</span><span class="s2">,</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Num</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Constant</span><span class="s2">(</span>
            <span class="s1">node</span><span class="s2">.</span><span class="s1">n</span><span class="s2">,</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Subscript</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_slice </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">)</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Subscript</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">),</span>
            <span class="s1">new_slice</span><span class="s2">,</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">ctx</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Ellipsis</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Constant</span><span class="s2">(</span>
            <span class="s1">Ellipsis</span><span class="s2">,</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">visit_ExtSlice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_dims </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">dims</span><span class="s2">)</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">(</span><span class="s1">new_dims</span><span class="s2">, </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Load</span><span class="s2">())</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Constant</span><span class="s2">(</span>
            <span class="s1">node</span><span class="s2">.</span><span class="s1">s</span><span class="s2">,</span>
            <span class="s0">None</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Call</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">starargs</span><span class="s2">:</span>
            <span class="s1">star </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Starred</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">starargs</span><span class="s2">), </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Load</span><span class="s2">())</span>
            <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">star</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
            <span class="s1">star</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">star</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
            <span class="s1">starred </span><span class="s2">= [</span><span class="s1">star</span><span class="s2">]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">starred </span><span class="s2">= []</span>

        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwargs</span><span class="s2">:</span>
            <span class="s1">kwargs </span><span class="s2">= [</span><span class="s1">gast</span><span class="s2">.</span><span class="s1">keyword</span><span class="s2">(</span><span class="s0">None</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwargs</span><span class="s2">))]</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">kwargs </span><span class="s2">= []</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Call</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">func</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">) + </span><span class="s1">starred</span><span class="s2">,</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">) + </span><span class="s1">kwargs</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_comprehension</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">comprehension</span><span class="s2">(</span>
            <span class="s1">target</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">target</span><span class="s2">),</span>
            <span class="s1">iter</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">iter</span><span class="s2">),</span>
            <span class="s1">ifs</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">ifs</span><span class="s2">),</span>
            <span class="s1">is_async</span><span class="s2">=</span><span class="s5">0</span><span class="s2">,</span>
        <span class="s2">)</span>
        <span class="s1">gast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># arguments</span>
    <span class="s0">def </span><span class="s1">visit_arguments</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s3"># missing locations for vararg and kwarg set at function level</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">:</span>
            <span class="s1">vararg </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">, </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Param</span><span class="s2">())</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">vararg </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwarg</span><span class="s2">:</span>
            <span class="s1">kwarg </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwarg</span><span class="s2">, </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Param</span><span class="s2">())</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">kwarg </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">:</span>
            <span class="s1">vararg </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">, </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Param</span><span class="s2">())</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">vararg </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">),</span>
            <span class="s2">[],  </span><span class="s3"># posonlyargs</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">vararg</span><span class="s2">),</span>
            <span class="s2">[],  </span><span class="s3"># kwonlyargs</span>
            <span class="s2">[],  </span><span class="s3"># kw_defaults</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">kwarg</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_alias</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">asname</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>


<span class="s0">class </span><span class="s1">GAstToAst2</span><span class="s2">(</span><span class="s1">GAstToAst</span><span class="s2">):</span>

    <span class="s3"># mod</span>
    <span class="s0">def </span><span class="s1">visit_Module</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Module</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">))</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># stmt</span>
    <span class="s0">def </span><span class="s1">visit_FunctionDef</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">FunctionDef</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">decorator_list</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s3"># because node.args doesn't have any location to copy from</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">:</span>
            <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">.</span><span class="s1">kwarg</span><span class="s2">:</span>
            <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">.</span><span class="s1">kwarg</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>

        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_ClassDef</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">ClassDef</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">bases</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">decorator_list</span><span class="s2">),</span>
        <span class="s2">)</span>

        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Assign</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Assign</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">targets</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">),</span>
        <span class="s2">)</span>

        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_For</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">For</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">target</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">iter</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">orelse</span><span class="s2">),</span>
        <span class="s2">)</span>

        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_With</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">With</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">items</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">context_expr</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">items</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">optional_vars</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Raise</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">, </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Call</span><span class="s2">) </span><span class="s0">and </span><span class="s1">\</span>
           <span class="s1">isinstance</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">.</span><span class="s1">func</span><span class="s2">, </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Attribute</span><span class="s2">) </span><span class="s0">and </span><span class="s1">\</span>
           <span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">.</span><span class="s1">func</span><span class="s2">.</span><span class="s1">attr </span><span class="s2">== </span><span class="s4">'with_traceback'</span><span class="s2">:</span>
            <span class="s1">raised </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">.</span><span class="s1">func</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
            <span class="s1">traceback </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">.</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">])</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">raised </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">exc</span><span class="s2">)</span>
            <span class="s1">traceback </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Raise</span><span class="s2">(</span><span class="s1">raised</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">traceback</span><span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Try</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">finalbody</span><span class="s2">:</span>
            <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">TryFinally</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">finalbody</span><span class="s2">)</span>
            <span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">TryExcept</span><span class="s2">(</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">),</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">handlers</span><span class="s2">),</span>
                <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">orelse</span><span class="s2">),</span>
            <span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># expr</span>

    <span class="s0">def </span><span class="s1">visit_Name</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">id</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">ctx</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Constant</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, (</span><span class="s1">bool</span><span class="s2">, </span><span class="s1">int</span><span class="s2">, </span><span class="s1">long</span><span class="s2">, </span><span class="s1">float</span><span class="s2">, </span><span class="s1">complex</span><span class="s2">)):</span>
            <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Num</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">node</span><span class="s2">.</span><span class="s1">value </span><span class="s0">is </span><span class="s1">Ellipsis</span><span class="s2">:</span>
            <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Ellipsis</span><span class="s2">()</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Str</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Subscript</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">adjust_slice</span><span class="s2">(</span><span class="s1">s</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, (</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Slice</span><span class="s2">, </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Ellipsis</span><span class="s2">)):</span>
                <span class="s0">return </span><span class="s1">s</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Index</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">, </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Tuple</span><span class="s2">):</span>
            <span class="s1">new_slice </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">ExtSlice</span><span class="s2">([</span><span class="s1">adjust_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">elt</span><span class="s2">))</span>
                                      <span class="s0">for </span><span class="s1">elt </span><span class="s0">in </span><span class="s1">node</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">elts</span><span class="s2">])</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">new_slice </span><span class="s2">= </span><span class="s1">adjust_slice</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">))</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_slice</span><span class="s2">, </span><span class="s1">node</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">)</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Subscript</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">),</span>
            <span class="s1">new_slice</span><span class="s2">,</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">ctx</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_lineno </span><span class="s2">= </span><span class="s1">new_node</span><span class="s2">.</span><span class="s1">end_col_offset </span><span class="s2">= </span><span class="s0">None</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_Call</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args </span><span class="s0">and </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">], </span><span class="s1">gast</span><span class="s2">.</span><span class="s1">Starred</span><span class="s2">):</span>
            <span class="s1">args </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">starargs </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">value</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">args </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span>
            <span class="s1">starargs </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s0">if </span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords </span><span class="s0">and </span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">arg </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s1">keywords </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">]</span>
            <span class="s1">kwargs </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">].</span><span class="s1">value</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">keywords </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">keywords</span>
            <span class="s1">kwargs </span><span class="s2">= </span><span class="s0">None</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Call</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">func</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">args</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">keywords</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">starargs</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_arg</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Name</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">Param</span><span class="s2">())</span>
        <span class="s1">ast</span><span class="s2">.</span><span class="s1">copy_location</span><span class="s2">(</span><span class="s1">new_node</span><span class="s2">, </span><span class="s1">node</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s3"># arguments</span>
    <span class="s0">def </span><span class="s1">visit_arguments</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">vararg </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg </span><span class="s0">and </span><span class="s1">node</span><span class="s2">.</span><span class="s1">vararg</span><span class="s2">.</span><span class="s1">id</span>
        <span class="s1">kwarg </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwarg </span><span class="s0">and </span><span class="s1">node</span><span class="s2">.</span><span class="s1">kwarg</span><span class="s2">.</span><span class="s1">id</span>

        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">args</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">vararg</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">kwarg</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">defaults</span><span class="s2">),</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>

    <span class="s0">def </span><span class="s1">visit_alias</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">):</span>
        <span class="s1">new_node </span><span class="s2">= </span><span class="s1">ast</span><span class="s2">.</span><span class="s1">alias</span><span class="s2">(</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">),</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">_visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">asname</span><span class="s2">)</span>
        <span class="s2">)</span>
        <span class="s0">return </span><span class="s1">new_node</span>


<span class="s0">def </span><span class="s1">ast_to_gast</span><span class="s2">(</span><span class="s1">node</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">Ast2ToGAst</span><span class="s2">().</span><span class="s1">visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">)</span>


<span class="s0">def </span><span class="s1">gast_to_ast</span><span class="s2">(</span><span class="s1">node</span><span class="s2">):</span>
    <span class="s0">return </span><span class="s1">GAstToAst2</span><span class="s2">().</span><span class="s1">visit</span><span class="s2">(</span><span class="s1">node</span><span class="s2">)</span>
</pre>
</body>
</html>