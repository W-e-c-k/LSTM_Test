<html>
<head>
<title>config.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
config.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
The config module holds package-wide configurables and provides 
a uniform API for working with them. 
 
Overview 
======== 
 
This module supports the following requirements: 
- options are referenced using keys in dot.notation, e.g. &quot;x.y.option - z&quot;. 
- keys are case-insensitive. 
- functions should accept partial/regex keys, when unambiguous. 
- options can be registered by modules at import time. 
- options can be registered at init-time (via core.config_init) 
- options have a default value, and (optionally) a description and 
  validation function associated with them. 
- options can be deprecated, in which case referencing them 
  should produce a warning. 
- deprecated options can optionally be rerouted to a replacement 
  so that accessing a deprecated option reroutes to a differently 
  named option. 
- options can be reset to their default value. 
- all option can be reset to their default value at once. 
- all options in a certain sub - namespace can be reset at once. 
- the user can set / get / reset or ask for the description of an option. 
- a developer can register and mark an option as deprecated. 
- you can register a callback to be invoked when the option value 
  is set or reset. Changing the stored value is considered misuse, but 
  is not verboten. 
 
Implementation 
============== 
 
- Data is stored using nested dictionaries, and should be accessed 
  through the provided API. 
 
- &quot;Registered options&quot; and &quot;Deprecated options&quot; have metadata associated 
  with them, which are stored in auxiliary dictionaries keyed on the 
  fully-qualified key, e.g. &quot;x.y.z.option&quot;. 
 
- the config_init module is imported by the package's __init__.py file. 
  placing any register_option() calls there will ensure those options 
  are available as soon as pandas is loaded. If you use register_option 
  in a module, it will only be available after that module is imported, 
  which you should be aware of. 
 
- `config_prefix` is a context_manager (for use with the `with` keyword) 
  which can save developers some typing, see the docstring. 
 
&quot;&quot;&quot;</span>

<span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">annotations</span>

<span class="s2">from </span><span class="s1">contextlib </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">ContextDecorator</span><span class="s3">,</span>
    <span class="s1">contextmanager</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">re</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">TYPE_CHECKING</span><span class="s3">,</span>
    <span class="s1">Any</span><span class="s3">,</span>
    <span class="s1">Callable</span><span class="s3">,</span>
    <span class="s1">Generic</span><span class="s3">,</span>
    <span class="s1">NamedTuple</span><span class="s3">,</span>
    <span class="s1">cast</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">import </span><span class="s1">warnings</span>

<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">_typing </span><span class="s2">import </span><span class="s3">(</span>
    <span class="s1">F</span><span class="s3">,</span>
    <span class="s1">T</span><span class="s3">,</span>
<span class="s3">)</span>
<span class="s2">from </span><span class="s1">pandas</span><span class="s3">.</span><span class="s1">util</span><span class="s3">.</span><span class="s1">_exceptions </span><span class="s2">import </span><span class="s1">find_stack_level</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">collections</span><span class="s3">.</span><span class="s1">abc </span><span class="s2">import </span><span class="s3">(</span>
        <span class="s1">Generator</span><span class="s3">,</span>
        <span class="s1">Iterable</span><span class="s3">,</span>
    <span class="s3">)</span>


<span class="s2">class </span><span class="s1">DeprecatedOption</span><span class="s3">(</span><span class="s1">NamedTuple</span><span class="s3">):</span>
    <span class="s1">key</span><span class="s3">: </span><span class="s1">str</span>
    <span class="s1">msg</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None</span>
    <span class="s1">rkey</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None</span>
    <span class="s1">removal_ver</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None</span>


<span class="s2">class </span><span class="s1">RegisteredOption</span><span class="s3">(</span><span class="s1">NamedTuple</span><span class="s3">):</span>
    <span class="s1">key</span><span class="s3">: </span><span class="s1">str</span>
    <span class="s1">defval</span><span class="s3">: </span><span class="s1">object</span>
    <span class="s1">doc</span><span class="s3">: </span><span class="s1">str</span>
    <span class="s1">validator</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">[[</span><span class="s1">object</span><span class="s3">], </span><span class="s1">Any</span><span class="s3">] | </span><span class="s2">None</span>
    <span class="s1">cb</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">[[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">Any</span><span class="s3">] | </span><span class="s2">None</span>


<span class="s4"># holds deprecated option metadata</span>
<span class="s1">_deprecated_options</span><span class="s3">: </span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">DeprecatedOption</span><span class="s3">] = {}</span>

<span class="s4"># holds registered option metadata</span>
<span class="s1">_registered_options</span><span class="s3">: </span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">RegisteredOption</span><span class="s3">] = {}</span>

<span class="s4"># holds the current values for registered options</span>
<span class="s1">_global_config</span><span class="s3">: </span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">] = {}</span>

<span class="s4"># keys which have a special meaning</span>
<span class="s1">_reserved_keys</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = [</span><span class="s5">&quot;all&quot;</span><span class="s3">]</span>


<span class="s2">class </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s1">AttributeError</span><span class="s3">, </span><span class="s1">KeyError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Exception raised for pandas.options. 
 
    Backwards compatible with KeyError checks. 
 
    Examples 
    -------- 
    &gt;&gt;&gt; pd.options.context 
    Traceback (most recent call last): 
    OptionError: No such option 
    &quot;&quot;&quot;</span>


<span class="s4">#</span>
<span class="s4"># User API</span>


<span class="s2">def </span><span class="s1">_get_single_key</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">: </span><span class="s1">bool</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s1">keys </span><span class="s3">= </span><span class="s1">_select_options</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">if not </span><span class="s1">silent</span><span class="s3">:</span>
            <span class="s1">_warn_if_deprecated</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">f&quot;No such keys(s): </span><span class="s2">{</span><span class="s1">repr</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) &gt; </span><span class="s6">1</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">&quot;Pattern matched multiple keys&quot;</span><span class="s3">)</span>
    <span class="s1">key </span><span class="s3">= </span><span class="s1">keys</span><span class="s3">[</span><span class="s6">0</span><span class="s3">]</span>

    <span class="s2">if not </span><span class="s1">silent</span><span class="s3">:</span>
        <span class="s1">_warn_if_deprecated</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>

    <span class="s1">key </span><span class="s3">= </span><span class="s1">_translate_key</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">key</span>


<span class="s2">def </span><span class="s1">_get_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">) </span><span class="s1">-&gt; Any</span><span class="s3">:</span>
    <span class="s1">key </span><span class="s3">= </span><span class="s1">_get_single_key</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">)</span>

    <span class="s4"># walk the nested dict</span>
    <span class="s1">root</span><span class="s3">, </span><span class="s1">k </span><span class="s3">= </span><span class="s1">_get_root</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">root</span><span class="s3">[</span><span class="s1">k</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">_set_option</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwargs</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s4"># must at least 1 arg deal with constraints later</span>
    <span class="s1">nargs </span><span class="s3">= </span><span class="s1">len</span><span class="s3">(</span><span class="s1">args</span><span class="s3">)</span>
    <span class="s2">if not </span><span class="s1">nargs </span><span class="s2">or </span><span class="s1">nargs </span><span class="s3">% </span><span class="s6">2 </span><span class="s3">!= </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">&quot;Must provide an even number of non-keyword arguments&quot;</span><span class="s3">)</span>

    <span class="s4"># default to false</span>
    <span class="s1">silent </span><span class="s3">= </span><span class="s1">kwargs</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">(</span><span class="s5">&quot;silent&quot;</span><span class="s3">, </span><span class="s2">False</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">kwargs</span><span class="s3">:</span>
        <span class="s1">kwarg </span><span class="s3">= </span><span class="s1">next</span><span class="s3">(</span><span class="s1">iter</span><span class="s3">(</span><span class="s1">kwargs</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()))</span>
        <span class="s2">raise </span><span class="s1">TypeError</span><span class="s3">(</span><span class="s5">f'_set_option() got an unexpected keyword argument &quot;</span><span class="s2">{</span><span class="s1">kwarg</span><span class="s2">}</span><span class="s5">&quot;'</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">k</span><span class="s3">, </span><span class="s1">v </span><span class="s2">in </span><span class="s1">zip</span><span class="s3">(</span><span class="s1">args</span><span class="s3">[::</span><span class="s6">2</span><span class="s3">], </span><span class="s1">args</span><span class="s3">[</span><span class="s6">1</span><span class="s3">::</span><span class="s6">2</span><span class="s3">]):</span>
        <span class="s1">key </span><span class="s3">= </span><span class="s1">_get_single_key</span><span class="s3">(</span><span class="s1">k</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">)</span>

        <span class="s1">o </span><span class="s3">= </span><span class="s1">_get_registered_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">o </span><span class="s2">and </span><span class="s1">o</span><span class="s3">.</span><span class="s1">validator</span><span class="s3">:</span>
            <span class="s1">o</span><span class="s3">.</span><span class="s1">validator</span><span class="s3">(</span><span class="s1">v</span><span class="s3">)</span>

        <span class="s4"># walk the nested dict</span>
        <span class="s1">root</span><span class="s3">, </span><span class="s1">k_root </span><span class="s3">= </span><span class="s1">_get_root</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
        <span class="s1">root</span><span class="s3">[</span><span class="s1">k_root</span><span class="s3">] = </span><span class="s1">v</span>

        <span class="s2">if </span><span class="s1">o</span><span class="s3">.</span><span class="s1">cb</span><span class="s3">:</span>
            <span class="s2">if </span><span class="s1">silent</span><span class="s3">:</span>
                <span class="s2">with </span><span class="s1">warnings</span><span class="s3">.</span><span class="s1">catch_warnings</span><span class="s3">(</span><span class="s1">record</span><span class="s3">=</span><span class="s2">True</span><span class="s3">):</span>
                    <span class="s1">o</span><span class="s3">.</span><span class="s1">cb</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">o</span><span class="s3">.</span><span class="s1">cb</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_describe_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;&quot;</span><span class="s3">, </span><span class="s1">_print_desc</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">True</span><span class="s3">) </span><span class="s1">-&gt; str </span><span class="s3">| </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s1">keys </span><span class="s3">= </span><span class="s1">_select_options</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">&quot;No such keys(s)&quot;</span><span class="s3">)</span>

    <span class="s1">s </span><span class="s3">= </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">([</span><span class="s1">_build_option_description</span><span class="s3">(</span><span class="s1">k</span><span class="s3">) </span><span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">keys</span><span class="s3">])</span>

    <span class="s2">if </span><span class="s1">_print_desc</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s1">s</span><span class="s3">)</span>
        <span class="s2">return None</span>
    <span class="s2">return </span><span class="s1">s</span>


<span class="s2">def </span><span class="s1">_reset_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s1">keys </span><span class="s3">= </span><span class="s1">_select_options</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) == </span><span class="s6">0</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">&quot;No such keys(s)&quot;</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) &gt; </span><span class="s6">1 </span><span class="s2">and </span><span class="s1">len</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">) &lt; </span><span class="s6">4 </span><span class="s2">and </span><span class="s1">pat </span><span class="s3">!= </span><span class="s5">&quot;all&quot;</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
            <span class="s5">&quot;You must specify at least 4 characters when &quot;</span>
            <span class="s5">&quot;resetting multiple keys, use the special keyword &quot;</span>
            <span class="s5">'&quot;all&quot; to reset all the options to their default value'</span>
        <span class="s3">)</span>

    <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">keys</span><span class="s3">:</span>
        <span class="s1">_set_option</span><span class="s3">(</span><span class="s1">k</span><span class="s3">, </span><span class="s1">_registered_options</span><span class="s3">[</span><span class="s1">k</span><span class="s3">].</span><span class="s1">defval</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">=</span><span class="s1">silent</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">get_default_val</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
    <span class="s1">key </span><span class="s3">= </span><span class="s1">_get_single_key</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>
    <span class="s2">return </span><span class="s1">_get_registered_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">).</span><span class="s1">defval</span>


<span class="s2">class </span><span class="s1">DictWrapper</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;provide attribute-style access to a nested dict&quot;&quot;&quot;</span>

    <span class="s1">d</span><span class="s3">: </span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">]</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">d</span><span class="s3">: </span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">], </span><span class="s1">prefix</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;&quot;</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">object</span><span class="s3">.</span><span class="s1">__setattr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;d&quot;</span><span class="s3">, </span><span class="s1">d</span><span class="s3">)</span>
        <span class="s1">object</span><span class="s3">.</span><span class="s1">__setattr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;prefix&quot;</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__setattr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">val</span><span class="s3">: </span><span class="s1">Any</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">prefix </span><span class="s3">= </span><span class="s1">object</span><span class="s3">.</span><span class="s1">__getattribute__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;prefix&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">prefix</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">+= </span><span class="s5">&quot;.&quot;</span>
        <span class="s1">prefix </span><span class="s3">+= </span><span class="s1">key</span>
        <span class="s4"># you can't set new keys</span>
        <span class="s4"># can you can't overwrite subtrees</span>
        <span class="s2">if </span><span class="s1">key </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">d </span><span class="s2">and not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">d</span><span class="s3">[</span><span class="s1">key</span><span class="s3">], </span><span class="s1">dict</span><span class="s3">):</span>
            <span class="s1">_set_option</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">val</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">&quot;You can only set the value of existing options&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__getattr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">prefix </span><span class="s3">= </span><span class="s1">object</span><span class="s3">.</span><span class="s1">__getattribute__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;prefix&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">prefix</span><span class="s3">:</span>
            <span class="s1">prefix </span><span class="s3">+= </span><span class="s5">&quot;.&quot;</span>
        <span class="s1">prefix </span><span class="s3">+= </span><span class="s1">key</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">v </span><span class="s3">= </span><span class="s1">object</span><span class="s3">.</span><span class="s1">__getattribute__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;d&quot;</span><span class="s3">)[</span><span class="s1">key</span><span class="s3">]</span>
        <span class="s2">except </span><span class="s1">KeyError </span><span class="s2">as </span><span class="s1">err</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">&quot;No such option&quot;</span><span class="s3">) </span><span class="s2">from </span><span class="s1">err</span>
        <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">):</span>
            <span class="s2">return </span><span class="s1">DictWrapper</span><span class="s3">(</span><span class="s1">v</span><span class="s3">, </span><span class="s1">prefix</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s1">_get_option</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__dir__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s2">return </span><span class="s1">list</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">d</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>


<span class="s4"># For user convenience,  we'd like to have the available options described</span>
<span class="s4"># in the docstring. For dev convenience we'd like to generate the docstrings</span>
<span class="s4"># dynamically instead of maintaining them by hand. To this, we use the</span>
<span class="s4"># class below which wraps functions inside a callable, and converts</span>
<span class="s4"># __doc__ into a property function. The doctsrings below are templates</span>
<span class="s4"># using the py2.6+ advanced formatting syntax to plug in a concise list</span>
<span class="s4"># of options, and option descriptions.</span>


<span class="s2">class </span><span class="s1">CallableDynamicDoc</span><span class="s3">(</span><span class="s1">Generic</span><span class="s3">[</span><span class="s1">T</span><span class="s3">]):</span>
    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">func</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">[..., </span><span class="s1">T</span><span class="s3">], </span><span class="s1">doc_tmpl</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">__doc_tmpl__ </span><span class="s3">= </span><span class="s1">doc_tmpl</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">__func__ </span><span class="s3">= </span><span class="s1">func</span>

    <span class="s2">def </span><span class="s1">__call__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwds</span><span class="s3">) </span><span class="s1">-&gt; T</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__func__</span><span class="s3">(*</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwds</span><span class="s3">)</span>

    <span class="s4"># error: Signature of &quot;__doc__&quot; incompatible with supertype &quot;object&quot;</span>
    <span class="s3">@</span><span class="s1">property</span>
    <span class="s2">def </span><span class="s1">__doc__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:  </span><span class="s4"># type: ignore[override]</span>
        <span class="s1">opts_desc </span><span class="s3">= </span><span class="s1">_describe_option</span><span class="s3">(</span><span class="s5">&quot;all&quot;</span><span class="s3">, </span><span class="s1">_print_desc</span><span class="s3">=</span><span class="s2">False</span><span class="s3">)</span>
        <span class="s1">opts_list </span><span class="s3">= </span><span class="s1">pp_options_list</span><span class="s3">(</span><span class="s1">list</span><span class="s3">(</span><span class="s1">_registered_options</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">()))</span>
        <span class="s2">return </span><span class="s1">self</span><span class="s3">.</span><span class="s1">__doc_tmpl__</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">opts_desc</span><span class="s3">=</span><span class="s1">opts_desc</span><span class="s3">, </span><span class="s1">opts_list</span><span class="s3">=</span><span class="s1">opts_list</span><span class="s3">)</span>


<span class="s1">_get_option_tmpl </span><span class="s3">= </span><span class="s5">&quot;&quot;&quot; 
get_option(pat) 
 
Retrieves the value of the specified option. 
 
Available options: 
 
{opts_list} 
 
Parameters 
---------- 
pat : str 
    Regexp which should match a single option. 
    Note: partial matches are supported for convenience, but unless you use the 
    full option name (e.g. x.y.z.option_name), your code may break in future 
    versions if new options with similar names are introduced. 
 
Returns 
------- 
result : the value of the option 
 
Raises 
------ 
OptionError : if no such option exists 
 
Notes 
----- 
Please reference the :ref:`User Guide &lt;options&gt;` for more information. 
 
The available options with its descriptions: 
 
{opts_desc} 
 
Examples 
-------- 
&gt;&gt;&gt; pd.get_option('display.max_columns')  # doctest: +SKIP 
4 
&quot;&quot;&quot;</span>

<span class="s1">_set_option_tmpl </span><span class="s3">= </span><span class="s5">&quot;&quot;&quot; 
set_option(pat, value) 
 
Sets the value of the specified option. 
 
Available options: 
 
{opts_list} 
 
Parameters 
---------- 
pat : str 
    Regexp which should match a single option. 
    Note: partial matches are supported for convenience, but unless you use the 
    full option name (e.g. x.y.z.option_name), your code may break in future 
    versions if new options with similar names are introduced. 
value : object 
    New value of option. 
 
Returns 
------- 
None 
 
Raises 
------ 
OptionError if no such option exists 
 
Notes 
----- 
Please reference the :ref:`User Guide &lt;options&gt;` for more information. 
 
The available options with its descriptions: 
 
{opts_desc} 
 
Examples 
-------- 
&gt;&gt;&gt; pd.set_option('display.max_columns', 4) 
&gt;&gt;&gt; df = pd.DataFrame([[1, 2, 3, 4, 5], [6, 7, 8, 9, 10]]) 
&gt;&gt;&gt; df 
   0  1  ...  3   4 
0  1  2  ...  4   5 
1  6  7  ...  9  10 
[2 rows x 5 columns] 
&gt;&gt;&gt; pd.reset_option('display.max_columns') 
&quot;&quot;&quot;</span>

<span class="s1">_describe_option_tmpl </span><span class="s3">= </span><span class="s5">&quot;&quot;&quot; 
describe_option(pat, _print_desc=False) 
 
Prints the description for one or more registered options. 
 
Call with no arguments to get a listing for all registered options. 
 
Available options: 
 
{opts_list} 
 
Parameters 
---------- 
pat : str 
    Regexp pattern. All matching keys will have their description displayed. 
_print_desc : bool, default True 
    If True (default) the description(s) will be printed to stdout. 
    Otherwise, the description(s) will be returned as a unicode string 
    (for testing). 
 
Returns 
------- 
None by default, the description(s) as a unicode string if _print_desc 
is False 
 
Notes 
----- 
Please reference the :ref:`User Guide &lt;options&gt;` for more information. 
 
The available options with its descriptions: 
 
{opts_desc} 
 
Examples 
-------- 
&gt;&gt;&gt; pd.describe_option('display.max_columns')  # doctest: +SKIP 
display.max_columns : int 
    If max_cols is exceeded, switch to truncate view... 
&quot;&quot;&quot;</span>

<span class="s1">_reset_option_tmpl </span><span class="s3">= </span><span class="s5">&quot;&quot;&quot; 
reset_option(pat) 
 
Reset one or more options to their default value. 
 
Pass &quot;all&quot; as argument to reset all options. 
 
Available options: 
 
{opts_list} 
 
Parameters 
---------- 
pat : str/regex 
    If specified only options matching `prefix*` will be reset. 
    Note: partial matches are supported for convenience, but unless you 
    use the full option name (e.g. x.y.z.option_name), your code may break 
    in future versions if new options with similar names are introduced. 
 
Returns 
------- 
None 
 
Notes 
----- 
Please reference the :ref:`User Guide &lt;options&gt;` for more information. 
 
The available options with its descriptions: 
 
{opts_desc} 
 
Examples 
-------- 
&gt;&gt;&gt; pd.reset_option('display.max_columns')  # doctest: +SKIP 
&quot;&quot;&quot;</span>

<span class="s4"># bind the functions with their docstrings into a Callable</span>
<span class="s4"># and use that as the functions exposed in pd.api</span>
<span class="s1">get_option </span><span class="s3">= </span><span class="s1">CallableDynamicDoc</span><span class="s3">(</span><span class="s1">_get_option</span><span class="s3">, </span><span class="s1">_get_option_tmpl</span><span class="s3">)</span>
<span class="s1">set_option </span><span class="s3">= </span><span class="s1">CallableDynamicDoc</span><span class="s3">(</span><span class="s1">_set_option</span><span class="s3">, </span><span class="s1">_set_option_tmpl</span><span class="s3">)</span>
<span class="s1">reset_option </span><span class="s3">= </span><span class="s1">CallableDynamicDoc</span><span class="s3">(</span><span class="s1">_reset_option</span><span class="s3">, </span><span class="s1">_reset_option_tmpl</span><span class="s3">)</span>
<span class="s1">describe_option </span><span class="s3">= </span><span class="s1">CallableDynamicDoc</span><span class="s3">(</span><span class="s1">_describe_option</span><span class="s3">, </span><span class="s1">_describe_option_tmpl</span><span class="s3">)</span>
<span class="s1">options </span><span class="s3">= </span><span class="s1">DictWrapper</span><span class="s3">(</span><span class="s1">_global_config</span><span class="s3">)</span>

<span class="s4">#</span>
<span class="s4"># Functions for use by pandas developers, in addition to User - api</span>


<span class="s2">class </span><span class="s1">option_context</span><span class="s3">(</span><span class="s1">ContextDecorator</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Context manager to temporarily set options in the `with` statement context. 
 
    You need to invoke as ``option_context(pat, val, [(pat, val), ...])``. 
 
    Examples 
    -------- 
    &gt;&gt;&gt; from pandas import option_context 
    &gt;&gt;&gt; with option_context('display.max_rows', 10, 'display.max_columns', 5): 
    ...     pass 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">args</span><span class="s3">) % </span><span class="s6">2 </span><span class="s3">!= </span><span class="s6">0 </span><span class="s2">or </span><span class="s1">len</span><span class="s3">(</span><span class="s1">args</span><span class="s3">) &lt; </span><span class="s6">2</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span>
                <span class="s5">&quot;Need to invoke as option_context(pat, val, [(pat, val), ...]).&quot;</span>
            <span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">ops </span><span class="s3">= </span><span class="s1">list</span><span class="s3">(</span><span class="s1">zip</span><span class="s3">(</span><span class="s1">args</span><span class="s3">[::</span><span class="s6">2</span><span class="s3">], </span><span class="s1">args</span><span class="s3">[</span><span class="s6">1</span><span class="s3">::</span><span class="s6">2</span><span class="s3">]))</span>

    <span class="s2">def </span><span class="s1">__enter__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">undo </span><span class="s3">= [(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">_get_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">)) </span><span class="s2">for </span><span class="s1">pat</span><span class="s3">, </span><span class="s1">val </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ops</span><span class="s3">]</span>

        <span class="s2">for </span><span class="s1">pat</span><span class="s3">, </span><span class="s1">val </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">ops</span><span class="s3">:</span>
            <span class="s1">_set_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">val</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__exit__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">undo</span><span class="s3">:</span>
            <span class="s2">for </span><span class="s1">pat</span><span class="s3">, </span><span class="s1">val </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">undo</span><span class="s3">:</span>
                <span class="s1">_set_option</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">val</span><span class="s3">, </span><span class="s1">silent</span><span class="s3">=</span><span class="s2">True</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">register_option</span><span class="s3">(</span>
    <span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s1">defval</span><span class="s3">: </span><span class="s1">object</span><span class="s3">,</span>
    <span class="s1">doc</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;&quot;</span><span class="s3">,</span>
    <span class="s1">validator</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">[[</span><span class="s1">object</span><span class="s3">], </span><span class="s1">Any</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">cb</span><span class="s3">: </span><span class="s1">Callable</span><span class="s3">[[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">Any</span><span class="s3">] | </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Register an option in the package-wide pandas config object 
 
    Parameters 
    ---------- 
    key : str 
        Fully-qualified key, e.g. &quot;x.y.option - z&quot;. 
    defval : object 
        Default value of the option. 
    doc : str 
        Description of the option. 
    validator : Callable, optional 
        Function of a single argument, should raise `ValueError` if 
        called with a value which is not a legal value for the option. 
    cb 
        a function of a single argument &quot;key&quot;, which is called 
        immediately after an option value is set/reset. key is 
        the full name of the option. 
 
    Raises 
    ------ 
    ValueError if `validator` is specified and `defval` is not a valid value. 
 
    &quot;&quot;&quot;</span>
    <span class="s2">import </span><span class="s1">keyword</span>
    <span class="s2">import </span><span class="s1">tokenize</span>

    <span class="s1">key </span><span class="s3">= </span><span class="s1">key</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">()</span>

    <span class="s2">if </span><span class="s1">key </span><span class="s2">in </span><span class="s1">_registered_options</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">f&quot;Option '</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s5">' has already been registered&quot;</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">key </span><span class="s2">in </span><span class="s1">_reserved_keys</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">f&quot;Option '</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s5">' is a reserved key&quot;</span><span class="s3">)</span>

    <span class="s4"># the default value should be legal</span>
    <span class="s2">if </span><span class="s1">validator</span><span class="s3">:</span>
        <span class="s1">validator</span><span class="s3">(</span><span class="s1">defval</span><span class="s3">)</span>

    <span class="s4"># walk the nested dict, creating dicts as needed along the path</span>
    <span class="s1">path </span><span class="s3">= </span><span class="s1">key</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">)</span>

    <span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">path</span><span class="s3">:</span>
        <span class="s2">if not </span><span class="s1">re</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s5">&quot;^&quot; </span><span class="s3">+ </span><span class="s1">tokenize</span><span class="s3">.</span><span class="s1">Name </span><span class="s3">+ </span><span class="s5">&quot;$&quot;</span><span class="s3">, </span><span class="s1">k</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">k</span><span class="s2">} </span><span class="s5">is not a valid identifier&quot;</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">keyword</span><span class="s3">.</span><span class="s1">iskeyword</span><span class="s3">(</span><span class="s1">k</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">k</span><span class="s2">} </span><span class="s5">is a python keyword&quot;</span><span class="s3">)</span>

    <span class="s1">cursor </span><span class="s3">= </span><span class="s1">_global_config</span>
    <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Path prefix to option '{option}' is already an option&quot;</span>

    <span class="s2">for </span><span class="s1">i</span><span class="s3">, </span><span class="s1">p </span><span class="s2">in </span><span class="s1">enumerate</span><span class="s3">(</span><span class="s1">path</span><span class="s3">[:-</span><span class="s6">1</span><span class="s3">]):</span>
        <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">cursor</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">option</span><span class="s3">=</span><span class="s5">&quot;.&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">path</span><span class="s3">[:</span><span class="s1">i</span><span class="s3">])))</span>
        <span class="s2">if </span><span class="s1">p </span><span class="s2">not in </span><span class="s1">cursor</span><span class="s3">:</span>
            <span class="s1">cursor</span><span class="s3">[</span><span class="s1">p</span><span class="s3">] = {}</span>
        <span class="s1">cursor </span><span class="s3">= </span><span class="s1">cursor</span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>

    <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">cursor</span><span class="s3">, </span><span class="s1">dict</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">option</span><span class="s3">=</span><span class="s5">&quot;.&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">path</span><span class="s3">[:-</span><span class="s6">1</span><span class="s3">])))</span>

    <span class="s1">cursor</span><span class="s3">[</span><span class="s1">path</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">]] = </span><span class="s1">defval  </span><span class="s4"># initialize</span>

    <span class="s4"># save the option metadata</span>
    <span class="s1">_registered_options</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] = </span><span class="s1">RegisteredOption</span><span class="s3">(</span>
        <span class="s1">key</span><span class="s3">=</span><span class="s1">key</span><span class="s3">, </span><span class="s1">defval</span><span class="s3">=</span><span class="s1">defval</span><span class="s3">, </span><span class="s1">doc</span><span class="s3">=</span><span class="s1">doc</span><span class="s3">, </span><span class="s1">validator</span><span class="s3">=</span><span class="s1">validator</span><span class="s3">, </span><span class="s1">cb</span><span class="s3">=</span><span class="s1">cb</span>
    <span class="s3">)</span>


<span class="s2">def </span><span class="s1">deprecate_option</span><span class="s3">(</span>
    <span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s1">msg</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">rkey</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s1">removal_ver</span><span class="s3">: </span><span class="s1">str </span><span class="s3">| </span><span class="s2">None </span><span class="s3">= </span><span class="s2">None</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Mark option `key` as deprecated, if code attempts to access this option, 
    a warning will be produced, using `msg` if given, or a default message 
    if not. 
    if `rkey` is given, any access to the key will be re-routed to `rkey`. 
 
    Neither the existence of `key` nor that if `rkey` is checked. If they 
    do not exist, any subsequence access will fail as usual, after the 
    deprecation warning is given. 
 
    Parameters 
    ---------- 
    key : str 
        Name of the option to be deprecated. 
        must be a fully-qualified option name (e.g &quot;x.y.z.rkey&quot;). 
    msg : str, optional 
        Warning message to output when the key is referenced. 
        if no message is given a default message will be emitted. 
    rkey : str, optional 
        Name of an option to reroute access to. 
        If specified, any referenced `key` will be 
        re-routed to `rkey` including set/get/reset. 
        rkey must be a fully-qualified option name (e.g &quot;x.y.z.rkey&quot;). 
        used by the default message if no `msg` is specified. 
    removal_ver : str, optional 
        Specifies the version in which this option will 
        be removed. used by the default message if no `msg` is specified. 
 
    Raises 
    ------ 
    OptionError 
        If the specified key has already been deprecated. 
    &quot;&quot;&quot;</span>
    <span class="s1">key </span><span class="s3">= </span><span class="s1">key</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">()</span>

    <span class="s2">if </span><span class="s1">key </span><span class="s2">in </span><span class="s1">_deprecated_options</span><span class="s3">:</span>
        <span class="s2">raise </span><span class="s1">OptionError</span><span class="s3">(</span><span class="s5">f&quot;Option '</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s5">' has already been defined as deprecated.&quot;</span><span class="s3">)</span>

    <span class="s1">_deprecated_options</span><span class="s3">[</span><span class="s1">key</span><span class="s3">] = </span><span class="s1">DeprecatedOption</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">msg</span><span class="s3">, </span><span class="s1">rkey</span><span class="s3">, </span><span class="s1">removal_ver</span><span class="s3">)</span>


<span class="s4">#</span>
<span class="s4"># functions internal to the module</span>


<span class="s2">def </span><span class="s1">_select_options</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    returns a list of keys matching `pat` 
 
    if pat==&quot;all&quot;, returns all registered options 
    &quot;&quot;&quot;</span>
    <span class="s4"># short-circuit for exact key</span>
    <span class="s2">if </span><span class="s1">pat </span><span class="s2">in </span><span class="s1">_registered_options</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">[</span><span class="s1">pat</span><span class="s3">]</span>

    <span class="s4"># else look through all of them</span>
    <span class="s1">keys </span><span class="s3">= </span><span class="s1">sorted</span><span class="s3">(</span><span class="s1">_registered_options</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">())</span>
    <span class="s2">if </span><span class="s1">pat </span><span class="s3">== </span><span class="s5">&quot;all&quot;</span><span class="s3">:  </span><span class="s4"># reserved key</span>
        <span class="s2">return </span><span class="s1">keys</span>

    <span class="s2">return </span><span class="s3">[</span><span class="s1">k </span><span class="s2">for </span><span class="s1">k </span><span class="s2">in </span><span class="s1">keys </span><span class="s2">if </span><span class="s1">re</span><span class="s3">.</span><span class="s1">search</span><span class="s3">(</span><span class="s1">pat</span><span class="s3">, </span><span class="s1">k</span><span class="s3">, </span><span class="s1">re</span><span class="s3">.</span><span class="s1">I</span><span class="s3">)]</span>


<span class="s2">def </span><span class="s1">_get_root</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; tuple</span><span class="s3">[</span><span class="s1">dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Any</span><span class="s3">], </span><span class="s1">str</span><span class="s3">]:</span>
    <span class="s1">path </span><span class="s3">= </span><span class="s1">key</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">)</span>
    <span class="s1">cursor </span><span class="s3">= </span><span class="s1">_global_config</span>
    <span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">path</span><span class="s3">[:-</span><span class="s6">1</span><span class="s3">]:</span>
        <span class="s1">cursor </span><span class="s3">= </span><span class="s1">cursor</span><span class="s3">[</span><span class="s1">p</span><span class="s3">]</span>
    <span class="s2">return </span><span class="s1">cursor</span><span class="s3">, </span><span class="s1">path</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">]</span>


<span class="s2">def </span><span class="s1">_is_deprecated</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Returns True if the given option has been deprecated&quot;&quot;&quot;</span>
    <span class="s1">key </span><span class="s3">= </span><span class="s1">key</span><span class="s3">.</span><span class="s1">lower</span><span class="s3">()</span>
    <span class="s2">return </span><span class="s1">key </span><span class="s2">in </span><span class="s1">_deprecated_options</span>


<span class="s2">def </span><span class="s1">_get_deprecated_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Retrieves the metadata for a deprecated option, if `key` is deprecated. 
 
    Returns 
    ------- 
    DeprecatedOption (namedtuple) if key is deprecated, None otherwise 
    &quot;&quot;&quot;</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s1">d </span><span class="s3">= </span><span class="s1">_deprecated_options</span><span class="s3">[</span><span class="s1">key</span><span class="s3">]</span>
    <span class="s2">except </span><span class="s1">KeyError</span><span class="s3">:</span>
        <span class="s2">return None</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">d</span>


<span class="s2">def </span><span class="s1">_get_registered_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Retrieves the option metadata if `key` is a registered option. 
 
    Returns 
    ------- 
    RegisteredOption (namedtuple) if key is deprecated, None otherwise 
    &quot;&quot;&quot;</span>
    <span class="s2">return </span><span class="s1">_registered_options</span><span class="s3">.</span><span class="s1">get</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>


<span class="s2">def </span><span class="s1">_translate_key</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    if key id deprecated and a replacement key defined, will return the 
    replacement key, otherwise returns `key` as - is 
    &quot;&quot;&quot;</span>
    <span class="s1">d </span><span class="s3">= </span><span class="s1">_get_deprecated_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">d</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">d</span><span class="s3">.</span><span class="s1">rkey </span><span class="s2">or </span><span class="s1">key</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">key</span>


<span class="s2">def </span><span class="s1">_warn_if_deprecated</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Checks if `key` is a deprecated option and if so, prints a warning. 
 
    Returns 
    ------- 
    bool - True if `key` is deprecated, False otherwise. 
    &quot;&quot;&quot;</span>
    <span class="s1">d </span><span class="s3">= </span><span class="s1">_get_deprecated_option</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">d</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">d</span><span class="s3">.</span><span class="s1">msg</span><span class="s3">:</span>
            <span class="s1">warnings</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span>
                <span class="s1">d</span><span class="s3">.</span><span class="s1">msg</span><span class="s3">,</span>
                <span class="s1">FutureWarning</span><span class="s3">,</span>
                <span class="s1">stacklevel</span><span class="s3">=</span><span class="s1">find_stack_level</span><span class="s3">(),</span>
            <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">msg </span><span class="s3">= </span><span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s5">' is deprecated&quot;</span>
            <span class="s2">if </span><span class="s1">d</span><span class="s3">.</span><span class="s1">removal_ver</span><span class="s3">:</span>
                <span class="s1">msg </span><span class="s3">+= </span><span class="s5">f&quot; and will be removed in </span><span class="s2">{</span><span class="s1">d</span><span class="s3">.</span><span class="s1">removal_ver</span><span class="s2">}</span><span class="s5">&quot;</span>
            <span class="s2">if </span><span class="s1">d</span><span class="s3">.</span><span class="s1">rkey</span><span class="s3">:</span>
                <span class="s1">msg </span><span class="s3">+= </span><span class="s5">f&quot;, please use '</span><span class="s2">{</span><span class="s1">d</span><span class="s3">.</span><span class="s1">rkey</span><span class="s2">}</span><span class="s5">' instead.&quot;</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s1">msg </span><span class="s3">+= </span><span class="s5">&quot;, please refrain from using it.&quot;</span>

            <span class="s1">warnings</span><span class="s3">.</span><span class="s1">warn</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">, </span><span class="s1">FutureWarning</span><span class="s3">, </span><span class="s1">stacklevel</span><span class="s3">=</span><span class="s1">find_stack_level</span><span class="s3">())</span>
        <span class="s2">return True</span>
    <span class="s2">return False</span>


<span class="s2">def </span><span class="s1">_build_option_description</span><span class="s3">(</span><span class="s1">k</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot;Builds a formatted description of a registered option and prints it&quot;&quot;&quot;</span>
    <span class="s1">o </span><span class="s3">= </span><span class="s1">_get_registered_option</span><span class="s3">(</span><span class="s1">k</span><span class="s3">)</span>
    <span class="s1">d </span><span class="s3">= </span><span class="s1">_get_deprecated_option</span><span class="s3">(</span><span class="s1">k</span><span class="s3">)</span>

    <span class="s1">s </span><span class="s3">= </span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">k</span><span class="s2">} </span><span class="s5">&quot;</span>

    <span class="s2">if </span><span class="s1">o</span><span class="s3">.</span><span class="s1">doc</span><span class="s3">:</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">o</span><span class="s3">.</span><span class="s1">doc</span><span class="s3">.</span><span class="s1">strip</span><span class="s3">().</span><span class="s1">split</span><span class="s3">(</span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">&quot;No description available.&quot;</span>

    <span class="s2">if </span><span class="s1">o</span><span class="s3">:</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">f&quot;</span><span class="s2">\n    </span><span class="s5">[default: </span><span class="s2">{</span><span class="s1">o</span><span class="s3">.</span><span class="s1">defval</span><span class="s2">}</span><span class="s5">] [currently: </span><span class="s2">{</span><span class="s1">_get_option</span><span class="s3">(</span><span class="s1">k</span><span class="s3">, </span><span class="s2">True</span><span class="s3">)</span><span class="s2">}</span><span class="s5">]&quot;</span>

    <span class="s2">if </span><span class="s1">d</span><span class="s3">:</span>
        <span class="s1">rkey </span><span class="s3">= </span><span class="s1">d</span><span class="s3">.</span><span class="s1">rkey </span><span class="s2">or </span><span class="s5">&quot;&quot;</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">&quot;</span><span class="s2">\n    </span><span class="s5">(Deprecated&quot;</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">f&quot;, use `</span><span class="s2">{</span><span class="s1">rkey</span><span class="s2">}</span><span class="s5">` instead.&quot;</span>
        <span class="s1">s </span><span class="s3">+= </span><span class="s5">&quot;)&quot;</span>

    <span class="s2">return </span><span class="s1">s</span>


<span class="s2">def </span><span class="s1">pp_options_list</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">: </span><span class="s1">Iterable</span><span class="s3">[</span><span class="s1">str</span><span class="s3">], </span><span class="s1">width</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= </span><span class="s6">80</span><span class="s3">, </span><span class="s1">_print</span><span class="s3">: </span><span class="s1">bool </span><span class="s3">= </span><span class="s2">False</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Builds a concise listing of available options, grouped by prefix&quot;&quot;&quot;</span>
    <span class="s2">from </span><span class="s1">itertools </span><span class="s2">import </span><span class="s1">groupby</span>
    <span class="s2">from </span><span class="s1">textwrap </span><span class="s2">import </span><span class="s1">wrap</span>

    <span class="s2">def </span><span class="s1">pp</span><span class="s3">(</span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">ks</span><span class="s3">: </span><span class="s1">Iterable</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]) </span><span class="s1">-&gt; list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s1">pfx </span><span class="s3">= </span><span class="s5">&quot;- &quot; </span><span class="s3">+ </span><span class="s1">name </span><span class="s3">+ </span><span class="s5">&quot;.[&quot; </span><span class="s2">if </span><span class="s1">name </span><span class="s2">else </span><span class="s5">&quot;&quot;</span>
        <span class="s1">ls </span><span class="s3">= </span><span class="s1">wrap</span><span class="s3">(</span>
            <span class="s5">&quot;, &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">ks</span><span class="s3">),</span>
            <span class="s1">width</span><span class="s3">,</span>
            <span class="s1">initial_indent</span><span class="s3">=</span><span class="s1">pfx</span><span class="s3">,</span>
            <span class="s1">subsequent_indent</span><span class="s3">=</span><span class="s5">&quot;  &quot;</span><span class="s3">,</span>
            <span class="s1">break_long_words</span><span class="s3">=</span><span class="s2">False</span><span class="s3">,</span>
        <span class="s3">)</span>
        <span class="s2">if </span><span class="s1">ls </span><span class="s2">and </span><span class="s1">ls</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">] </span><span class="s2">and </span><span class="s1">name</span><span class="s3">:</span>
            <span class="s1">ls</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">] = </span><span class="s1">ls</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">] + </span><span class="s5">&quot;]&quot;</span>
        <span class="s2">return </span><span class="s1">ls</span>

    <span class="s1">ls</span><span class="s3">: </span><span class="s1">list</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = []</span>
    <span class="s1">singles </span><span class="s3">= [</span><span class="s1">x </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">sorted</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">) </span><span class="s2">if </span><span class="s1">x</span><span class="s3">.</span><span class="s1">find</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">) &lt; </span><span class="s6">0</span><span class="s3">]</span>
    <span class="s2">if </span><span class="s1">singles</span><span class="s3">:</span>
        <span class="s1">ls </span><span class="s3">+= </span><span class="s1">pp</span><span class="s3">(</span><span class="s5">&quot;&quot;</span><span class="s3">, </span><span class="s1">singles</span><span class="s3">)</span>
    <span class="s1">keys </span><span class="s3">= [</span><span class="s1">x </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">keys </span><span class="s2">if </span><span class="s1">x</span><span class="s3">.</span><span class="s1">find</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">) &gt;= </span><span class="s6">0</span><span class="s3">]</span>

    <span class="s2">for </span><span class="s1">k</span><span class="s3">, </span><span class="s1">g </span><span class="s2">in </span><span class="s1">groupby</span><span class="s3">(</span><span class="s1">sorted</span><span class="s3">(</span><span class="s1">keys</span><span class="s3">), </span><span class="s2">lambda </span><span class="s1">x</span><span class="s3">: </span><span class="s1">x</span><span class="s3">[: </span><span class="s1">x</span><span class="s3">.</span><span class="s1">rfind</span><span class="s3">(</span><span class="s5">&quot;.&quot;</span><span class="s3">)]):</span>
        <span class="s1">ks </span><span class="s3">= [</span><span class="s1">x</span><span class="s3">[</span><span class="s1">len</span><span class="s3">(</span><span class="s1">k</span><span class="s3">) + </span><span class="s6">1 </span><span class="s3">:] </span><span class="s2">for </span><span class="s1">x </span><span class="s2">in </span><span class="s1">list</span><span class="s3">(</span><span class="s1">g</span><span class="s3">)]</span>
        <span class="s1">ls </span><span class="s3">+= </span><span class="s1">pp</span><span class="s3">(</span><span class="s1">k</span><span class="s3">, </span><span class="s1">ks</span><span class="s3">)</span>
    <span class="s1">s </span><span class="s3">= </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">ls</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s1">_print</span><span class="s3">:</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s1">s</span><span class="s3">)</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">s</span>


<span class="s4">#</span>
<span class="s4"># helpers</span>


<span class="s3">@</span><span class="s1">contextmanager</span>
<span class="s2">def </span><span class="s1">config_prefix</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; Generator</span><span class="s3">[</span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">, </span><span class="s2">None</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
    contextmanager for multiple invocations of API with a common prefix 
 
    supported API functions: (register / get / set )__option 
 
    Warning: This is not thread - safe, and won't work properly if you import 
    the API functions into your module using the &quot;from x import y&quot; construct. 
 
    Example 
    ------- 
    import pandas._config.config as cf 
    with cf.config_prefix(&quot;display.font&quot;): 
        cf.register_option(&quot;color&quot;, &quot;red&quot;) 
        cf.register_option(&quot;size&quot;, &quot; 5 pt&quot;) 
        cf.set_option(size, &quot; 6 pt&quot;) 
        cf.get_option(size) 
        ... 
 
        etc' 
 
    will register options &quot;display.font.color&quot;, &quot;display.font.size&quot;, set the 
    value of &quot;display.font.size&quot;... and so on. 
    &quot;&quot;&quot;</span>
    <span class="s4"># Note: reset_option relies on set_option, and on key directly</span>
    <span class="s4"># it does not fit in to this monkey-patching scheme</span>

    <span class="s2">global </span><span class="s1">register_option</span><span class="s3">, </span><span class="s1">get_option</span><span class="s3">, </span><span class="s1">set_option</span>

    <span class="s2">def </span><span class="s1">wrap</span><span class="s3">(</span><span class="s1">func</span><span class="s3">: </span><span class="s1">F</span><span class="s3">) </span><span class="s1">-&gt; F</span><span class="s3">:</span>
        <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">key</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwds</span><span class="s3">):</span>
            <span class="s1">pkey </span><span class="s3">= </span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">prefix</span><span class="s2">}</span><span class="s5">.</span><span class="s2">{</span><span class="s1">key</span><span class="s2">}</span><span class="s5">&quot;</span>
            <span class="s2">return </span><span class="s1">func</span><span class="s3">(</span><span class="s1">pkey</span><span class="s3">, *</span><span class="s1">args</span><span class="s3">, **</span><span class="s1">kwds</span><span class="s3">)</span>

        <span class="s2">return </span><span class="s1">cast</span><span class="s3">(</span><span class="s1">F</span><span class="s3">, </span><span class="s1">inner</span><span class="s3">)</span>

    <span class="s1">_register_option </span><span class="s3">= </span><span class="s1">register_option</span>
    <span class="s1">_get_option </span><span class="s3">= </span><span class="s1">get_option</span>
    <span class="s1">_set_option </span><span class="s3">= </span><span class="s1">set_option</span>
    <span class="s1">set_option </span><span class="s3">= </span><span class="s1">wrap</span><span class="s3">(</span><span class="s1">set_option</span><span class="s3">)</span>
    <span class="s1">get_option </span><span class="s3">= </span><span class="s1">wrap</span><span class="s3">(</span><span class="s1">get_option</span><span class="s3">)</span>
    <span class="s1">register_option </span><span class="s3">= </span><span class="s1">wrap</span><span class="s3">(</span><span class="s1">register_option</span><span class="s3">)</span>
    <span class="s2">try</span><span class="s3">:</span>
        <span class="s2">yield</span>
    <span class="s2">finally</span><span class="s3">:</span>
        <span class="s1">set_option </span><span class="s3">= </span><span class="s1">_set_option</span>
        <span class="s1">get_option </span><span class="s3">= </span><span class="s1">_get_option</span>
        <span class="s1">register_option </span><span class="s3">= </span><span class="s1">_register_option</span>


<span class="s4"># These factories and methods are handy for use as the validator</span>
<span class="s4"># arg in register_option</span>


<span class="s2">def </span><span class="s1">is_type_factory</span><span class="s3">(</span><span class="s1">_type</span><span class="s3">: </span><span class="s1">type</span><span class="s3">[</span><span class="s1">Any</span><span class="s3">]) </span><span class="s1">-&gt; Callable</span><span class="s3">[[</span><span class="s1">Any</span><span class="s3">], </span><span class="s2">None</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
 
    Parameters 
    ---------- 
    `_type` - a type to be compared against (e.g. type(x) == `_type`) 
 
    Returns 
    ------- 
    validator - a function of a single argument x , which raises 
                ValueError if type(x) is not equal to `_type` 
 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">type</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) != </span><span class="s1">_type</span><span class="s3">:</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;Value must have type '</span><span class="s2">{</span><span class="s1">_type</span><span class="s2">}</span><span class="s5">'&quot;</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">inner</span>


<span class="s2">def </span><span class="s1">is_instance_factory</span><span class="s3">(</span><span class="s1">_type</span><span class="s3">) </span><span class="s1">-&gt; Callable</span><span class="s3">[[</span><span class="s1">Any</span><span class="s3">], </span><span class="s2">None</span><span class="s3">]:</span>
    <span class="s0">&quot;&quot;&quot; 
 
    Parameters 
    ---------- 
    `_type` - the type to be checked against 
 
    Returns 
    ------- 
    validator - a function of a single argument x , which raises 
                ValueError if x is not an instance of `_type` 
 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">_type</span><span class="s3">, (</span><span class="s1">tuple</span><span class="s3">, </span><span class="s1">list</span><span class="s3">)):</span>
        <span class="s1">_type </span><span class="s3">= </span><span class="s1">tuple</span><span class="s3">(</span><span class="s1">_type</span><span class="s3">)</span>
        <span class="s1">type_repr </span><span class="s3">= </span><span class="s5">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">map</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">_type</span><span class="s3">))</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">type_repr </span><span class="s3">= </span><span class="s5">f&quot;'</span><span class="s2">{</span><span class="s1">_type</span><span class="s2">}</span><span class="s5">'&quot;</span>

    <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if not </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">x</span><span class="s3">, </span><span class="s1">_type</span><span class="s3">):</span>
            <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">f&quot;Value must be an instance of </span><span class="s2">{</span><span class="s1">type_repr</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">inner</span>


<span class="s2">def </span><span class="s1">is_one_of_factory</span><span class="s3">(</span><span class="s1">legal_values</span><span class="s3">) </span><span class="s1">-&gt; Callable</span><span class="s3">[[</span><span class="s1">Any</span><span class="s3">], </span><span class="s2">None</span><span class="s3">]:</span>
    <span class="s1">callables </span><span class="s3">= [</span><span class="s1">c </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">legal_values </span><span class="s2">if </span><span class="s1">callable</span><span class="s3">(</span><span class="s1">c</span><span class="s3">)]</span>
    <span class="s1">legal_values </span><span class="s3">= [</span><span class="s1">c </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">legal_values </span><span class="s2">if not </span><span class="s1">callable</span><span class="s3">(</span><span class="s1">c</span><span class="s3">)]</span>

    <span class="s2">def </span><span class="s1">inner</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">x </span><span class="s2">not in </span><span class="s1">legal_values</span><span class="s3">:</span>
            <span class="s2">if not </span><span class="s1">any</span><span class="s3">(</span><span class="s1">c</span><span class="s3">(</span><span class="s1">x</span><span class="s3">) </span><span class="s2">for </span><span class="s1">c </span><span class="s2">in </span><span class="s1">callables</span><span class="s3">):</span>
                <span class="s1">uvals </span><span class="s3">= [</span><span class="s1">str</span><span class="s3">(</span><span class="s1">lval</span><span class="s3">) </span><span class="s2">for </span><span class="s1">lval </span><span class="s2">in </span><span class="s1">legal_values</span><span class="s3">]</span>
                <span class="s1">pp_values </span><span class="s3">= </span><span class="s5">&quot;|&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">uvals</span><span class="s3">)</span>
                <span class="s1">msg </span><span class="s3">= </span><span class="s5">f&quot;Value must be one of </span><span class="s2">{</span><span class="s1">pp_values</span><span class="s2">}</span><span class="s5">&quot;</span>
                <span class="s2">if </span><span class="s1">len</span><span class="s3">(</span><span class="s1">callables</span><span class="s3">):</span>
                    <span class="s1">msg </span><span class="s3">+= </span><span class="s5">&quot; or a callable&quot;</span>
                <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">inner</span>


<span class="s2">def </span><span class="s1">is_nonnegative_int</span><span class="s3">(</span><span class="s1">value</span><span class="s3">: </span><span class="s1">object</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
    Verify that value is None or a positive int. 
 
    Parameters 
    ---------- 
    value : None or int 
            The `value` to be checked. 
 
    Raises 
    ------ 
    ValueError 
        When the value is not None or is a negative integer 
    &quot;&quot;&quot;</span>
    <span class="s2">if </span><span class="s1">value </span><span class="s2">is None</span><span class="s3">:</span>
        <span class="s2">return</span>

    <span class="s2">elif </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">value</span><span class="s3">, </span><span class="s1">int</span><span class="s3">):</span>
        <span class="s2">if </span><span class="s1">value </span><span class="s3">&gt;= </span><span class="s6">0</span><span class="s3">:</span>
            <span class="s2">return</span>

    <span class="s1">msg </span><span class="s3">= </span><span class="s5">&quot;Value must be a nonnegative integer or None&quot;</span>
    <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s1">msg</span><span class="s3">)</span>


<span class="s4"># common type validators, for convenience</span>
<span class="s4"># usage: register_option(... , validator = is_int)</span>
<span class="s1">is_int </span><span class="s3">= </span><span class="s1">is_type_factory</span><span class="s3">(</span><span class="s1">int</span><span class="s3">)</span>
<span class="s1">is_bool </span><span class="s3">= </span><span class="s1">is_type_factory</span><span class="s3">(</span><span class="s1">bool</span><span class="s3">)</span>
<span class="s1">is_float </span><span class="s3">= </span><span class="s1">is_type_factory</span><span class="s3">(</span><span class="s1">float</span><span class="s3">)</span>
<span class="s1">is_str </span><span class="s3">= </span><span class="s1">is_type_factory</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)</span>
<span class="s1">is_text </span><span class="s3">= </span><span class="s1">is_instance_factory</span><span class="s3">((</span><span class="s1">str</span><span class="s3">, </span><span class="s1">bytes</span><span class="s3">))</span>


<span class="s2">def </span><span class="s1">is_callable</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s0">&quot;&quot;&quot; 
 
    Parameters 
    ---------- 
    `obj` - the object to be checked 
 
    Returns 
    ------- 
    validator - returns True if object is callable 
        raises ValueError otherwise. 
 
    &quot;&quot;&quot;</span>
    <span class="s2">if not </span><span class="s1">callable</span><span class="s3">(</span><span class="s1">obj</span><span class="s3">):</span>
        <span class="s2">raise </span><span class="s1">ValueError</span><span class="s3">(</span><span class="s5">&quot;Value must be a callable&quot;</span><span class="s3">)</span>
    <span class="s2">return True</span>
</pre>
</body>
</html>