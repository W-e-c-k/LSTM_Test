<html>
<head>
<title>test_soup.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
.s7 { color: #a5c261;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_soup.py</font>
</center></td></tr></table>
<pre><span class="s0"># -*- coding: utf-8 -*-</span>
<span class="s2">&quot;&quot;&quot;Tests of Beautiful Soup as a whole.&quot;&quot;&quot;</span>

<span class="s3">from </span><span class="s1">pdb </span><span class="s3">import </span><span class="s1">set_trace</span>
<span class="s3">import </span><span class="s1">logging</span>
<span class="s3">import </span><span class="s1">os</span>
<span class="s3">import </span><span class="s1">pickle</span>
<span class="s3">import </span><span class="s1">pytest</span>
<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">import </span><span class="s1">tempfile</span>

<span class="s3">from </span><span class="s1">bs4 </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">BeautifulSoup</span><span class="s4">,</span>
    <span class="s1">BeautifulStoneSoup</span><span class="s4">,</span>
    <span class="s1">GuessedAtParserWarning</span><span class="s4">,</span>
    <span class="s1">MarkupResemblesLocatorWarning</span><span class="s4">,</span>
    <span class="s1">dammit</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">from </span><span class="s1">bs4</span><span class="s4">.</span><span class="s1">builder </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">builder_registry</span><span class="s4">,</span>
    <span class="s1">TreeBuilder</span><span class="s4">,</span>
    <span class="s1">ParserRejectedMarkup</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">from </span><span class="s1">bs4</span><span class="s4">.</span><span class="s1">element </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">Comment</span><span class="s4">,</span>
    <span class="s1">SoupStrainer</span><span class="s4">,</span>
    <span class="s1">PYTHON_SPECIFIC_ENCODINGS</span><span class="s4">,</span>
    <span class="s1">Tag</span><span class="s4">,</span>
    <span class="s1">NavigableString</span><span class="s4">,</span>
<span class="s4">)</span>

<span class="s3">from </span><span class="s4">. </span><span class="s3">import </span><span class="s4">(</span>
    <span class="s1">default_builder</span><span class="s4">,</span>
    <span class="s1">LXML_PRESENT</span><span class="s4">,</span>
    <span class="s1">SoupTest</span><span class="s4">,</span>
<span class="s4">)</span>
<span class="s3">import </span><span class="s1">warnings</span>
    
<span class="s3">class </span><span class="s1">TestConstructor</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">test_short_unicode_input</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">data </span><span class="s4">= </span><span class="s5">&quot;&lt;h1&gt;éé&lt;/h1&gt;&quot;</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">data</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;éé&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">h1</span><span class="s4">.</span><span class="s1">string</span>

    <span class="s3">def </span><span class="s1">test_embedded_null</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">data </span><span class="s4">= </span><span class="s5">&quot;&lt;h1&gt;foo</span><span class="s3">\0</span><span class="s5">bar&lt;/h1&gt;&quot;</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">data</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;foo</span><span class="s3">\0</span><span class="s5">bar&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">h1</span><span class="s4">.</span><span class="s1">string</span>

    <span class="s3">def </span><span class="s1">test_exclude_encodings</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">utf8_data </span><span class="s4">= </span><span class="s5">&quot;Räksmörgås&quot;</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">(</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">)</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">utf8_data</span><span class="s4">, </span><span class="s1">exclude_encodings</span><span class="s4">=[</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">])</span>
        <span class="s3">assert </span><span class="s5">&quot;windows-1252&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">original_encoding</span>

    <span class="s3">def </span><span class="s1">test_custom_builder_class</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Verify that you can pass in a custom Builder class and</span>
        <span class="s0"># it'll be instantiated with the appropriate keyword arguments.</span>
        <span class="s3">class </span><span class="s1">Mock</span><span class="s4">(</span><span class="s1">object</span><span class="s4">):</span>
            <span class="s3">def </span><span class="s1">__init__</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">called_with </span><span class="s4">= </span><span class="s1">kwargs</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">is_xml </span><span class="s4">= </span><span class="s3">True</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">store_line_numbers </span><span class="s4">= </span><span class="s3">False</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">cdata_list_attributes </span><span class="s4">= []</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">preserve_whitespace_tags </span><span class="s4">= []</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">string_containers </span><span class="s4">= {}</span>
            <span class="s3">def </span><span class="s1">initialize_soup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">soup</span><span class="s4">):</span>
                <span class="s3">pass</span>
            <span class="s3">def </span><span class="s1">feed</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">markup</span><span class="s4">):</span>
                <span class="s1">self</span><span class="s4">.</span><span class="s1">fed </span><span class="s4">= </span><span class="s1">markup</span>
            <span class="s3">def </span><span class="s1">reset</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
                <span class="s3">pass</span>
            <span class="s3">def </span><span class="s1">ignore</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">ignore</span><span class="s4">):</span>
                <span class="s3">pass</span>
            <span class="s1">set_up_substitutions </span><span class="s4">= </span><span class="s1">can_be_empty_element </span><span class="s4">= </span><span class="s1">ignore</span>
            <span class="s3">def </span><span class="s1">prepare_markup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
                <span class="s3">yield </span><span class="s5">&quot;prepared markup&quot;</span><span class="s4">, </span><span class="s5">&quot;original encoding&quot;</span><span class="s4">, </span><span class="s5">&quot;declared encoding&quot;</span><span class="s4">, </span><span class="s5">&quot;contains replacement characters&quot;</span>
                
        <span class="s1">kwargs </span><span class="s4">= </span><span class="s1">dict</span><span class="s4">(</span>
            <span class="s1">var</span><span class="s4">=</span><span class="s5">&quot;value&quot;</span><span class="s4">,</span>
            <span class="s0"># This is a deprecated BS3-era keyword argument, which</span>
            <span class="s0"># will be stripped out.</span>
            <span class="s1">convertEntities</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
        <span class="s4">)</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">):</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">''</span><span class="s4">, </span><span class="s1">builder</span><span class="s4">=</span><span class="s1">Mock</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">soup</span><span class="s4">.</span><span class="s1">builder</span><span class="s4">, </span><span class="s1">Mock</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">dict</span><span class="s4">(</span><span class="s1">var</span><span class="s4">=</span><span class="s5">&quot;value&quot;</span><span class="s4">) == </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">builder</span><span class="s4">.</span><span class="s1">called_with</span>
        <span class="s3">assert </span><span class="s5">&quot;prepared markup&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">builder</span><span class="s4">.</span><span class="s1">fed</span>
        
        <span class="s0"># You can also instantiate the TreeBuilder yourself. In this</span>
        <span class="s0"># case, that specific object is used and any keyword arguments</span>
        <span class="s0"># to the BeautifulSoup constructor are ignored.</span>
        <span class="s1">builder </span><span class="s4">= </span><span class="s1">Mock</span><span class="s4">(**</span><span class="s1">kwargs</span><span class="s4">)</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span>
                <span class="s5">''</span><span class="s4">, </span><span class="s1">builder</span><span class="s4">=</span><span class="s1">builder</span><span class="s4">, </span><span class="s1">ignored_value</span><span class="s4">=</span><span class="s3">True</span><span class="s4">,</span>
            <span class="s4">)</span>
        <span class="s1">msg </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">w</span><span class="s4">[</span><span class="s6">0</span><span class="s4">].</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">msg</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s5">&quot;Keyword arguments to the BeautifulSoup constructor will be ignored.&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">builder </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">builder</span>
        <span class="s3">assert </span><span class="s1">kwargs </span><span class="s4">== </span><span class="s1">builder</span><span class="s4">.</span><span class="s1">called_with</span>

    <span class="s3">def </span><span class="s1">test_parser_markup_rejection</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># If markup is completely rejected by the parser, an</span>
        <span class="s0"># explanatory ParserRejectedMarkup exception is raised.</span>
        <span class="s3">class </span><span class="s1">Mock</span><span class="s4">(</span><span class="s1">TreeBuilder</span><span class="s4">):</span>
            <span class="s3">def </span><span class="s1">feed</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
                <span class="s3">raise </span><span class="s1">ParserRejectedMarkup</span><span class="s4">(</span><span class="s5">&quot;Nope.&quot;</span><span class="s4">)</span>

        <span class="s3">def </span><span class="s1">prepare_markup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, *</span><span class="s1">args</span><span class="s4">, **</span><span class="s1">kwargs</span><span class="s4">):</span>
            <span class="s0"># We're going to try two different ways of preparing this markup,</span>
            <span class="s0"># but feed() will reject both of them.</span>
            <span class="s3">yield </span><span class="s1">markup</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s3">False</span>
            <span class="s3">yield </span><span class="s1">markup</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s3">None</span><span class="s4">, </span><span class="s3">False</span>
            

        <span class="s3">import </span><span class="s1">re</span>
        <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">ParserRejectedMarkup</span><span class="s4">) </span><span class="s3">as </span><span class="s1">exc_info</span><span class="s4">:</span>
            <span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">''</span><span class="s4">, </span><span class="s1">builder</span><span class="s4">=</span><span class="s1">Mock</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;The markup you provided was rejected by the parser. Trying a different parser or a different encoding may help.&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">exc_info</span><span class="s4">.</span><span class="s1">value</span><span class="s4">)</span>
        
    <span class="s3">def </span><span class="s1">test_cdata_list_attributes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Most attribute values are represented as scalars, but the</span>
        <span class="s0"># HTML standard says that some attributes, like 'class' have</span>
        <span class="s0"># space-separated lists as values.</span>
        <span class="s1">markup </span><span class="s4">= </span><span class="s5">'&lt;a id=&quot; an id &quot; class=&quot; a class &quot;&gt;&lt;/a&gt;'</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">markup</span><span class="s4">)</span>

        <span class="s0"># Note that the spaces are stripped for 'class' but not for 'id'.</span>
        <span class="s1">a </span><span class="s4">= </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">a</span>
        <span class="s3">assert </span><span class="s5">&quot; an id &quot; </span><span class="s4">== </span><span class="s1">a</span><span class="s4">[</span><span class="s5">'id'</span><span class="s4">]</span>
        <span class="s3">assert </span><span class="s4">[</span><span class="s5">&quot;a&quot;</span><span class="s4">, </span><span class="s5">&quot;class&quot;</span><span class="s4">] == </span><span class="s1">a</span><span class="s4">[</span><span class="s5">'class'</span><span class="s4">]</span>

        <span class="s0"># TreeBuilder takes an argument called 'multi_valued_attributes'  which lets</span>
        <span class="s0"># you customize or disable this. As always, you can customize the TreeBuilder</span>
        <span class="s0"># by passing in a keyword argument to the BeautifulSoup constructor.</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">markup</span><span class="s4">, </span><span class="s1">builder</span><span class="s4">=</span><span class="s1">default_builder</span><span class="s4">, </span><span class="s1">multi_valued_attributes</span><span class="s4">=</span><span class="s3">None</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot; a class &quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">a</span><span class="s4">[</span><span class="s5">'class'</span><span class="s4">]</span>

        <span class="s0"># Here are two ways of saying that `id` is a multi-valued</span>
        <span class="s0"># attribute in this context, but 'class' is not.</span>
        <span class="s3">for </span><span class="s1">switcheroo </span><span class="s3">in </span><span class="s4">({</span><span class="s5">'*'</span><span class="s4">: </span><span class="s5">'id'</span><span class="s4">}, {</span><span class="s5">'a'</span><span class="s4">: </span><span class="s5">'id'</span><span class="s4">}):</span>
            <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
                <span class="s0"># This will create a warning about not explicitly</span>
                <span class="s0"># specifying a parser, but we'll ignore it.</span>
                <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">markup</span><span class="s4">, </span><span class="s1">builder</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">multi_valued_attributes</span><span class="s4">=</span><span class="s1">switcheroo</span><span class="s4">)</span>
            <span class="s1">a </span><span class="s4">= </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">a</span>
            <span class="s3">assert </span><span class="s4">[</span><span class="s5">&quot;an&quot;</span><span class="s4">, </span><span class="s5">&quot;id&quot;</span><span class="s4">] == </span><span class="s1">a</span><span class="s4">[</span><span class="s5">'id'</span><span class="s4">]</span>
            <span class="s3">assert </span><span class="s5">&quot; a class &quot; </span><span class="s4">== </span><span class="s1">a</span><span class="s4">[</span><span class="s5">'class'</span><span class="s4">]</span>

    <span class="s3">def </span><span class="s1">test_replacement_classes</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Test the ability to pass in replacements for element classes</span>
        <span class="s0"># which will be used when building the tree.</span>
        <span class="s3">class </span><span class="s1">TagPlus</span><span class="s4">(</span><span class="s1">Tag</span><span class="s4">):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">StringPlus</span><span class="s4">(</span><span class="s1">NavigableString</span><span class="s4">):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">CommentPlus</span><span class="s4">(</span><span class="s1">Comment</span><span class="s4">):</span>
            <span class="s3">pass</span>
        
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span>
            <span class="s5">&quot;&lt;a&gt;&lt;b&gt;foo&lt;/b&gt;bar&lt;/a&gt;&lt;!--whee--&gt;&quot;</span><span class="s4">,</span>
            <span class="s1">element_classes </span><span class="s4">= {</span>
                <span class="s1">Tag</span><span class="s4">: </span><span class="s1">TagPlus</span><span class="s4">,</span>
                <span class="s1">NavigableString</span><span class="s4">: </span><span class="s1">StringPlus</span><span class="s4">,</span>
                <span class="s1">Comment</span><span class="s4">: </span><span class="s1">CommentPlus</span><span class="s4">,</span>
            <span class="s4">}</span>
        <span class="s4">)</span>

        <span class="s0"># The tree was built with TagPlus, StringPlus, and CommentPlus objects,</span>
        <span class="s0"># rather than Tag, String, and Comment objects.</span>
        <span class="s3">assert </span><span class="s1">all</span><span class="s4">(</span>
            <span class="s1">isinstance</span><span class="s4">(</span><span class="s1">x</span><span class="s4">, (</span><span class="s1">TagPlus</span><span class="s4">, </span><span class="s1">StringPlus</span><span class="s4">, </span><span class="s1">CommentPlus</span><span class="s4">))</span>
            <span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">recursiveChildGenerator</span><span class="s4">()</span>
        <span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_alternate_string_containers</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Test the ability to customize the string containers for</span>
        <span class="s0"># different types of tags.</span>
        <span class="s3">class </span><span class="s1">PString</span><span class="s4">(</span><span class="s1">NavigableString</span><span class="s4">):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">BString</span><span class="s4">(</span><span class="s1">NavigableString</span><span class="s4">):</span>
            <span class="s3">pass</span>

        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span>
            <span class="s5">&quot;&lt;div&gt;Hello.&lt;p&gt;Here is &lt;b&gt;some &lt;i&gt;bolded&lt;/i&gt;&lt;/b&gt; text&quot;</span><span class="s4">,</span>
            <span class="s1">string_containers </span><span class="s4">= {</span>
                <span class="s5">'b'</span><span class="s4">: </span><span class="s1">BString</span><span class="s4">,</span>
                <span class="s5">'p'</span><span class="s4">: </span><span class="s1">PString</span><span class="s4">,</span>
            <span class="s4">}</span>
        <span class="s4">)</span>

        <span class="s0"># The string before the &lt;p&gt; tag is a regular NavigableString.</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">soup</span><span class="s4">.</span><span class="s1">div</span><span class="s4">.</span><span class="s1">contents</span><span class="s4">[</span><span class="s6">0</span><span class="s4">], </span><span class="s1">NavigableString</span><span class="s4">)</span>
        
        <span class="s0"># The string inside the &lt;p&gt; tag, but not inside the &lt;i&gt; tag,</span>
        <span class="s0"># is a PString.</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">soup</span><span class="s4">.</span><span class="s1">p</span><span class="s4">.</span><span class="s1">contents</span><span class="s4">[</span><span class="s6">0</span><span class="s4">], </span><span class="s1">PString</span><span class="s4">)</span>

        <span class="s0"># Every string inside the &lt;b&gt; tag is a BString, even the one that</span>
        <span class="s0"># was also inside an &lt;i&gt; tag.</span>
        <span class="s3">for </span><span class="s1">s </span><span class="s3">in </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">b</span><span class="s4">.</span><span class="s1">strings</span><span class="s4">:</span>
            <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">s</span><span class="s4">, </span><span class="s1">BString</span><span class="s4">)</span>

        <span class="s0"># Now that parsing was complete, the string_container_stack</span>
        <span class="s0"># (where this information was kept) has been cleared out.</span>
        <span class="s3">assert </span><span class="s4">[] == </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">string_container_stack</span>


<span class="s3">class </span><span class="s1">TestOutput</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>

    <span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span>
        <span class="s5">&quot;eventual_encoding,actual_encoding&quot;</span><span class="s4">, [</span>
            <span class="s4">(</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">, </span><span class="s5">&quot;utf-8&quot;</span><span class="s4">),</span>
            <span class="s4">(</span><span class="s5">&quot;utf-16&quot;</span><span class="s4">, </span><span class="s5">&quot;utf-16&quot;</span><span class="s4">),</span>
        <span class="s4">]</span>
    <span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_decode_xml_declaration</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">eventual_encoding</span><span class="s4">, </span><span class="s1">actual_encoding</span><span class="s4">):</span>
        <span class="s0"># Most of the time, calling decode() on an XML document will</span>
        <span class="s0"># give you a document declaration that mentions the encoding</span>
        <span class="s0"># you intend to use when encoding the document as a</span>
        <span class="s0"># bytestring.</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&lt;tag&gt;&lt;/tag&gt;&quot;</span><span class="s4">)</span>
        <span class="s1">soup</span><span class="s4">.</span><span class="s1">is_xml </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">assert </span><span class="s4">(</span><span class="s5">f'&lt;?xml version=&quot;1.0&quot; encoding=&quot;</span><span class="s3">{</span><span class="s1">actual_encoding</span><span class="s3">}</span><span class="s5">&quot;?&gt;</span><span class="s3">\n</span><span class="s5">&lt;tag&gt;&lt;/tag&gt;'</span>
                <span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">(</span><span class="s1">eventual_encoding</span><span class="s4">=</span><span class="s1">eventual_encoding</span><span class="s4">))</span>

    <span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span>
        <span class="s5">&quot;eventual_encoding&quot;</span><span class="s4">, [</span><span class="s1">x </span><span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">PYTHON_SPECIFIC_ENCODINGS</span><span class="s4">] + [</span><span class="s3">None</span><span class="s4">]</span>
    <span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_decode_xml_declaration_with_missing_or_python_internal_eventual_encoding</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">eventual_encoding</span><span class="s4">):</span>
        <span class="s0"># But if you pass a Python internal encoding into decode(), or</span>
        <span class="s0"># omit the eventual_encoding altogether, the document</span>
        <span class="s0"># declaration won't mention any particular encoding.</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;&lt;tag&gt;&lt;/tag&gt;&quot;</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">)</span>
        <span class="s1">soup</span><span class="s4">.</span><span class="s1">is_xml </span><span class="s4">= </span><span class="s3">True</span>
        <span class="s3">assert </span><span class="s4">(</span><span class="s5">f'&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="s3">\n</span><span class="s5">&lt;tag&gt;&lt;/tag&gt;'</span>
                <span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">(</span><span class="s1">eventual_encoding</span><span class="s4">=</span><span class="s1">eventual_encoding</span><span class="s4">))</span>

    <span class="s3">def </span><span class="s1">test</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># BeautifulSoup subclasses Tag and extends the decode() method.</span>
        <span class="s0"># Make sure the other Tag methods which call decode() call</span>
        <span class="s0"># it correctly.</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&lt;tag&gt;&lt;/tag&gt;&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;tag&gt;&lt;/tag&gt;&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">(</span><span class="s1">encoding</span><span class="s4">=</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;tag&gt;&lt;/tag&gt;&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">encode_contents</span><span class="s4">(</span><span class="s1">encoding</span><span class="s4">=</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;&lt;tag&gt;&lt;/tag&gt;&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">decode_contents</span><span class="s4">()</span>
        <span class="s3">assert </span><span class="s5">&quot;&lt;tag&gt;</span><span class="s3">\n</span><span class="s5">&lt;/tag&gt;</span><span class="s3">\n</span><span class="s5">&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">prettify</span><span class="s4">()</span>

        
<span class="s3">class </span><span class="s1">TestWarnings</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>
    <span class="s0"># Note that some of the tests in this class create BeautifulSoup</span>
    <span class="s0"># objects directly rather than using self.soup(). That's</span>
    <span class="s0"># because SoupTest.soup is defined in a different file,</span>
    <span class="s0"># which will throw off the assertion in _assert_warning</span>
    <span class="s0"># that the code that triggered the warning is in the same</span>
    <span class="s0"># file as the test.</span>

    <span class="s3">def </span><span class="s1">_assert_warning</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">warnings</span><span class="s4">, </span><span class="s1">cls</span><span class="s4">):</span>
        <span class="s3">for </span><span class="s1">w </span><span class="s3">in </span><span class="s1">warnings</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">w</span><span class="s4">.</span><span class="s1">message</span><span class="s4">, </span><span class="s1">cls</span><span class="s4">):</span>
                <span class="s3">assert </span><span class="s1">w</span><span class="s4">.</span><span class="s1">filename </span><span class="s4">== </span><span class="s1">__file__</span>
                <span class="s3">return </span><span class="s1">w</span>
        <span class="s3">raise </span><span class="s1">Exception</span><span class="s4">(</span><span class="s5">&quot;%s warning not found in %r&quot; </span><span class="s4">% (</span><span class="s1">cls</span><span class="s4">, </span><span class="s1">warnings</span><span class="s4">))</span>
    
    <span class="s3">def </span><span class="s1">_assert_no_parser_specified</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">w</span><span class="s4">):</span>
        <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span><span class="s1">w</span><span class="s4">, </span><span class="s1">GuessedAtParserWarning</span><span class="s4">)</span>
        <span class="s1">message </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">message</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s1">BeautifulSoup</span><span class="s4">.</span><span class="s1">NO_PARSER_SPECIFIED_WARNING</span><span class="s4">[:</span><span class="s6">60</span><span class="s4">])</span>

    <span class="s3">def </span><span class="s1">test_warning_if_no_parser_specified</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;&quot;</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_no_parser_specified</span><span class="s4">(</span><span class="s1">w</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_warning_if_parser_specified_too_vague</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;&quot;</span><span class="s4">, </span><span class="s5">&quot;html&quot;</span><span class="s4">)</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_no_parser_specified</span><span class="s4">(</span><span class="s1">w</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_no_warning_if_explicit_parser_specified</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s4">[] == </span><span class="s1">w</span>

    <span class="s3">def </span><span class="s1">test_parseOnlyThese_renamed_to_parse_only</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span>
                <span class="s5">&quot;&lt;a&gt;&lt;b&gt;&lt;/b&gt;&lt;/a&gt;&quot;</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">,</span>
                <span class="s1">parseOnlyThese</span><span class="s4">=</span><span class="s1">SoupStrainer</span><span class="s4">(</span><span class="s5">&quot;b&quot;</span><span class="s4">),</span>
            <span class="s4">)</span>
        <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span><span class="s1">w</span><span class="s4">, </span><span class="s1">DeprecationWarning</span><span class="s4">)</span>
        <span class="s1">msg </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;parseOnlyThese&quot; </span><span class="s3">in </span><span class="s1">msg</span>
        <span class="s3">assert </span><span class="s5">&quot;parse_only&quot; </span><span class="s3">in </span><span class="s1">msg</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;b&gt;&lt;/b&gt;&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">test_fromEncoding_renamed_to_from_encoding</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">utf8 </span><span class="s4">= </span><span class="s7">b&quot;</span><span class="s3">\xc3\xa9</span><span class="s7">&quot;</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span>
                <span class="s1">utf8</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">, </span><span class="s1">fromEncoding</span><span class="s4">=</span><span class="s5">&quot;utf8&quot;</span>
            <span class="s4">)</span>
        <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span><span class="s1">w</span><span class="s4">, </span><span class="s1">DeprecationWarning</span><span class="s4">)</span>
        <span class="s1">msg </span><span class="s4">= </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;fromEncoding&quot; </span><span class="s3">in </span><span class="s1">msg</span>
        <span class="s3">assert </span><span class="s5">&quot;from_encoding&quot; </span><span class="s3">in </span><span class="s1">msg</span>
        <span class="s3">assert </span><span class="s5">&quot;utf8&quot; </span><span class="s4">== </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">original_encoding</span>

    <span class="s3">def </span><span class="s1">test_unrecognized_keyword_argument</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">raises</span><span class="s4">(</span><span class="s1">TypeError</span><span class="s4">):</span>
            <span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&lt;a&gt;&quot;</span><span class="s4">, </span><span class="s1">no_such_argument</span><span class="s4">=</span><span class="s3">True</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span>
        <span class="s5">&quot;extension&quot;</span><span class="s4">,</span>
        <span class="s4">[</span><span class="s5">'markup.html'</span><span class="s4">, </span><span class="s5">'markup.htm'</span><span class="s4">, </span><span class="s5">'markup.HTML'</span><span class="s4">, </span><span class="s5">'markup.txt'</span><span class="s4">,</span>
         <span class="s5">'markup.xhtml'</span><span class="s4">, </span><span class="s5">'markup.xml'</span><span class="s4">, </span><span class="s5">&quot;/home/user/file&quot;</span><span class="s4">, </span><span class="s5">&quot;c:</span><span class="s3">\\</span><span class="s5">user</span><span class="s3">\f</span><span class="s5">ile&quot;</span><span class="s4">]</span>
    <span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_resembles_filename_warning</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">extension</span><span class="s4">):</span>
        <span class="s0"># A warning is issued if the &quot;markup&quot; looks like the name of</span>
        <span class="s0"># an HTML or text file, or a full path to a file on disk.</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;markup&quot; </span><span class="s4">+ </span><span class="s1">extension</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">)</span>
            <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span><span class="s1">w</span><span class="s4">, </span><span class="s1">MarkupResemblesLocatorWarning</span><span class="s4">)</span>
            <span class="s3">assert </span><span class="s5">&quot;looks more like a filename&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>

    <span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">parametrize</span><span class="s4">(</span>
        <span class="s5">&quot;extension&quot;</span><span class="s4">,</span>
        <span class="s4">[</span><span class="s5">'markuphtml'</span><span class="s4">, </span><span class="s5">'markup.com'</span><span class="s4">, </span><span class="s5">''</span><span class="s4">, </span><span class="s5">'markup.js'</span><span class="s4">]</span>
    <span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_resembles_filename_no_warning</span><span class="s4">(</span><span class="s1">self</span><span class="s4">, </span><span class="s1">extension</span><span class="s4">):</span>
        <span class="s0"># The 'looks more like a filename' warning is not issued if</span>
        <span class="s0"># the markup looks like a bare string, a domain name, or a</span>
        <span class="s0"># file that's not an HTML file.</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">w</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;markup&quot; </span><span class="s4">+ </span><span class="s1">extension</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s4">[] == </span><span class="s1">w</span>

    <span class="s3">def </span><span class="s1">test_url_warning_with_bytes_url</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">url </span><span class="s4">= </span><span class="s7">b&quot;http://www.crummybytes.com/&quot;</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">warning_list</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s1">url</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">)</span>
        <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span>
            <span class="s1">warning_list</span><span class="s4">, </span><span class="s1">MarkupResemblesLocatorWarning</span>
        <span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;looks more like a URL&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">url </span><span class="s3">not in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">).</span><span class="s1">encode</span><span class="s4">(</span><span class="s5">&quot;utf8&quot;</span><span class="s4">)</span>
        
    <span class="s3">def </span><span class="s1">test_url_warning_with_unicode_url</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">url </span><span class="s4">= </span><span class="s5">&quot;http://www.crummyunicode.com/&quot;</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">warning_list</span><span class="s4">:</span>
            <span class="s0"># note - this url must differ from the bytes one otherwise</span>
            <span class="s0"># python's warnings system swallows the second warning</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s1">url</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">)</span>
        <span class="s1">warning </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">_assert_warning</span><span class="s4">(</span>
            <span class="s1">warning_list</span><span class="s4">, </span><span class="s1">MarkupResemblesLocatorWarning</span>
        <span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;looks more like a URL&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">url </span><span class="s3">not in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">warning</span><span class="s4">.</span><span class="s1">message</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_url_warning_with_bytes_and_space</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Here the markup contains something besides a URL, so no warning</span>
        <span class="s0"># is issued.</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">warning_list</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s7">b&quot;http://www.crummybytes.com/ is great&quot;</span><span class="s4">)</span>
        <span class="s3">assert not </span><span class="s1">any</span><span class="s4">(</span><span class="s5">&quot;looks more like a URL&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">w</span><span class="s4">.</span><span class="s1">message</span><span class="s4">) </span>
                       <span class="s3">for </span><span class="s1">w </span><span class="s3">in </span><span class="s1">warning_list</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_url_warning_with_unicode_and_space</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s3">with </span><span class="s1">warnings</span><span class="s4">.</span><span class="s1">catch_warnings</span><span class="s4">(</span><span class="s1">record</span><span class="s4">=</span><span class="s3">True</span><span class="s4">) </span><span class="s3">as </span><span class="s1">warning_list</span><span class="s4">:</span>
            <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;http://www.crummyunicode.com/ is great&quot;</span><span class="s4">)</span>
        <span class="s3">assert not </span><span class="s1">any</span><span class="s4">(</span><span class="s5">&quot;looks more like a URL&quot; </span><span class="s3">in </span><span class="s1">str</span><span class="s4">(</span><span class="s1">w</span><span class="s4">.</span><span class="s1">message</span><span class="s4">) </span>
                       <span class="s3">for </span><span class="s1">w </span><span class="s3">in </span><span class="s1">warning_list</span><span class="s4">)</span>


<span class="s3">class </span><span class="s1">TestSelectiveParsing</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>

    <span class="s3">def </span><span class="s1">test_parse_with_soupstrainer</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">markup </span><span class="s4">= </span><span class="s5">&quot;No&lt;b&gt;Yes&lt;/b&gt;&lt;a&gt;No&lt;b&gt;Yes &lt;c&gt;Yes&lt;/c&gt;&lt;/b&gt;&quot;</span>
        <span class="s1">strainer </span><span class="s4">= </span><span class="s1">SoupStrainer</span><span class="s4">(</span><span class="s5">&quot;b&quot;</span><span class="s4">)</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">markup</span><span class="s4">, </span><span class="s1">parse_only</span><span class="s4">=</span><span class="s1">strainer</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">() == </span><span class="s7">b&quot;&lt;b&gt;Yes&lt;/b&gt;&lt;b&gt;Yes &lt;c&gt;Yes&lt;/c&gt;&lt;/b&gt;&quot;</span>

        
<span class="s3">class </span><span class="s1">TestNewTag</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Test the BeautifulSoup.new_tag() method.&quot;&quot;&quot;</span>
    <span class="s3">def </span><span class="s1">test_new_tag</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">)</span>
        <span class="s1">new_tag </span><span class="s4">= </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">new_tag</span><span class="s4">(</span><span class="s5">&quot;foo&quot;</span><span class="s4">, </span><span class="s1">bar</span><span class="s4">=</span><span class="s5">&quot;baz&quot;</span><span class="s4">, </span><span class="s1">attrs</span><span class="s4">={</span><span class="s5">&quot;name&quot;</span><span class="s4">: </span><span class="s5">&quot;a name&quot;</span><span class="s4">})</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">new_tag</span><span class="s4">, </span><span class="s1">Tag</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;foo&quot; </span><span class="s4">== </span><span class="s1">new_tag</span><span class="s4">.</span><span class="s1">name</span>
        <span class="s3">assert </span><span class="s1">dict</span><span class="s4">(</span><span class="s1">bar</span><span class="s4">=</span><span class="s5">&quot;baz&quot;</span><span class="s4">, </span><span class="s1">name</span><span class="s4">=</span><span class="s5">&quot;a name&quot;</span><span class="s4">) == </span><span class="s1">new_tag</span><span class="s4">.</span><span class="s1">attrs</span>
        <span class="s3">assert None </span><span class="s4">== </span><span class="s1">new_tag</span><span class="s4">.</span><span class="s1">parent</span>

    <span class="s4">@</span><span class="s1">pytest</span><span class="s4">.</span><span class="s1">mark</span><span class="s4">.</span><span class="s1">skipif</span><span class="s4">(</span>
        <span class="s3">not </span><span class="s1">LXML_PRESENT</span><span class="s4">,</span>
        <span class="s1">reason</span><span class="s4">=</span><span class="s5">&quot;lxml not installed, cannot parse XML document&quot;</span>
    <span class="s4">)</span>
    <span class="s3">def </span><span class="s1">test_xml_tag_inherits_self_closing_rules_from_builder</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">xml_soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s5">&quot;xml&quot;</span><span class="s4">)</span>
        <span class="s1">xml_br </span><span class="s4">= </span><span class="s1">xml_soup</span><span class="s4">.</span><span class="s1">new_tag</span><span class="s4">(</span><span class="s5">&quot;br&quot;</span><span class="s4">)</span>
        <span class="s1">xml_p </span><span class="s4">= </span><span class="s1">xml_soup</span><span class="s4">.</span><span class="s1">new_tag</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">)</span>

        <span class="s0"># Both the &lt;br&gt; and &lt;p&gt; tag are empty-element, just because</span>
        <span class="s0"># they have no contents.</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;br/&gt;&quot; </span><span class="s4">== </span><span class="s1">xml_br</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">()</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;p/&gt;&quot; </span><span class="s4">== </span><span class="s1">xml_p</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">()</span>

    <span class="s3">def </span><span class="s1">test_tag_inherits_self_closing_rules_from_builder</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">html_soup </span><span class="s4">= </span><span class="s1">BeautifulSoup</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s5">&quot;html.parser&quot;</span><span class="s4">)</span>
        <span class="s1">html_br </span><span class="s4">= </span><span class="s1">html_soup</span><span class="s4">.</span><span class="s1">new_tag</span><span class="s4">(</span><span class="s5">&quot;br&quot;</span><span class="s4">)</span>
        <span class="s1">html_p </span><span class="s4">= </span><span class="s1">html_soup</span><span class="s4">.</span><span class="s1">new_tag</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">)</span>

        <span class="s0"># The HTML builder users HTML's rules about which tags are</span>
        <span class="s0"># empty-element tags, and the new tags reflect these rules.</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;br/&gt;&quot; </span><span class="s4">== </span><span class="s1">html_br</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">()</span>
        <span class="s3">assert </span><span class="s7">b&quot;&lt;p&gt;&lt;/p&gt;&quot; </span><span class="s4">== </span><span class="s1">html_p</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">()</span>

<span class="s3">class </span><span class="s1">TestNewString</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Test the BeautifulSoup.new_string() method.&quot;&quot;&quot;</span>
    <span class="s3">def </span><span class="s1">test_new_string_creates_navigablestring</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">)</span>
        <span class="s1">s </span><span class="s4">= </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">new_string</span><span class="s4">(</span><span class="s5">&quot;foo&quot;</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;foo&quot; </span><span class="s4">== </span><span class="s1">s</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">s</span><span class="s4">, </span><span class="s1">NavigableString</span><span class="s4">)</span>

    <span class="s3">def </span><span class="s1">test_new_string_can_create_navigablestring_subclass</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">)</span>
        <span class="s1">s </span><span class="s4">= </span><span class="s1">soup</span><span class="s4">.</span><span class="s1">new_string</span><span class="s4">(</span><span class="s5">&quot;foo&quot;</span><span class="s4">, </span><span class="s1">Comment</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;foo&quot; </span><span class="s4">== </span><span class="s1">s</span>
        <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">s</span><span class="s4">, </span><span class="s1">Comment</span><span class="s4">)</span>


<span class="s3">class </span><span class="s1">TestPickle</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>
   <span class="s0"># Test our ability to pickle the BeautifulSoup object itself.</span>

    <span class="s3">def </span><span class="s1">test_normal_pickle</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;&lt;a&gt;some markup&lt;/a&gt;&quot;</span><span class="s4">)</span>
        <span class="s1">pickled </span><span class="s4">= </span><span class="s1">pickle</span><span class="s4">.</span><span class="s1">dumps</span><span class="s4">(</span><span class="s1">soup</span><span class="s4">)</span>
        <span class="s1">unpickled </span><span class="s4">= </span><span class="s1">pickle</span><span class="s4">.</span><span class="s1">loads</span><span class="s4">(</span><span class="s1">pickled</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;some markup&quot; </span><span class="s4">== </span><span class="s1">unpickled</span><span class="s4">.</span><span class="s1">a</span><span class="s4">.</span><span class="s1">string</span>
        
    <span class="s3">def </span><span class="s1">test_pickle_with_no_builder</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># We had a bug that prevented pickling from working if</span>
        <span class="s0"># the builder wasn't set.</span>
        <span class="s1">soup </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s5">&quot;some markup&quot;</span><span class="s4">)</span>
        <span class="s1">soup</span><span class="s4">.</span><span class="s1">builder </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s1">pickled </span><span class="s4">= </span><span class="s1">pickle</span><span class="s4">.</span><span class="s1">dumps</span><span class="s4">(</span><span class="s1">soup</span><span class="s4">)</span>
        <span class="s1">unpickled </span><span class="s4">= </span><span class="s1">pickle</span><span class="s4">.</span><span class="s1">loads</span><span class="s4">(</span><span class="s1">pickled</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s5">&quot;some markup&quot; </span><span class="s4">== </span><span class="s1">unpickled</span><span class="s4">.</span><span class="s1">string</span>

<span class="s3">class </span><span class="s1">TestEncodingConversion</span><span class="s4">(</span><span class="s1">SoupTest</span><span class="s4">):</span>
    <span class="s0"># Test Beautiful Soup's ability to decode and encode from various</span>
    <span class="s0"># encodings.</span>

    <span class="s3">def </span><span class="s1">setup_method</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data </span><span class="s4">= </span><span class="s5">'&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;/&gt;&lt;/head&gt;&lt;body&gt;&lt;foo&gt;Sacr</span><span class="s3">\N{LATIN SMALL LETTER E WITH ACUTE} </span><span class="s5">bleu!&lt;/foo&gt;&lt;/body&gt;&lt;/html&gt;'</span>
        <span class="s1">self</span><span class="s4">.</span><span class="s1">utf8_data </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">(</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">)</span>
        <span class="s0"># Just so you know what it looks like.</span>
        <span class="s3">assert </span><span class="s1">self</span><span class="s4">.</span><span class="s1">utf8_data </span><span class="s4">== </span><span class="s7">b'&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;/&gt;&lt;/head&gt;&lt;body&gt;&lt;foo&gt;Sacr</span><span class="s3">\xc3\xa9 </span><span class="s7">bleu!&lt;/foo&gt;&lt;/body&gt;&lt;/html&gt;'</span>

    <span class="s3">def </span><span class="s1">test_ascii_in_unicode_out</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># ASCII input is converted to Unicode. The original_encoding</span>
        <span class="s0"># attribute is set to 'utf-8', a superset of ASCII.</span>
        <span class="s1">chardet </span><span class="s4">= </span><span class="s1">dammit</span><span class="s4">.</span><span class="s1">chardet_dammit</span>
        <span class="s1">logging</span><span class="s4">.</span><span class="s1">disable</span><span class="s4">(</span><span class="s1">logging</span><span class="s4">.</span><span class="s1">WARNING</span><span class="s4">)</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s3">def </span><span class="s1">noop</span><span class="s4">(</span><span class="s1">str</span><span class="s4">):</span>
                <span class="s3">return None</span>
            <span class="s0"># Disable chardet, which will realize that the ASCII is ASCII.</span>
            <span class="s1">dammit</span><span class="s4">.</span><span class="s1">chardet_dammit </span><span class="s4">= </span><span class="s1">noop</span>
            <span class="s1">ascii </span><span class="s4">= </span><span class="s7">b&quot;&lt;foo&gt;a&lt;/foo&gt;&quot;</span>
            <span class="s1">soup_from_ascii </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">ascii</span><span class="s4">)</span>
            <span class="s1">unicode_output </span><span class="s4">= </span><span class="s1">soup_from_ascii</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">()</span>
            <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">unicode_output</span><span class="s4">, </span><span class="s1">str</span><span class="s4">)</span>
            <span class="s3">assert </span><span class="s1">unicode_output </span><span class="s4">== </span><span class="s1">self</span><span class="s4">.</span><span class="s1">document_for</span><span class="s4">(</span><span class="s1">ascii</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">())</span>
            <span class="s3">assert </span><span class="s1">soup_from_ascii</span><span class="s4">.</span><span class="s1">original_encoding</span><span class="s4">.</span><span class="s1">lower</span><span class="s4">() == </span><span class="s5">&quot;utf-8&quot;</span>
        <span class="s3">finally</span><span class="s4">:</span>
            <span class="s1">logging</span><span class="s4">.</span><span class="s1">disable</span><span class="s4">(</span><span class="s1">logging</span><span class="s4">.</span><span class="s1">NOTSET</span><span class="s4">)</span>
            <span class="s1">dammit</span><span class="s4">.</span><span class="s1">chardet_dammit </span><span class="s4">= </span><span class="s1">chardet</span>

    <span class="s3">def </span><span class="s1">test_unicode_in_unicode_out</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># Unicode input is left alone. The original_encoding attribute</span>
        <span class="s0"># is not set.</span>
        <span class="s1">soup_from_unicode </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">soup_from_unicode</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">() == </span><span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data</span>
        <span class="s3">assert </span><span class="s1">soup_from_unicode</span><span class="s4">.</span><span class="s1">foo</span><span class="s4">.</span><span class="s1">string </span><span class="s4">== </span><span class="s5">'Sacr</span><span class="s3">\xe9 </span><span class="s5">bleu!'</span>
        <span class="s3">assert </span><span class="s1">soup_from_unicode</span><span class="s4">.</span><span class="s1">original_encoding </span><span class="s4">== </span><span class="s3">None</span>

    <span class="s3">def </span><span class="s1">test_utf8_in_unicode_out</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># UTF-8 input is converted to Unicode. The original_encoding</span>
        <span class="s0"># attribute is set.</span>
        <span class="s1">soup_from_utf8 </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">utf8_data</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">soup_from_utf8</span><span class="s4">.</span><span class="s1">decode</span><span class="s4">() == </span><span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data</span>
        <span class="s3">assert </span><span class="s1">soup_from_utf8</span><span class="s4">.</span><span class="s1">foo</span><span class="s4">.</span><span class="s1">string </span><span class="s4">== </span><span class="s5">'Sacr</span><span class="s3">\xe9 </span><span class="s5">bleu!'</span>

    <span class="s3">def </span><span class="s1">test_utf8_out</span><span class="s4">(</span><span class="s1">self</span><span class="s4">):</span>
        <span class="s0"># The internal data structures can be encoded as UTF-8.</span>
        <span class="s1">soup_from_unicode </span><span class="s4">= </span><span class="s1">self</span><span class="s4">.</span><span class="s1">soup</span><span class="s4">(</span><span class="s1">self</span><span class="s4">.</span><span class="s1">unicode_data</span><span class="s4">)</span>
        <span class="s3">assert </span><span class="s1">soup_from_unicode</span><span class="s4">.</span><span class="s1">encode</span><span class="s4">(</span><span class="s5">'utf-8'</span><span class="s4">) == </span><span class="s1">self</span><span class="s4">.</span><span class="s1">utf8_data</span>
</pre>
</body>
</html>