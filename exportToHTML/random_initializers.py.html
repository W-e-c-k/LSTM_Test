<html>
<head>
<title>random_initializers.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
random_initializers.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">math</span>

<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src </span><span class="s0">import </span><span class="s1">ops</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">api_export </span><span class="s0">import </span><span class="s1">keras_export</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">backend </span><span class="s0">import </span><span class="s1">random</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">initializers</span><span class="s2">.</span><span class="s1">initializer </span><span class="s0">import </span><span class="s1">Initializer</span>
<span class="s0">from </span><span class="s1">keras</span><span class="s2">.</span><span class="s1">src</span><span class="s2">.</span><span class="s1">saving </span><span class="s0">import </span><span class="s1">serialization_lib</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.RandomNormal&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.random_normal&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">RandomNormal</span><span class="s2">(</span><span class="s1">Initializer</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Random normal initializer. 
 
    Draws samples from a normal distribution for given parameters. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = RandomNormal(mean=0.0, stddev=1.0) 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = RandomNormal(mean=0.0, stddev=1.0) 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        mean: A python scalar or a scalar keras tensor. Mean of the random 
            values to generate. 
        stddev: A python scalar or a scalar keras tensor. Standard deviation of 
           the random values to generate. 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mean</span><span class="s2">=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">stddev</span><span class="s2">=</span><span class="s5">0.05</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">mean </span><span class="s2">= </span><span class="s1">mean</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stddev </span><span class="s2">= </span><span class="s1">stddev</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed </span><span class="s2">= </span><span class="s1">seed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">seed </span><span class="s2">= </span><span class="s1">seed </span><span class="s0">if </span><span class="s1">seed </span><span class="s0">is not None else </span><span class="s1">random</span><span class="s2">.</span><span class="s1">make_default_seed</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span>
            <span class="s1">shape</span><span class="s2">=</span><span class="s1">shape</span><span class="s2">,</span>
            <span class="s1">mean</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">,</span>
            <span class="s1">stddev</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">stddev</span><span class="s2">,</span>
            <span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">,</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">,</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">seed_config </span><span class="s2">= </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s2">{</span><span class="s3">&quot;mean&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">, </span><span class="s3">&quot;stddev&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stddev</span><span class="s2">, </span><span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">seed_config</span><span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.TruncatedNormal&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.truncated_normal&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">TruncatedNormal</span><span class="s2">(</span><span class="s1">Initializer</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Initializer that generates a truncated normal distribution. 
 
    The values generated are similar to values from a 
    `RandomNormal` initializer, except that values more 
    than two standard deviations from the mean are 
    discarded and re-drawn. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = TruncatedNormal(mean=0., stddev=1.) 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = TruncatedNormal(mean=0., stddev=1.) 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        mean: A python scalar or a scalar keras tensor. Mean of the random 
            values to generate. 
        stddev: A python scalar or a scalar keras tensor. Standard deviation of 
           the random values to generate. 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">mean</span><span class="s2">=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">stddev</span><span class="s2">=</span><span class="s5">0.05</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">mean </span><span class="s2">= </span><span class="s1">mean</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">stddev </span><span class="s2">= </span><span class="s1">stddev</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed </span><span class="s2">= </span><span class="s1">seed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">seed </span><span class="s2">= </span><span class="s1">seed </span><span class="s0">if </span><span class="s1">seed </span><span class="s0">is not None else </span><span class="s1">random</span><span class="s2">.</span><span class="s1">make_default_seed</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">truncated_normal</span><span class="s2">(</span>
            <span class="s1">shape</span><span class="s2">=</span><span class="s1">shape</span><span class="s2">,</span>
            <span class="s1">mean</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">,</span>
            <span class="s1">stddev</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">stddev</span><span class="s2">,</span>
            <span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">,</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">,</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">seed_config </span><span class="s2">= </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s2">{</span><span class="s3">&quot;mean&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mean</span><span class="s2">, </span><span class="s3">&quot;stddev&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">stddev</span><span class="s2">, </span><span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">seed_config</span><span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.RandomUniform&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.random_uniform&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">RandomUniform</span><span class="s2">(</span><span class="s1">Initializer</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Random uniform initializer. 
 
    Draws samples from a uniform distribution for given parameters. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = RandomUniform(minval=0.0, maxval=1.0) 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = RandomUniform(minval=0.0, maxval=1.0) 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        minval: A python scalar or a scalar keras tensor. Lower bound of the 
            range of random values to generate (inclusive). 
        maxval: A python scalar or a scalar keras tensor. Upper bound of the 
            range of random values to generate (exclusive). 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">minval</span><span class="s2">=-</span><span class="s5">0.05</span><span class="s2">, </span><span class="s1">maxval</span><span class="s2">=</span><span class="s5">0.05</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">minval </span><span class="s2">= </span><span class="s1">minval</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">maxval </span><span class="s2">= </span><span class="s1">maxval</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed </span><span class="s2">= </span><span class="s1">seed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">seed </span><span class="s2">= </span><span class="s1">seed </span><span class="s0">if </span><span class="s1">seed </span><span class="s0">is not None else </span><span class="s1">random</span><span class="s2">.</span><span class="s1">make_default_seed</span><span class="s2">()</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span>
            <span class="s1">shape</span><span class="s2">=</span><span class="s1">shape</span><span class="s2">,</span>
            <span class="s1">minval</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">minval</span><span class="s2">,</span>
            <span class="s1">maxval</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxval</span><span class="s2">,</span>
            <span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">,</span>
            <span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">,</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">seed_config </span><span class="s2">= </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;minval&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">minval</span><span class="s2">,</span>
            <span class="s3">&quot;maxval&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">maxval</span><span class="s2">,</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">seed_config</span><span class="s2">,</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.VarianceScaling&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.variance_scaling&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">VarianceScaling</span><span class="s2">(</span><span class="s1">Initializer</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Initializer that adapts its scale to the shape of its input tensors. 
 
    With `distribution=&quot;truncated_normal&quot; or &quot;untruncated_normal&quot;`, samples are 
    drawn from a truncated/untruncated normal distribution with a mean of zero 
    and a standard deviation (after truncation, if used) `stddev = sqrt(scale / 
    n)`, where `n` is: 
 
    - number of input units in the weight tensor, if `mode=&quot;fan_in&quot;` 
    - number of output units, if `mode=&quot;fan_out&quot;` 
    - average of the numbers of input and output units, if `mode=&quot;fan_avg&quot;` 
 
    With `distribution=&quot;uniform&quot;`, samples are drawn from a uniform distribution 
    within `[-limit, limit]`, where `limit = sqrt(3 * scale / n)`. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = VarianceScaling( 
        scale=0.1, mode='fan_in', distribution='uniform') 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = VarianceScaling( 
        scale=0.1, mode='fan_in', distribution='uniform') 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        scale: Scaling factor (positive float). 
        mode: One of `&quot;fan_in&quot;`, `&quot;fan_out&quot;`, `&quot;fan_avg&quot;`. 
        distribution: Random distribution to use. 
            One of `&quot;truncated_normal&quot;`, `&quot;untruncated_normal&quot;`, or `&quot;uniform&quot;`. 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span>
        <span class="s1">self</span><span class="s2">,</span>
        <span class="s1">scale</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">,</span>
        <span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">,</span>
        <span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">,</span>
        <span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
    <span class="s2">):</span>
        <span class="s0">if </span><span class="s1">scale </span><span class="s2">&lt;= </span><span class="s5">0.0</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                <span class="s3">&quot;Argument `scale` must be positive float. &quot;</span>
                <span class="s3">f&quot;Received: scale=</span><span class="s0">{</span><span class="s1">scale</span><span class="s0">}</span><span class="s3">&quot;</span>
            <span class="s2">)</span>
        <span class="s1">allowed_modes </span><span class="s2">= {</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">, </span><span class="s3">&quot;fan_out&quot;</span><span class="s2">, </span><span class="s3">&quot;fan_avg&quot;</span><span class="s2">}</span>
        <span class="s0">if </span><span class="s1">mode </span><span class="s0">not in </span><span class="s1">allowed_modes</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                <span class="s3">f&quot;Invalid `mode` argument: </span><span class="s0">{</span><span class="s1">mode</span><span class="s0">}</span><span class="s3">. &quot;</span>
                <span class="s3">f&quot;Please use one of </span><span class="s0">{</span><span class="s1">allowed_modes</span><span class="s0">}</span><span class="s3">&quot;</span>
            <span class="s2">)</span>
        <span class="s1">distribution </span><span class="s2">= </span><span class="s1">distribution</span><span class="s2">.</span><span class="s1">lower</span><span class="s2">()</span>
        <span class="s0">if </span><span class="s1">distribution </span><span class="s2">== </span><span class="s3">&quot;normal&quot;</span><span class="s2">:</span>
            <span class="s1">distribution </span><span class="s2">= </span><span class="s3">&quot;truncated_normal&quot;</span>
        <span class="s1">allowed_distributions </span><span class="s2">= {</span>
            <span class="s3">&quot;uniform&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;truncated_normal&quot;</span><span class="s2">,</span>
            <span class="s3">&quot;untruncated_normal&quot;</span><span class="s2">,</span>
        <span class="s2">}</span>
        <span class="s0">if </span><span class="s1">distribution </span><span class="s0">not in </span><span class="s1">allowed_distributions</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                <span class="s3">f&quot;Invalid `distribution` argument: </span><span class="s0">{</span><span class="s1">distribution</span><span class="s0">}</span><span class="s3">.&quot;</span>
                <span class="s3">f&quot;Please use one of </span><span class="s0">{</span><span class="s1">allowed_distributions</span><span class="s0">}</span><span class="s3">&quot;</span>
            <span class="s2">)</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">scale </span><span class="s2">= </span><span class="s1">scale</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">= </span><span class="s1">mode</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">distribution </span><span class="s2">= </span><span class="s1">distribution</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed </span><span class="s2">= </span><span class="s1">seed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">seed </span><span class="s2">= </span><span class="s1">seed </span><span class="s0">if </span><span class="s1">seed </span><span class="s0">is not None else </span><span class="s1">random</span><span class="s2">.</span><span class="s1">make_default_seed</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">scale </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span>
        <span class="s1">fan_in</span><span class="s2">, </span><span class="s1">fan_out </span><span class="s2">= </span><span class="s1">compute_fans</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">== </span><span class="s3">&quot;fan_in&quot;</span><span class="s2">:</span>
            <span class="s1">scale </span><span class="s2">/= </span><span class="s1">max</span><span class="s2">(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">fan_in</span><span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mode </span><span class="s2">== </span><span class="s3">&quot;fan_out&quot;</span><span class="s2">:</span>
            <span class="s1">scale </span><span class="s2">/= </span><span class="s1">max</span><span class="s2">(</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">fan_out</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">scale </span><span class="s2">/= </span><span class="s1">max</span><span class="s2">(</span><span class="s5">1.0</span><span class="s2">, (</span><span class="s1">fan_in </span><span class="s2">+ </span><span class="s1">fan_out</span><span class="s2">) / </span><span class="s5">2.0</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">distribution </span><span class="s2">== </span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">:</span>
            <span class="s1">stddev </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">) / </span><span class="s5">0.87962566103423978</span>
            <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">truncated_normal</span><span class="s2">(</span>
                <span class="s1">shape</span><span class="s2">, </span><span class="s1">mean</span><span class="s2">=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">stddev</span><span class="s2">=</span><span class="s1">stddev</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span>
            <span class="s2">)</span>
        <span class="s0">elif </span><span class="s1">self</span><span class="s2">.</span><span class="s1">distribution </span><span class="s2">== </span><span class="s3">&quot;untruncated_normal&quot;</span><span class="s2">:</span>
            <span class="s1">stddev </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s1">scale</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span>
                <span class="s1">shape</span><span class="s2">, </span><span class="s1">mean</span><span class="s2">=</span><span class="s5">0.0</span><span class="s2">, </span><span class="s1">stddev</span><span class="s2">=</span><span class="s1">stddev</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span>
            <span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">limit </span><span class="s2">= </span><span class="s1">math</span><span class="s2">.</span><span class="s1">sqrt</span><span class="s2">(</span><span class="s5">3.0 </span><span class="s2">* </span><span class="s1">scale</span><span class="s2">)</span>
            <span class="s0">return </span><span class="s1">random</span><span class="s2">.</span><span class="s1">uniform</span><span class="s2">(</span>
                <span class="s1">shape</span><span class="s2">, </span><span class="s1">minval</span><span class="s2">=-</span><span class="s1">limit</span><span class="s2">, </span><span class="s1">maxval</span><span class="s2">=</span><span class="s1">limit</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span>
            <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">seed_config </span><span class="s2">= </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;scale&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">scale</span><span class="s2">,</span>
            <span class="s3">&quot;mode&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">mode</span><span class="s2">,</span>
            <span class="s3">&quot;distribution&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">distribution</span><span class="s2">,</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">seed_config</span><span class="s2">,</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.GlorotUniform&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.glorot_uniform&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">GlorotUniform</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;The Glorot uniform initializer, also called Xavier uniform initializer. 
 
    Draws samples from a uniform distribution within `[-limit, limit]`, where 
    `limit = sqrt(6 / (fan_in + fan_out))` (`fan_in` is the number of input 
    units in the weight tensor and `fan_out` is the number of output units). 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = GlorotUniform() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = GlorotUniform() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [Glorot et al., 2010](http://proceedings.mlr.press/v9/glorot10a.html) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_avg&quot;</span><span class="s2">, </span><span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;uniform&quot;</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.GlorotNormal&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.glorot_normal&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">GlorotNormal</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;The Glorot normal initializer, also called Xavier normal initializer. 
 
    Draws samples from a truncated normal distribution centered on 0 with 
    `stddev = sqrt(2 / (fan_in + fan_out))` where `fan_in` is the number of 
    input units in the weight tensor and `fan_out` is the number of output units 
    in the weight tensor. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = GlorotNormal() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = GlorotNormal() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [Glorot et al., 2010](http://proceedings.mlr.press/v9/glorot10a.html) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">,</span>
            <span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_avg&quot;</span><span class="s2">,</span>
            <span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">,</span>
            <span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span><span class="s2">,</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.LecunNormal&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.lecun_normal&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">LecunNormal</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Lecun normal initializer. 
 
    Initializers allow you to pre-specify an initialization strategy, encoded in 
    the Initializer object, without knowing the shape and dtype of the variable 
    being initialized. 
 
    Draws samples from a truncated normal distribution centered on 0 with 
    `stddev = sqrt(1 / fan_in)` where `fan_in` is the number of input units in 
    the weight tensor. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = LecunNormal() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = LecunNormal() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [Klambauer et al., 2017](https://arxiv.org/abs/1706.02515) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">, </span><span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.LecunUniform&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.lecun_uniform&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">LecunUniform</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Lecun uniform initializer. 
 
    Draws samples from a uniform distribution within `[-limit, limit]`, where 
    `limit = sqrt(3 / fan_in)` (`fan_in` is the number of input units in the 
    weight tensor). 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = LecunUniform() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = LecunUniform() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [Klambauer et al., 2017](https://arxiv.org/abs/1706.02515) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">, </span><span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;uniform&quot;</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">([</span><span class="s3">&quot;keras.initializers.HeNormal&quot;</span><span class="s2">, </span><span class="s3">&quot;keras.initializers.he_normal&quot;</span><span class="s2">])</span>
<span class="s0">class </span><span class="s1">HeNormal</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;He normal initializer. 
 
    It draws samples from a truncated normal distribution centered on 0 with 
    `stddev = sqrt(2 / fan_in)` where `fan_in` is the number of input units in 
    the weight tensor. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = HeNormal() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = HeNormal() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [He et al., 2015](https://arxiv.org/abs/1502.01852) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">2.0</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">, </span><span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;truncated_normal&quot;</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">([</span><span class="s3">&quot;keras.initializers.HeUniform&quot;</span><span class="s2">, </span><span class="s3">&quot;keras.initializers.he_uniform&quot;</span><span class="s2">])</span>
<span class="s0">class </span><span class="s1">HeUniform</span><span class="s2">(</span><span class="s1">VarianceScaling</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;He uniform variance scaling initializer. 
 
    Draws samples from a uniform distribution within `[-limit, limit]`, where 
    `limit = sqrt(6 / fan_in)` (`fan_in` is the number of input units in the 
    weight tensor). 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = HeUniform() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = HeUniform() 
    &gt;&gt;&gt; layer = Dense(3, kernel_initializer=initializer) 
 
    Args: 
        seed: A Python integer or instance of 
            `keras.backend.SeedGenerator`. 
            Used to make the behavior of the initializer 
            deterministic. Note that an initializer seeded with an integer 
            or `None` (unseeded) will produce the same random values 
            across multiple calls. To get different random values 
            across multiple calls, use as seed an instance 
            of `keras.backend.SeedGenerator`. 
 
    Reference: 
 
    - [He et al., 2015](https://arxiv.org/abs/1502.01852) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">super</span><span class="s2">().</span><span class="s1">__init__</span><span class="s2">(</span>
            <span class="s1">scale</span><span class="s2">=</span><span class="s5">2.0</span><span class="s2">, </span><span class="s1">mode</span><span class="s2">=</span><span class="s3">&quot;fan_in&quot;</span><span class="s2">, </span><span class="s1">distribution</span><span class="s2">=</span><span class="s3">&quot;uniform&quot;</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">seed</span>
        <span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">{</span>
            <span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s2">}</span>


<span class="s0">def </span><span class="s1">compute_fans</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Computes the number of input and output units for a weight shape. 
 
    Args: 
        shape: Integer shape tuple. 
 
    Returns: 
        A tuple of integer scalars: `(fan_in, fan_out)`. 
    &quot;&quot;&quot;</span>
    <span class="s1">shape </span><span class="s2">= </span><span class="s1">tuple</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">)</span>
    <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">) &lt; </span><span class="s5">1</span><span class="s2">:  </span><span class="s6"># Just to avoid errors for constants.</span>
        <span class="s1">fan_in </span><span class="s2">= </span><span class="s1">fan_out </span><span class="s2">= </span><span class="s5">1</span>
    <span class="s0">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">) == </span><span class="s5">1</span><span class="s2">:</span>
        <span class="s1">fan_in </span><span class="s2">= </span><span class="s1">fan_out </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
    <span class="s0">elif </span><span class="s1">len</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">) == </span><span class="s5">2</span><span class="s2">:</span>
        <span class="s1">fan_in </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]</span>
        <span class="s1">fan_out </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
    <span class="s0">else</span><span class="s2">:</span>
        <span class="s6"># Assuming convolution kernels (2D, 3D, or more).</span>
        <span class="s6"># kernel shape: (..., input_depth, depth)</span>
        <span class="s1">receptive_field_size </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s0">for </span><span class="s1">dim </span><span class="s0">in </span><span class="s1">shape</span><span class="s2">[:-</span><span class="s5">2</span><span class="s2">]:</span>
            <span class="s1">receptive_field_size </span><span class="s2">*= </span><span class="s1">dim</span>
        <span class="s1">fan_in </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[-</span><span class="s5">2</span><span class="s2">] * </span><span class="s1">receptive_field_size</span>
        <span class="s1">fan_out </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">] * </span><span class="s1">receptive_field_size</span>
    <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">fan_in</span><span class="s2">), </span><span class="s1">int</span><span class="s2">(</span><span class="s1">fan_out</span><span class="s2">)</span>


<span class="s2">@</span><span class="s1">keras_export</span><span class="s2">(</span>
    <span class="s2">[</span>
        <span class="s3">&quot;keras.initializers.OrthogonalInitializer&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.Orthogonal&quot;</span><span class="s2">,</span>
        <span class="s3">&quot;keras.initializers.orthogonal&quot;</span><span class="s2">,</span>
    <span class="s2">]</span>
<span class="s2">)</span>
<span class="s0">class </span><span class="s1">OrthogonalInitializer</span><span class="s2">(</span><span class="s1">Initializer</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Initializer that generates an orthogonal matrix. 
 
    If the shape of the tensor to initialize is two-dimensional, it is 
    initialized with an orthogonal matrix obtained from the QR decomposition of 
    a matrix of random numbers drawn from a normal distribution. If the matrix 
    has fewer rows than columns then the output will have orthogonal rows. 
    Otherwise, the output will have orthogonal columns. 
 
    If the shape of the tensor to initialize is more than two-dimensional, 
    a matrix of shape `(shape[0] * ... * shape[n - 2], shape[n - 1])` 
    is initialized, where `n` is the length of the shape vector. 
    The matrix is subsequently reshaped to give a tensor of the desired shape. 
 
    Examples: 
 
    &gt;&gt;&gt; # Standalone usage: 
    &gt;&gt;&gt; initializer = keras.initializers.Orthogonal() 
    &gt;&gt;&gt; values = initializer(shape=(2, 2)) 
 
    &gt;&gt;&gt; # Usage in a Keras layer: 
    &gt;&gt;&gt; initializer = keras.initializers.Orthogonal() 
    &gt;&gt;&gt; layer = keras.layers.Dense(3, kernel_initializer=initializer) 
 
    Args: 
        gain: Multiplicative factor to apply to the orthogonal matrix. 
        seed: A Python integer. Used to make the behavior of the initializer 
            deterministic. 
 
    Reference: 
 
    - [Saxe et al., 2014](https://openreview.net/forum?id=_wzZwKpTDF_9C) 
    &quot;&quot;&quot;</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">gain</span><span class="s2">=</span><span class="s5">1.0</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">gain </span><span class="s2">= </span><span class="s1">gain</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed </span><span class="s2">= </span><span class="s1">seed</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">seed </span><span class="s2">= </span><span class="s1">seed </span><span class="s0">if </span><span class="s1">seed </span><span class="s0">is not None else </span><span class="s1">random</span><span class="s2">.</span><span class="s1">make_default_seed</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">) &lt; </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span>
                <span class="s3">&quot;The tensor to initialize must be &quot;</span>
                <span class="s3">&quot;at least two-dimensional. Received: &quot;</span>
                <span class="s3">f&quot;shape=</span><span class="s0">{</span><span class="s1">shape</span><span class="s0">} </span><span class="s3">of rank </span><span class="s0">{</span><span class="s1">len</span><span class="s2">(</span><span class="s1">shape</span><span class="s2">)</span><span class="s0">}</span><span class="s3">.&quot;</span>
            <span class="s2">)</span>

        <span class="s6"># Flatten the input shape with the last dimension remaining</span>
        <span class="s6"># its original shape so it works for conv2d</span>
        <span class="s1">num_rows </span><span class="s2">= </span><span class="s5">1</span>
        <span class="s0">for </span><span class="s1">dim </span><span class="s0">in </span><span class="s1">shape</span><span class="s2">[:-</span><span class="s5">1</span><span class="s2">]:</span>
            <span class="s1">num_rows </span><span class="s2">*= </span><span class="s1">dim</span>
        <span class="s1">num_cols </span><span class="s2">= </span><span class="s1">shape</span><span class="s2">[-</span><span class="s5">1</span><span class="s2">]</span>
        <span class="s1">flat_shape </span><span class="s2">= (</span><span class="s1">max</span><span class="s2">(</span><span class="s1">num_cols</span><span class="s2">, </span><span class="s1">num_rows</span><span class="s2">), </span><span class="s1">min</span><span class="s2">(</span><span class="s1">num_cols</span><span class="s2">, </span><span class="s1">num_rows</span><span class="s2">))</span>

        <span class="s6"># Generate a random matrix</span>
        <span class="s1">a </span><span class="s2">= </span><span class="s1">random</span><span class="s2">.</span><span class="s1">normal</span><span class="s2">(</span><span class="s1">flat_shape</span><span class="s2">, </span><span class="s1">seed</span><span class="s2">=</span><span class="s1">self</span><span class="s2">.</span><span class="s1">seed</span><span class="s2">, </span><span class="s1">dtype</span><span class="s2">=</span><span class="s1">dtype</span><span class="s2">)</span>
        <span class="s6"># Compute the qr factorization</span>
        <span class="s1">q</span><span class="s2">, </span><span class="s1">r </span><span class="s2">= </span><span class="s1">ops</span><span class="s2">.</span><span class="s1">qr</span><span class="s2">(</span><span class="s1">a</span><span class="s2">)</span>
        <span class="s6"># Make Q uniform</span>
        <span class="s1">d </span><span class="s2">= </span><span class="s1">ops</span><span class="s2">.</span><span class="s1">diag</span><span class="s2">(</span><span class="s1">r</span><span class="s2">)</span>
        <span class="s1">q </span><span class="s2">*= </span><span class="s1">ops</span><span class="s2">.</span><span class="s1">sign</span><span class="s2">(</span><span class="s1">d</span><span class="s2">)</span>
        <span class="s0">if </span><span class="s1">num_rows </span><span class="s2">&lt; </span><span class="s1">num_cols</span><span class="s2">:</span>
            <span class="s1">q </span><span class="s2">= </span><span class="s1">ops</span><span class="s2">.</span><span class="s1">transpose</span><span class="s2">(</span><span class="s1">q</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gain </span><span class="s2">* </span><span class="s1">ops</span><span class="s2">.</span><span class="s1">reshape</span><span class="s2">(</span><span class="s1">q</span><span class="s2">, </span><span class="s1">shape</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">get_config</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s1">seed_config </span><span class="s2">= </span><span class="s1">serialization_lib</span><span class="s2">.</span><span class="s1">serialize_keras_object</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_init_seed</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s2">{</span><span class="s3">&quot;gain&quot;</span><span class="s2">: </span><span class="s1">self</span><span class="s2">.</span><span class="s1">gain</span><span class="s2">, </span><span class="s3">&quot;seed&quot;</span><span class="s2">: </span><span class="s1">seed_config</span><span class="s2">}</span>
</pre>
</body>
</html>