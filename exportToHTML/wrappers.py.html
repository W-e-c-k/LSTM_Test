<html>
<head>
<title>wrappers.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #6aab73;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
wrappers.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">sys</span>
<span class="s0">import </span><span class="s1">operator</span>
<span class="s0">import </span><span class="s1">inspect</span>

<span class="s1">PY2 </span><span class="s2">= </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">version_info</span><span class="s2">[</span><span class="s3">0</span><span class="s2">] == </span><span class="s3">2</span>

<span class="s0">if </span><span class="s1">PY2</span><span class="s2">:</span>
    <span class="s1">string_types </span><span class="s2">= </span><span class="s1">basestring</span><span class="s2">,</span>
<span class="s0">else</span><span class="s2">:</span>
    <span class="s1">string_types </span><span class="s2">= </span><span class="s1">str</span><span class="s2">,</span>

<span class="s0">def </span><span class="s1">with_metaclass</span><span class="s2">(</span><span class="s1">meta</span><span class="s2">, *</span><span class="s1">bases</span><span class="s2">):</span>
    <span class="s4">&quot;&quot;&quot;Create a base class with a metaclass.&quot;&quot;&quot;</span>
    <span class="s0">return </span><span class="s1">meta</span><span class="s2">(</span><span class="s5">&quot;NewBase&quot;</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, {})</span>

<span class="s0">class </span><span class="s1">_ObjectProxyMethods</span><span class="s2">(</span><span class="s1">object</span><span class="s2">):</span>

    <span class="s6"># We use properties to override the values of __module__ and</span>
    <span class="s6"># __doc__. If we add these in ObjectProxy, the derived class</span>
    <span class="s6"># __dict__ will still be setup to have string variants of these</span>
    <span class="s6"># attributes and the rules of descriptors means that they appear to</span>
    <span class="s6"># take precedence over the properties in the base class. To avoid</span>
    <span class="s6"># that, we copy the properties into the derived class type itself</span>
    <span class="s6"># via a meta class. In that way the properties will always take</span>
    <span class="s6"># precedence.</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__module__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__module__</span>

    <span class="s2">@</span><span class="s1">__module__</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">__module__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__module__ </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__doc__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__doc__</span>

    <span class="s2">@</span><span class="s1">__doc__</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">__doc__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__doc__ </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s6"># We similar use a property for __dict__. We need __dict__ to be</span>
    <span class="s6"># explicit to ensure that vars() works as expected.</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__dict__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__dict__</span>

    <span class="s6"># Need to also propagate the special __weakref__ attribute for case</span>
    <span class="s6"># where decorating classes which will define this. If do not define</span>
    <span class="s6"># it and use a function like inspect.getmembers() on a decorator</span>
    <span class="s6"># class it will fail. This can't be in the derived classes.</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__weakref__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__weakref__</span>

<span class="s0">class </span><span class="s1">_ObjectProxyMetaType</span><span class="s2">(</span><span class="s1">type</span><span class="s2">):</span>
    <span class="s0">def </span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">dictionary</span><span class="s2">):</span>
        <span class="s6"># Copy our special properties into the class so that they</span>
        <span class="s6"># always take precedence over attributes of the same name added</span>
        <span class="s6"># during construction of a derived class. This is to save</span>
        <span class="s6"># duplicating the implementation for them in all derived classes.</span>

        <span class="s1">dictionary</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">(</span><span class="s1">_ObjectProxyMethods</span><span class="s2">))</span>

        <span class="s0">return </span><span class="s1">type</span><span class="s2">.</span><span class="s1">__new__</span><span class="s2">(</span><span class="s1">cls</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">, </span><span class="s1">dictionary</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">ObjectProxy</span><span class="s2">(</span><span class="s1">with_metaclass</span><span class="s2">(</span><span class="s1">_ObjectProxyMetaType</span><span class="s2">)):</span>

    <span class="s1">__slots__ </span><span class="s2">= </span><span class="s5">'__wrapped__'</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">):</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__wrapped__'</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">)</span>

        <span class="s6"># Python 3.2+ has the __qualname__ attribute, but it does not</span>
        <span class="s6"># allow it to be overridden using a property and it must instead</span>
        <span class="s6"># be an actual string object instead.</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__qualname__'</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">.</span><span class="s1">__qualname__</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s0">pass</span>

        <span class="s6"># Python 3.10 onwards also does not allow itself to be overridden</span>
        <span class="s6"># using a property and it must instead be set explicitly.</span>

        <span class="s0">try</span><span class="s2">:</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__annotations__'</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">.</span><span class="s1">__annotations__</span><span class="s2">)</span>
        <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
            <span class="s0">pass</span>

    <span class="s0">def </span><span class="s1">__self_setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__name__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__name__</span>

    <span class="s2">@</span><span class="s1">__name__</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">__name__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__name__ </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s2">@</span><span class="s1">property</span>
    <span class="s0">def </span><span class="s1">__class__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__class__</span>

    <span class="s2">@</span><span class="s1">__class__</span><span class="s2">.</span><span class="s1">setter</span>
    <span class="s0">def </span><span class="s1">__class__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__class__ </span><span class="s2">= </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">__dir__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">dir</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__str__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">str</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">PY2</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">__bytes__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">bytes</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__repr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s5">'&lt;{} at 0x{:x} for {} at 0x{:x}&gt;'</span><span class="s2">.</span><span class="s1">format</span><span class="s2">(</span>
                <span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">).</span><span class="s1">__name__</span><span class="s2">, </span><span class="s1">id</span><span class="s2">(</span><span class="s1">self</span><span class="s2">),</span>
                <span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">).</span><span class="s1">__name__</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">))</span>

    <span class="s0">def </span><span class="s1">__reversed__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">reversed</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">if not </span><span class="s1">PY2</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">__round__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">round</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s1">sys</span><span class="s2">.</span><span class="s1">hexversion </span><span class="s2">&gt;= </span><span class="s3">0x03070000</span><span class="s2">:</span>
        <span class="s0">def </span><span class="s1">__mro_entries__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">bases</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">,)</span>

    <span class="s0">def </span><span class="s1">__lt__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&lt; </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__le__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&lt;= </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__eq__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">== </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__ne__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">!= </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__gt__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&gt; </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__ge__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&gt;= </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__hash__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">hash</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__nonzero__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__bool__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">bool</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">name</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">'_self_'</span><span class="s2">):</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__wrapped__'</span><span class="s2">:</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">object</span><span class="s2">.</span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__qualname__'</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s0">pass</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__qualname__'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">.</span><span class="s1">__qualname__</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s0">pass</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">object</span><span class="s2">.</span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__annotations__'</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s0">pass</span>
            <span class="s0">try</span><span class="s2">:</span>
                <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'__annotations__'</span><span class="s2">, </span><span class="s1">value</span><span class="s2">.</span><span class="s1">__annotations__</span><span class="s2">)</span>
            <span class="s0">except </span><span class="s1">AttributeError</span><span class="s2">:</span>
                <span class="s0">pass</span>

        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__qualname__'</span><span class="s2">:</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__annotations__'</span><span class="s2">:</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">), </span><span class="s1">name</span><span class="s2">):</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">setattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">value</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__getattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s6"># If we are being to lookup '__wrapped__' then the</span>
        <span class="s6"># '__init__()' method cannot have been called.</span>

        <span class="s0">if </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__wrapped__'</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">ValueError</span><span class="s2">(</span><span class="s5">'wrapper has not been initialised'</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s0">if </span><span class="s1">name</span><span class="s2">.</span><span class="s1">startswith</span><span class="s2">(</span><span class="s5">'_self_'</span><span class="s2">):</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__wrapped__'</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s5">'__wrapped__ must be an object'</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">name </span><span class="s2">== </span><span class="s5">'__qualname__'</span><span class="s2">:</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>
            <span class="s1">delattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

        <span class="s0">elif </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">type</span><span class="s2">(</span><span class="s1">self</span><span class="s2">), </span><span class="s1">name</span><span class="s2">):</span>
            <span class="s1">object</span><span class="s2">.</span><span class="s1">__delattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">delattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__add__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">+ </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__sub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">- </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__mul__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">* </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__div__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">div</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__truediv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">truediv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__floordiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">// </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__mod__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">% </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__divmod__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">divmod</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__pow__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">pow</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__lshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&lt;&lt; </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__rshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&gt;&gt; </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__and__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&amp; </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__xor__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">^ </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__or__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">| </span><span class="s1">other</span>

    <span class="s0">def </span><span class="s1">__radd__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">+ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rsub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">- </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rmul__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">* </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rdiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">div</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rtruediv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">truediv</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rfloordiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">// </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rmod__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">% </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rdivmod__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">divmod</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rpow__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">pow</span><span class="s2">(</span><span class="s1">other</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__rlshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">&lt;&lt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rrshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">&gt;&gt; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rand__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">&amp; </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__rxor__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">^ </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__ror__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">other </span><span class="s2">| </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__iadd__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">+= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__isub__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">-= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__imul__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">*= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__idiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">= </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">idiv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__itruediv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">= </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">itruediv</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">other</span><span class="s2">)</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__ifloordiv__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">//= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__imod__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">%= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__ipow__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">**= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__ilshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&lt;&lt;= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__irshift__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&gt;&gt;= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__iand__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">&amp;= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__ixor__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">^= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__ior__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">other</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__ </span><span class="s2">|= </span><span class="s1">other</span>
        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__neg__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">-</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__pos__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">+</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__abs__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">abs</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__invert__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s2">~</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__int__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">int</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__long__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">long</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__float__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">float</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__complex__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">complex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__oct__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">oct</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__hex__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">hex</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__index__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">operator</span><span class="s2">.</span><span class="s1">index</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__len__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">len</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__contains__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">value </span><span class="s0">in </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span>

    <span class="s0">def </span><span class="s1">__getitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__setitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">__delitem__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">):</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__getslice__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">i</span><span class="s2">:</span><span class="s1">j</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__setslice__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">, </span><span class="s1">value</span><span class="s2">):</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">i</span><span class="s2">:</span><span class="s1">j</span><span class="s2">] = </span><span class="s1">value</span>

    <span class="s0">def </span><span class="s1">__delslice__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">i</span><span class="s2">, </span><span class="s1">j</span><span class="s2">):</span>
        <span class="s0">del </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">[</span><span class="s1">i</span><span class="s2">:</span><span class="s1">j</span><span class="s2">]</span>

    <span class="s0">def </span><span class="s1">__enter__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__enter__</span><span class="s2">()</span>

    <span class="s0">def </span><span class="s1">__exit__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__exit__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__iter__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">return </span><span class="s1">iter</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__copy__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span><span class="s5">'object proxy must define __copy__()'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__deepcopy__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">memo</span><span class="s2">):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span><span class="s5">'object proxy must define __deepcopy__()'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__reduce__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span>
                <span class="s5">'object proxy must define __reduce_ex__()'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__reduce_ex__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">protocol</span><span class="s2">):</span>
        <span class="s0">raise </span><span class="s1">NotImplementedError</span><span class="s2">(</span>
                <span class="s5">'object proxy must define __reduce_ex__()'</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">CallableObjectProxy</span><span class="s2">(</span><span class="s1">ObjectProxy</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">_unpack_self</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">, </span><span class="s1">args</span>

        <span class="s1">self</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">_unpack_self</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">PartialCallableObjectProxy</span><span class="s2">(</span><span class="s1">ObjectProxy</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">_unpack_self</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">, </span><span class="s1">args</span>

        <span class="s1">self</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">_unpack_self</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>

        <span class="s0">if </span><span class="s1">len</span><span class="s2">(</span><span class="s1">args</span><span class="s2">) &lt; </span><span class="s3">1</span><span class="s2">:</span>
            <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s5">'partial type takes at least one argument'</span><span class="s2">)</span>

        <span class="s1">wrapped</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">args</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]</span>

        <span class="s0">if not </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">):</span>
            <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s5">'the first argument must be callable'</span><span class="s2">)</span>

        <span class="s1">super</span><span class="s2">(</span><span class="s1">PartialCallableObjectProxy</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">)</span>

        <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_args </span><span class="s2">= </span><span class="s1">args</span>
        <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_kwargs </span><span class="s2">= </span><span class="s1">kwargs</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">_unpack_self</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">, </span><span class="s1">args</span>

        <span class="s1">self</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">_unpack_self</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>
    
        <span class="s1">_args </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_args </span><span class="s2">+ </span><span class="s1">args</span>

        <span class="s1">_kwargs </span><span class="s2">= </span><span class="s1">dict</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_kwargs</span><span class="s2">)</span>
        <span class="s1">_kwargs</span><span class="s2">.</span><span class="s1">update</span><span class="s2">(</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">_args</span><span class="s2">, **</span><span class="s1">_kwargs</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">_FunctionWrapperBase</span><span class="s2">(</span><span class="s1">ObjectProxy</span><span class="s2">):</span>

    <span class="s1">__slots__ </span><span class="s2">= (</span><span class="s5">'_self_instance'</span><span class="s2">, </span><span class="s5">'_self_wrapper'</span><span class="s2">, </span><span class="s5">'_self_enabled'</span><span class="s2">,</span>
            <span class="s5">'_self_binding'</span><span class="s2">, </span><span class="s5">'_self_parent'</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">wrapper</span><span class="s2">, </span><span class="s1">enabled</span><span class="s2">=</span><span class="s0">None</span><span class="s2">,</span>
            <span class="s1">binding</span><span class="s2">=</span><span class="s5">'function'</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>

        <span class="s1">super</span><span class="s2">(</span><span class="s1">_FunctionWrapperBase</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">)</span>

        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_self_instance'</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">)</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_self_wrapper'</span><span class="s2">, </span><span class="s1">wrapper</span><span class="s2">)</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_self_enabled'</span><span class="s2">, </span><span class="s1">enabled</span><span class="s2">)</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_self_binding'</span><span class="s2">, </span><span class="s1">binding</span><span class="s2">)</span>
        <span class="s1">object</span><span class="s2">.</span><span class="s1">__setattr__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s5">'_self_parent'</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__get__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">owner</span><span class="s2">):</span>
        <span class="s6"># This method is actually doing double duty for both unbound and</span>
        <span class="s6"># bound derived wrapper classes. It should possibly be broken up</span>
        <span class="s6"># and the distinct functionality moved into the derived classes.</span>
        <span class="s6"># Can't do that straight away due to some legacy code which is</span>
        <span class="s6"># relying on it being here in this base class.</span>
        <span class="s6">#</span>
        <span class="s6"># The distinguishing attribute which determines whether we are</span>
        <span class="s6"># being called in an unbound or bound wrapper is the parent</span>
        <span class="s6"># attribute. If binding has never occurred, then the parent will</span>
        <span class="s6"># be None.</span>
        <span class="s6">#</span>
        <span class="s6"># First therefore, is if we are called in an unbound wrapper. In</span>
        <span class="s6"># this case we perform the binding.</span>
        <span class="s6">#</span>
        <span class="s6"># We have one special case to worry about here. This is where we</span>
        <span class="s6"># are decorating a nested class. In this case the wrapped class</span>
        <span class="s6"># would not have a __get__() method to call. In that case we</span>
        <span class="s6"># simply return self.</span>
        <span class="s6">#</span>
        <span class="s6"># Note that we otherwise still do binding even if instance is</span>
        <span class="s6"># None and accessing an unbound instance method from a class.</span>
        <span class="s6"># This is because we need to be able to later detect that</span>
        <span class="s6"># specific case as we will need to extract the instance from the</span>
        <span class="s6"># first argument of those passed in.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_parent </span><span class="s0">is None</span><span class="s2">:</span>
            <span class="s0">if not </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">isclass</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">):</span>
                <span class="s1">descriptor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__get__</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">, </span><span class="s1">owner</span><span class="s2">)</span>

                <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__bound_function_wrapper__</span><span class="s2">(</span><span class="s1">descriptor</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">,</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">,</span>
                        <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_binding</span><span class="s2">, </span><span class="s1">self</span><span class="s2">)</span>

            <span class="s0">return </span><span class="s1">self</span>

        <span class="s6"># Now we have the case of binding occurring a second time on what</span>
        <span class="s6"># was already a bound function. In this case we would usually</span>
        <span class="s6"># return ourselves again. This mirrors what Python does.</span>
        <span class="s6">#</span>
        <span class="s6"># The special case this time is where we were originally bound</span>
        <span class="s6"># with an instance of None and we were likely an instance</span>
        <span class="s6"># method. In that case we rebind against the original wrapped</span>
        <span class="s6"># function from the parent again.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_instance </span><span class="s0">is None and </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_binding </span><span class="s2">== </span><span class="s5">'function'</span><span class="s2">:</span>
            <span class="s1">descriptor </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_parent</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__get__</span><span class="s2">(</span>
                    <span class="s1">instance</span><span class="s2">, </span><span class="s1">owner</span><span class="s2">)</span>

            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_parent</span><span class="s2">.</span><span class="s1">__bound_function_wrapper__</span><span class="s2">(</span>
                    <span class="s1">descriptor</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">,</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_binding</span><span class="s2">,</span>
                    <span class="s1">self</span><span class="s2">.</span><span class="s1">_self_parent</span><span class="s2">)</span>

        <span class="s0">return </span><span class="s1">self</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">_unpack_self</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">, </span><span class="s1">args</span>

        <span class="s1">self</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">_unpack_self</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>

        <span class="s6"># If enabled has been specified, then evaluate it at this point</span>
        <span class="s6"># and if the wrapper is not to be executed, then simply return</span>
        <span class="s6"># the bound function rather than a bound wrapper for the bound</span>
        <span class="s6"># function. When evaluating enabled, if it is callable we call</span>
        <span class="s6"># it, otherwise we evaluate it as a boolean.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">):</span>
                <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">():</span>
                    <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s0">elif not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s6"># This can occur where initial function wrapper was applied to</span>
        <span class="s6"># a function that was already bound to an instance. In that case</span>
        <span class="s6"># we want to extract the instance from the function and use it.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_binding </span><span class="s0">in </span><span class="s2">(</span><span class="s5">'function'</span><span class="s2">, </span><span class="s5">'classmethod'</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_instance </span><span class="s0">is None</span><span class="s2">:</span>
                <span class="s1">instance </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s5">'__self__'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>
                <span class="s0">if </span><span class="s1">instance </span><span class="s0">is not None</span><span class="s2">:</span>
                    <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">,</span>
                            <span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s6"># This is generally invoked when the wrapped function is being</span>
        <span class="s6"># called as a normal function and is not bound to a class as an</span>
        <span class="s6"># instance method. This is also invoked in the case where the</span>
        <span class="s6"># wrapped function was a method, but this wrapper was in turn</span>
        <span class="s6"># wrapped using the staticmethod decorator.</span>

        <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_instance</span><span class="s2">,</span>
                <span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__set_name__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">owner</span><span class="s2">, </span><span class="s1">name</span><span class="s2">):</span>
        <span class="s6"># This is a special method use to supply information to</span>
        <span class="s6"># descriptors about what the name of variable in a class</span>
        <span class="s6"># definition is. Not wanting to add this to ObjectProxy as not</span>
        <span class="s6"># sure of broader implications of doing that. Thus restrict to</span>
        <span class="s6"># FunctionWrapper used by decorators.</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s5">&quot;__set_name__&quot;</span><span class="s2">):</span>
            <span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">.</span><span class="s1">__set_name__</span><span class="s2">(</span><span class="s1">owner</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__instancecheck__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">):</span>
        <span class="s6"># This is a special method used by isinstance() to make checks</span>
        <span class="s6"># instance of the `__wrapped__`.</span>
        <span class="s0">return </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">instance</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

    <span class="s0">def </span><span class="s1">__subclasscheck__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">subclass</span><span class="s2">):</span>
        <span class="s6"># This is a special method used by issubclass() to make checks</span>
        <span class="s6"># about inheritance of classes. We need to upwrap any object</span>
        <span class="s6"># proxy. Not wanting to add this to ObjectProxy as not sure of</span>
        <span class="s6"># broader implications of doing that. Thus restrict to</span>
        <span class="s6"># FunctionWrapper used by decorators.</span>

        <span class="s0">if </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">subclass</span><span class="s2">, </span><span class="s5">&quot;__wrapped__&quot;</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">subclass</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>
        <span class="s0">else</span><span class="s2">:</span>
            <span class="s0">return </span><span class="s1">issubclass</span><span class="s2">(</span><span class="s1">subclass</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">BoundFunctionWrapper</span><span class="s2">(</span><span class="s1">_FunctionWrapperBase</span><span class="s2">):</span>

    <span class="s0">def </span><span class="s1">__call__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">):</span>
        <span class="s0">def </span><span class="s1">_unpack_self</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, *</span><span class="s1">args</span><span class="s2">):</span>
            <span class="s0">return </span><span class="s1">self</span><span class="s2">, </span><span class="s1">args</span>

        <span class="s1">self</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">_unpack_self</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">)</span>

        <span class="s6"># If enabled has been specified, then evaluate it at this point</span>
        <span class="s6"># and if the wrapper is not to be executed, then simply return</span>
        <span class="s6"># the bound function rather than a bound wrapper for the bound</span>
        <span class="s6"># function. When evaluating enabled, if it is callable we call</span>
        <span class="s6"># it, otherwise we evaluate it as a boolean.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled </span><span class="s0">is not None</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">callable</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">):</span>
                <span class="s0">if not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">():</span>
                    <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>
            <span class="s0">elif not </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_enabled</span><span class="s2">:</span>
                <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">(*</span><span class="s1">args</span><span class="s2">, **</span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s6"># We need to do things different depending on whether we are</span>
        <span class="s6"># likely wrapping an instance method vs a static method or class</span>
        <span class="s6"># method.</span>

        <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_binding </span><span class="s2">== </span><span class="s5">'function'</span><span class="s2">:</span>
            <span class="s0">if </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_instance </span><span class="s0">is None</span><span class="s2">:</span>
                <span class="s6"># This situation can occur where someone is calling the</span>
                <span class="s6"># instancemethod via the class type and passing the instance</span>
                <span class="s6"># as the first argument. We need to shift the args before</span>
                <span class="s6"># making the call to the wrapper and effectively bind the</span>
                <span class="s6"># instance to the wrapped function using a partial so the</span>
                <span class="s6"># wrapper doesn't see anything as being different.</span>

                <span class="s0">if not </span><span class="s1">args</span><span class="s2">:</span>
                    <span class="s0">raise </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s5">'missing 1 required positional argument'</span><span class="s2">)</span>

                <span class="s1">instance</span><span class="s2">, </span><span class="s1">args </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s3">0</span><span class="s2">], </span><span class="s1">args</span><span class="s2">[</span><span class="s3">1</span><span class="s2">:]</span>
                <span class="s1">wrapped </span><span class="s2">= </span><span class="s1">PartialCallableObjectProxy</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">)</span>
                <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">)</span>

            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_instance</span><span class="s2">,</span>
                    <span class="s1">args</span><span class="s2">, </span><span class="s1">kwargs</span><span class="s2">)</span>

        <span class="s0">else</span><span class="s2">:</span>
            <span class="s6"># As in this case we would be dealing with a classmethod or</span>
            <span class="s6"># staticmethod, then _self_instance will only tell us whether</span>
            <span class="s6"># when calling the classmethod or staticmethod they did it via an</span>
            <span class="s6"># instance of the class it is bound to and not the case where</span>
            <span class="s6"># done by the class type itself. We thus ignore _self_instance</span>
            <span class="s6"># and use the __self__ attribute of the bound function instead.</span>
            <span class="s6"># For a classmethod, this means instance will be the class type</span>
            <span class="s6"># and for a staticmethod it will be None. This is probably the</span>
            <span class="s6"># more useful thing we can pass through even though we loose</span>
            <span class="s6"># knowledge of whether they were called on the instance vs the</span>
            <span class="s6"># class type, as it reflects what they have available in the</span>
            <span class="s6"># decoratored function.</span>

            <span class="s1">instance </span><span class="s2">= </span><span class="s1">getattr</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s5">'__self__'</span><span class="s2">, </span><span class="s0">None</span><span class="s2">)</span>

            <span class="s0">return </span><span class="s1">self</span><span class="s2">.</span><span class="s1">_self_wrapper</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">__wrapped__</span><span class="s2">, </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">args</span><span class="s2">,</span>
                    <span class="s1">kwargs</span><span class="s2">)</span>

<span class="s0">class </span><span class="s1">FunctionWrapper</span><span class="s2">(</span><span class="s1">_FunctionWrapperBase</span><span class="s2">):</span>

    <span class="s1">__bound_function_wrapper__ </span><span class="s2">= </span><span class="s1">BoundFunctionWrapper</span>

    <span class="s0">def </span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">self</span><span class="s2">, </span><span class="s1">wrapped</span><span class="s2">, </span><span class="s1">wrapper</span><span class="s2">, </span><span class="s1">enabled</span><span class="s2">=</span><span class="s0">None</span><span class="s2">):</span>
        <span class="s6"># What it is we are wrapping here could be anything. We need to</span>
        <span class="s6"># try and detect specific cases though. In particular, we need</span>
        <span class="s6"># to detect when we are given something that is a method of a</span>
        <span class="s6"># class. Further, we need to know when it is likely an instance</span>
        <span class="s6"># method, as opposed to a class or static method. This can</span>
        <span class="s6"># become problematic though as there isn't strictly a fool proof</span>
        <span class="s6"># method of knowing.</span>
        <span class="s6">#</span>
        <span class="s6"># The situations we could encounter when wrapping a method are:</span>
        <span class="s6">#</span>
        <span class="s6"># 1. The wrapper is being applied as part of a decorator which</span>
        <span class="s6"># is a part of the class definition. In this case what we are</span>
        <span class="s6"># given is the raw unbound function, classmethod or staticmethod</span>
        <span class="s6"># wrapper objects.</span>
        <span class="s6">#</span>
        <span class="s6"># The problem here is that we will not know we are being applied</span>
        <span class="s6"># in the context of the class being set up. This becomes</span>
        <span class="s6"># important later for the case of an instance method, because in</span>
        <span class="s6"># that case we just see it as a raw function and can't</span>
        <span class="s6"># distinguish it from wrapping a normal function outside of</span>
        <span class="s6"># a class context.</span>
        <span class="s6">#</span>
        <span class="s6"># 2. The wrapper is being applied when performing monkey</span>
        <span class="s6"># patching of the class type afterwards and the method to be</span>
        <span class="s6"># wrapped was retrieved direct from the __dict__ of the class</span>
        <span class="s6"># type. This is effectively the same as (1) above.</span>
        <span class="s6">#</span>
        <span class="s6"># 3. The wrapper is being applied when performing monkey</span>
        <span class="s6"># patching of the class type afterwards and the method to be</span>
        <span class="s6"># wrapped was retrieved from the class type. In this case</span>
        <span class="s6"># binding will have been performed where the instance against</span>
        <span class="s6"># which the method is bound will be None at that point.</span>
        <span class="s6">#</span>
        <span class="s6"># This case is a problem because we can no longer tell if the</span>
        <span class="s6"># method was a static method, plus if using Python3, we cannot</span>
        <span class="s6"># tell if it was an instance method as the concept of an</span>
        <span class="s6"># unnbound method no longer exists.</span>
        <span class="s6">#</span>
        <span class="s6"># 4. The wrapper is being applied when performing monkey</span>
        <span class="s6"># patching of an instance of a class. In this case binding will</span>
        <span class="s6"># have been perfomed where the instance was not None.</span>
        <span class="s6">#</span>
        <span class="s6"># This case is a problem because we can no longer tell if the</span>
        <span class="s6"># method was a static method.</span>
        <span class="s6">#</span>
        <span class="s6"># Overall, the best we can do is look at the original type of the</span>
        <span class="s6"># object which was wrapped prior to any binding being done and</span>
        <span class="s6"># see if it is an instance of classmethod or staticmethod. In</span>
        <span class="s6"># the case where other decorators are between us and them, if</span>
        <span class="s6"># they do not propagate the __class__  attribute so that the</span>
        <span class="s6"># isinstance() checks works, then likely this will do the wrong</span>
        <span class="s6"># thing where classmethod and staticmethod are used.</span>
        <span class="s6">#</span>
        <span class="s6"># Since it is likely to be very rare that anyone even puts</span>
        <span class="s6"># decorators around classmethod and staticmethod, likelihood of</span>
        <span class="s6"># that being an issue is very small, so we accept it and suggest</span>
        <span class="s6"># that those other decorators be fixed. It is also only an issue</span>
        <span class="s6"># if a decorator wants to actually do things with the arguments.</span>
        <span class="s6">#</span>
        <span class="s6"># As to not being able to identify static methods properly, we</span>
        <span class="s6"># just hope that that isn't something people are going to want</span>
        <span class="s6"># to wrap, or if they do suggest they do it the correct way by</span>
        <span class="s6"># ensuring that it is decorated in the class definition itself,</span>
        <span class="s6"># or patch it in the __dict__ of the class type.</span>
        <span class="s6">#</span>
        <span class="s6"># So to get the best outcome we can, whenever we aren't sure what</span>
        <span class="s6"># it is, we label it as a 'function'. If it was already bound and</span>
        <span class="s6"># that is rebound later, we assume that it will be an instance</span>
        <span class="s6"># method and try an cope with the possibility that the 'self'</span>
        <span class="s6"># argument it being passed as an explicit argument and shuffle</span>
        <span class="s6"># the arguments around to extract 'self' for use as the instance.</span>

        <span class="s0">if </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">, </span><span class="s1">classmethod</span><span class="s2">):</span>
            <span class="s1">binding </span><span class="s2">= </span><span class="s5">'classmethod'</span>

        <span class="s0">elif </span><span class="s1">isinstance</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">, </span><span class="s1">staticmethod</span><span class="s2">):</span>
            <span class="s1">binding </span><span class="s2">= </span><span class="s5">'staticmethod'</span>

        <span class="s0">elif </span><span class="s1">hasattr</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">, </span><span class="s5">'__self__'</span><span class="s2">):</span>
            <span class="s0">if </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">isclass</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">.</span><span class="s1">__self__</span><span class="s2">):</span>
                <span class="s1">binding </span><span class="s2">= </span><span class="s5">'classmethod'</span>
            <span class="s0">else</span><span class="s2">:</span>
                <span class="s1">binding </span><span class="s2">= </span><span class="s5">'function'</span>

        <span class="s0">else</span><span class="s2">:</span>
            <span class="s1">binding </span><span class="s2">= </span><span class="s5">'function'</span>

        <span class="s1">super</span><span class="s2">(</span><span class="s1">FunctionWrapper</span><span class="s2">, </span><span class="s1">self</span><span class="s2">).</span><span class="s1">__init__</span><span class="s2">(</span><span class="s1">wrapped</span><span class="s2">, </span><span class="s0">None</span><span class="s2">, </span><span class="s1">wrapper</span><span class="s2">,</span>
                <span class="s1">enabled</span><span class="s2">, </span><span class="s1">binding</span><span class="s2">)</span>
</pre>
</body>
</html>