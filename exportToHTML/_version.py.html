<html>
<head>
<title>_version.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #5f826b; font-style: italic;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
_version.py</font>
</center></td></tr></table>
<pre><span class="s0"># This file helps to compute a version number in source trees obtained from</span>
<span class="s0"># git-archive tarball (such as those provided by githubs download-from-tag</span>
<span class="s0"># feature). Distribution tarballs (built by setup.py sdist) and build</span>
<span class="s0"># directories (produced by setup.py build) will contain a much shorter file</span>
<span class="s0"># that just contains the computed version number.</span>

<span class="s0"># This file is released into the public domain.</span>
<span class="s0"># Generated by versioneer-0.28</span>
<span class="s0"># https://github.com/python-versioneer/python-versioneer</span>

<span class="s2">&quot;&quot;&quot;Git implementation of _version.py.&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">errno</span>
<span class="s3">import </span><span class="s1">functools</span>
<span class="s3">import </span><span class="s1">os</span>
<span class="s3">import </span><span class="s1">re</span>
<span class="s3">import </span><span class="s1">subprocess</span>
<span class="s3">import </span><span class="s1">sys</span>
<span class="s3">from </span><span class="s1">typing </span><span class="s3">import </span><span class="s1">Callable</span>


<span class="s3">def </span><span class="s1">get_keywords</span><span class="s4">():</span>
    <span class="s2">&quot;&quot;&quot;Get the keywords needed to look up the version information.&quot;&quot;&quot;</span>
    <span class="s0"># these strings will be replaced by git during git-archive.</span>
    <span class="s0"># setup.py/versioneer.py will grep for the variable names, so they must</span>
    <span class="s0"># each be defined on a line of their own. _version.py will just call</span>
    <span class="s0"># get_keywords().</span>
    <span class="s1">git_refnames </span><span class="s4">= </span><span class="s5">&quot;$Format:%d$&quot;</span>
    <span class="s1">git_full </span><span class="s4">= </span><span class="s5">&quot;$Format:%H$&quot;</span>
    <span class="s1">git_date </span><span class="s4">= </span><span class="s5">&quot;$Format:%ci$&quot;</span>
    <span class="s1">keywords </span><span class="s4">= {</span><span class="s5">&quot;refnames&quot;</span><span class="s4">: </span><span class="s1">git_refnames</span><span class="s4">, </span><span class="s5">&quot;full&quot;</span><span class="s4">: </span><span class="s1">git_full</span><span class="s4">, </span><span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s1">git_date</span><span class="s4">}</span>
    <span class="s3">return </span><span class="s1">keywords</span>


<span class="s3">class </span><span class="s1">VersioneerConfig</span><span class="s4">:</span>
    <span class="s2">&quot;&quot;&quot;Container for Versioneer configuration parameters.&quot;&quot;&quot;</span>


<span class="s3">def </span><span class="s1">get_config</span><span class="s4">():</span>
    <span class="s2">&quot;&quot;&quot;Create, populate and return the VersioneerConfig() object.&quot;&quot;&quot;</span>
    <span class="s0"># these strings are filled in when 'setup.py versioneer' creates</span>
    <span class="s0"># _version.py</span>
    <span class="s1">cfg </span><span class="s4">= </span><span class="s1">VersioneerConfig</span><span class="s4">()</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">VCS </span><span class="s4">= </span><span class="s5">&quot;git&quot;</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">style </span><span class="s4">= </span><span class="s5">&quot;pep440&quot;</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">tag_prefix </span><span class="s4">= </span><span class="s5">&quot;v&quot;</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">parentdir_prefix </span><span class="s4">= </span><span class="s5">&quot;pandas-&quot;</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">versionfile_source </span><span class="s4">= </span><span class="s5">&quot;pandas/_version.py&quot;</span>
    <span class="s1">cfg</span><span class="s4">.</span><span class="s1">verbose </span><span class="s4">= </span><span class="s3">False</span>
    <span class="s3">return </span><span class="s1">cfg</span>


<span class="s3">class </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s1">Exception</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Exception raised if a method is not valid for the current scenario.&quot;&quot;&quot;</span>


<span class="s1">LONG_VERSION_PY</span><span class="s4">: </span><span class="s1">dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">str</span><span class="s4">] = {}</span>
<span class="s1">HANDLERS</span><span class="s4">: </span><span class="s1">dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">dict</span><span class="s4">[</span><span class="s1">str</span><span class="s4">, </span><span class="s1">Callable</span><span class="s4">]] = {}</span>


<span class="s3">def </span><span class="s1">register_vcs_handler</span><span class="s4">(</span><span class="s1">vcs</span><span class="s4">, </span><span class="s1">method</span><span class="s4">):  </span><span class="s0"># decorator</span>
    <span class="s2">&quot;&quot;&quot;Create decorator to mark a method as the handler of a VCS.&quot;&quot;&quot;</span>

    <span class="s3">def </span><span class="s1">decorate</span><span class="s4">(</span><span class="s1">f</span><span class="s4">):</span>
        <span class="s2">&quot;&quot;&quot;Store f in HANDLERS[vcs][method].&quot;&quot;&quot;</span>
        <span class="s3">if </span><span class="s1">vcs </span><span class="s3">not in </span><span class="s1">HANDLERS</span><span class="s4">:</span>
            <span class="s1">HANDLERS</span><span class="s4">[</span><span class="s1">vcs</span><span class="s4">] = {}</span>
        <span class="s1">HANDLERS</span><span class="s4">[</span><span class="s1">vcs</span><span class="s4">][</span><span class="s1">method</span><span class="s4">] = </span><span class="s1">f</span>
        <span class="s3">return </span><span class="s1">f</span>

    <span class="s3">return </span><span class="s1">decorate</span>


<span class="s3">def </span><span class="s1">run_command</span><span class="s4">(</span><span class="s1">commands</span><span class="s4">, </span><span class="s1">args</span><span class="s4">, </span><span class="s1">cwd</span><span class="s4">=</span><span class="s3">None</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">=</span><span class="s3">False</span><span class="s4">, </span><span class="s1">hide_stderr</span><span class="s4">=</span><span class="s3">False</span><span class="s4">, </span><span class="s1">env</span><span class="s4">=</span><span class="s3">None</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Call the given command(s).&quot;&quot;&quot;</span>
    <span class="s3">assert </span><span class="s1">isinstance</span><span class="s4">(</span><span class="s1">commands</span><span class="s4">, </span><span class="s1">list</span><span class="s4">)</span>
    <span class="s1">process </span><span class="s4">= </span><span class="s3">None</span>

    <span class="s1">popen_kwargs </span><span class="s4">= {}</span>
    <span class="s3">if </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">platform </span><span class="s4">== </span><span class="s5">&quot;win32&quot;</span><span class="s4">:</span>
        <span class="s0"># This hides the console window if pythonw.exe is used</span>
        <span class="s1">startupinfo </span><span class="s4">= </span><span class="s1">subprocess</span><span class="s4">.</span><span class="s1">STARTUPINFO</span><span class="s4">()</span>
        <span class="s1">startupinfo</span><span class="s4">.</span><span class="s1">dwFlags </span><span class="s4">|= </span><span class="s1">subprocess</span><span class="s4">.</span><span class="s1">STARTF_USESHOWWINDOW</span>
        <span class="s1">popen_kwargs</span><span class="s4">[</span><span class="s5">&quot;startupinfo&quot;</span><span class="s4">] = </span><span class="s1">startupinfo</span>

    <span class="s3">for </span><span class="s1">command </span><span class="s3">in </span><span class="s1">commands</span><span class="s4">:</span>
        <span class="s1">dispcmd </span><span class="s4">= </span><span class="s1">str</span><span class="s4">([</span><span class="s1">command</span><span class="s4">] + </span><span class="s1">args</span><span class="s4">)</span>
        <span class="s3">try</span><span class="s4">:</span>
            <span class="s0"># remember shell=False, so use git.cmd on windows, not just git</span>
            <span class="s1">process </span><span class="s4">= </span><span class="s1">subprocess</span><span class="s4">.</span><span class="s1">Popen</span><span class="s4">(</span>
                <span class="s4">[</span><span class="s1">command</span><span class="s4">] + </span><span class="s1">args</span><span class="s4">,</span>
                <span class="s1">cwd</span><span class="s4">=</span><span class="s1">cwd</span><span class="s4">,</span>
                <span class="s1">env</span><span class="s4">=</span><span class="s1">env</span><span class="s4">,</span>
                <span class="s1">stdout</span><span class="s4">=</span><span class="s1">subprocess</span><span class="s4">.</span><span class="s1">PIPE</span><span class="s4">,</span>
                <span class="s1">stderr</span><span class="s4">=(</span><span class="s1">subprocess</span><span class="s4">.</span><span class="s1">PIPE </span><span class="s3">if </span><span class="s1">hide_stderr </span><span class="s3">else None</span><span class="s4">),</span>
                <span class="s4">**</span><span class="s1">popen_kwargs</span><span class="s4">,</span>
            <span class="s4">)</span>
            <span class="s3">break</span>
        <span class="s3">except </span><span class="s1">OSError</span><span class="s4">:</span>
            <span class="s1">e </span><span class="s4">= </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">exc_info</span><span class="s4">()[</span><span class="s6">1</span><span class="s4">]</span>
            <span class="s3">if </span><span class="s1">e</span><span class="s4">.</span><span class="s1">errno </span><span class="s4">== </span><span class="s1">errno</span><span class="s4">.</span><span class="s1">ENOENT</span><span class="s4">:</span>
                <span class="s3">continue</span>
            <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
                <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;unable to run </span><span class="s3">{</span><span class="s1">dispcmd</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>
                <span class="s1">print</span><span class="s4">(</span><span class="s1">e</span><span class="s4">)</span>
            <span class="s3">return None</span><span class="s4">, </span><span class="s3">None</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;unable to find command, tried </span><span class="s3">{</span><span class="s1">commands</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>
        <span class="s3">return None</span><span class="s4">, </span><span class="s3">None</span>
    <span class="s1">stdout </span><span class="s4">= </span><span class="s1">process</span><span class="s4">.</span><span class="s1">communicate</span><span class="s4">()[</span><span class="s6">0</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">decode</span><span class="s4">()</span>
    <span class="s3">if </span><span class="s1">process</span><span class="s4">.</span><span class="s1">returncode </span><span class="s4">!= </span><span class="s6">0</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;unable to run </span><span class="s3">{</span><span class="s1">dispcmd</span><span class="s3">} </span><span class="s5">(error)&quot;</span><span class="s4">)</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;stdout was </span><span class="s3">{</span><span class="s1">stdout</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>
        <span class="s3">return None</span><span class="s4">, </span><span class="s1">process</span><span class="s4">.</span><span class="s1">returncode</span>
    <span class="s3">return </span><span class="s1">stdout</span><span class="s4">, </span><span class="s1">process</span><span class="s4">.</span><span class="s1">returncode</span>


<span class="s3">def </span><span class="s1">versions_from_parentdir</span><span class="s4">(</span><span class="s1">parentdir_prefix</span><span class="s4">, </span><span class="s1">root</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Try to determine the version from the parent directory name. 
 
    Source tarballs conventionally unpack into a directory that includes both 
    the project name and a version string. We will also support searching up 
    two directory levels for an appropriately named parent directory 
    &quot;&quot;&quot;</span>
    <span class="s1">rootdirs </span><span class="s4">= []</span>

    <span class="s3">for </span><span class="s1">_ </span><span class="s3">in </span><span class="s1">range</span><span class="s4">(</span><span class="s6">3</span><span class="s4">):</span>
        <span class="s1">dirname </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">basename</span><span class="s4">(</span><span class="s1">root</span><span class="s4">)</span>
        <span class="s3">if </span><span class="s1">dirname</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s1">parentdir_prefix</span><span class="s4">):</span>
            <span class="s3">return </span><span class="s4">{</span>
                <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s1">dirname</span><span class="s4">[</span><span class="s1">len</span><span class="s4">(</span><span class="s1">parentdir_prefix</span><span class="s4">) :],</span>
                <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
                <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">False</span><span class="s4">,</span>
                <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
                <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s4">}</span>
        <span class="s1">rootdirs</span><span class="s4">.</span><span class="s1">append</span><span class="s4">(</span><span class="s1">root</span><span class="s4">)</span>
        <span class="s1">root </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">dirname</span><span class="s4">(</span><span class="s1">root</span><span class="s4">)  </span><span class="s0"># up a level</span>

    <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
        <span class="s1">print</span><span class="s4">(</span>
            <span class="s5">f&quot;Tried directories </span><span class="s3">{</span><span class="s1">str</span><span class="s4">(</span><span class="s1">rootdirs</span><span class="s4">)</span><span class="s3">} \ 
            </span><span class="s5">but none started with prefix </span><span class="s3">{</span><span class="s1">parentdir_prefix</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s4">)</span>
    <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;rootdir doesn't start with parentdir_prefix&quot;</span><span class="s4">)</span>


<span class="s4">@</span><span class="s1">register_vcs_handler</span><span class="s4">(</span><span class="s5">&quot;git&quot;</span><span class="s4">, </span><span class="s5">&quot;get_keywords&quot;</span><span class="s4">)</span>
<span class="s3">def </span><span class="s1">git_get_keywords</span><span class="s4">(</span><span class="s1">versionfile_abs</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Extract version information from the given file.&quot;&quot;&quot;</span>
    <span class="s0"># the code embedded in _version.py can just fetch the value of these</span>
    <span class="s0"># keywords. When used from setup.py, we don't want to import _version.py,</span>
    <span class="s0"># so we do it with a regexp instead. This function is not used from</span>
    <span class="s0"># _version.py.</span>
    <span class="s1">keywords </span><span class="s4">= {}</span>
    <span class="s3">try</span><span class="s4">:</span>
        <span class="s3">with </span><span class="s1">open</span><span class="s4">(</span><span class="s1">versionfile_abs</span><span class="s4">, </span><span class="s1">encoding</span><span class="s4">=</span><span class="s5">&quot;utf-8&quot;</span><span class="s4">) </span><span class="s3">as </span><span class="s1">fobj</span><span class="s4">:</span>
            <span class="s3">for </span><span class="s1">line </span><span class="s3">in </span><span class="s1">fobj</span><span class="s4">:</span>
                <span class="s3">if </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">startswith</span><span class="s4">(</span><span class="s5">&quot;git_refnames =&quot;</span><span class="s4">):</span>
                    <span class="s1">mo </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s5">r'=\s*&quot;(.*)&quot;'</span><span class="s4">, </span><span class="s1">line</span><span class="s4">)</span>
                    <span class="s3">if </span><span class="s1">mo</span><span class="s4">:</span>
                        <span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;refnames&quot;</span><span class="s4">] = </span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">1</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">startswith</span><span class="s4">(</span><span class="s5">&quot;git_full =&quot;</span><span class="s4">):</span>
                    <span class="s1">mo </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s5">r'=\s*&quot;(.*)&quot;'</span><span class="s4">, </span><span class="s1">line</span><span class="s4">)</span>
                    <span class="s3">if </span><span class="s1">mo</span><span class="s4">:</span>
                        <span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;full&quot;</span><span class="s4">] = </span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">1</span><span class="s4">)</span>
                <span class="s3">if </span><span class="s1">line</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">startswith</span><span class="s4">(</span><span class="s5">&quot;git_date =&quot;</span><span class="s4">):</span>
                    <span class="s1">mo </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s5">r'=\s*&quot;(.*)&quot;'</span><span class="s4">, </span><span class="s1">line</span><span class="s4">)</span>
                    <span class="s3">if </span><span class="s1">mo</span><span class="s4">:</span>
                        <span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;date&quot;</span><span class="s4">] = </span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">1</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">OSError</span><span class="s4">:</span>
        <span class="s3">pass</span>
    <span class="s3">return </span><span class="s1">keywords</span>


<span class="s4">@</span><span class="s1">register_vcs_handler</span><span class="s4">(</span><span class="s5">&quot;git&quot;</span><span class="s4">, </span><span class="s5">&quot;keywords&quot;</span><span class="s4">)</span>
<span class="s3">def </span><span class="s1">git_versions_from_keywords</span><span class="s4">(</span><span class="s1">keywords</span><span class="s4">, </span><span class="s1">tag_prefix</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Get version information from git keywords.&quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s5">&quot;refnames&quot; </span><span class="s3">not in </span><span class="s1">keywords</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;Short version file found&quot;</span><span class="s4">)</span>
    <span class="s1">date </span><span class="s4">= </span><span class="s1">keywords</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;date&quot;</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">date </span><span class="s3">is not None</span><span class="s4">:</span>
        <span class="s0"># Use only the last line.  Previous lines may contain GPG signature</span>
        <span class="s0"># information.</span>
        <span class="s1">date </span><span class="s4">= </span><span class="s1">date</span><span class="s4">.</span><span class="s1">splitlines</span><span class="s4">()[-</span><span class="s6">1</span><span class="s4">]</span>

        <span class="s0"># git-2.2.0 added &quot;%cI&quot;, which expands to an ISO-8601 -compliant</span>
        <span class="s0"># datestamp. However we prefer &quot;%ci&quot; (which expands to an &quot;ISO-8601</span>
        <span class="s0"># -like&quot; string, which we must then edit to make compliant), because</span>
        <span class="s0"># it's been around since git-1.5.3, and it's too difficult to</span>
        <span class="s0"># discover which version we're using, or to work around using an</span>
        <span class="s0"># older one.</span>
        <span class="s1">date </span><span class="s4">= </span><span class="s1">date</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">replace</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s5">&quot;T&quot;</span><span class="s4">, </span><span class="s6">1</span><span class="s4">).</span><span class="s1">replace</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s6">1</span><span class="s4">)</span>
    <span class="s1">refnames </span><span class="s4">= </span><span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;refnames&quot;</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">()</span>
    <span class="s3">if </span><span class="s1">refnames</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s5">&quot;$Format&quot;</span><span class="s4">):</span>
        <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">&quot;keywords are unexpanded, not using&quot;</span><span class="s4">)</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;unexpanded keywords, not a git-archive tarball&quot;</span><span class="s4">)</span>
    <span class="s1">refs </span><span class="s4">= {</span><span class="s1">r</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">() </span><span class="s3">for </span><span class="s1">r </span><span class="s3">in </span><span class="s1">refnames</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">(</span><span class="s5">&quot;()&quot;</span><span class="s4">).</span><span class="s1">split</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span>
    <span class="s0"># starting in git-1.8.3, tags are listed as &quot;tag: foo-1.0&quot; instead of</span>
    <span class="s0"># just &quot;foo-1.0&quot;. If we see a &quot;tag: &quot; prefix, prefer those.</span>
    <span class="s1">TAG </span><span class="s4">= </span><span class="s5">&quot;tag: &quot;</span>
    <span class="s1">tags </span><span class="s4">= {</span><span class="s1">r</span><span class="s4">[</span><span class="s1">len</span><span class="s4">(</span><span class="s1">TAG</span><span class="s4">) :] </span><span class="s3">for </span><span class="s1">r </span><span class="s3">in </span><span class="s1">refs </span><span class="s3">if </span><span class="s1">r</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s1">TAG</span><span class="s4">)}</span>
    <span class="s3">if not </span><span class="s1">tags</span><span class="s4">:</span>
        <span class="s0"># Either we're using git &lt; 1.8.3, or there really are no tags. We use</span>
        <span class="s0"># a heuristic: assume all version tags have a digit. The old git %d</span>
        <span class="s0"># expansion behaves like git log --decorate=short and strips out the</span>
        <span class="s0"># refs/heads/ and refs/tags/ prefixes that would let us distinguish</span>
        <span class="s0"># between branches and tags. By ignoring refnames without digits, we</span>
        <span class="s0"># filter out many common branch names like &quot;release&quot; and</span>
        <span class="s0"># &quot;stabilization&quot;, as well as &quot;HEAD&quot; and &quot;master&quot;.</span>
        <span class="s1">tags </span><span class="s4">= {</span><span class="s1">r </span><span class="s3">for </span><span class="s1">r </span><span class="s3">in </span><span class="s1">refs </span><span class="s3">if </span><span class="s1">re</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s5">r&quot;\d&quot;</span><span class="s4">, </span><span class="s1">r</span><span class="s4">)}</span>
        <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;discarding '</span><span class="s3">{</span><span class="s5">','</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">refs </span><span class="s4">- </span><span class="s1">tags</span><span class="s4">)</span><span class="s3">}</span><span class="s5">', no digits&quot;</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
        <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;likely tags: </span><span class="s3">{</span><span class="s5">','</span><span class="s4">.</span><span class="s1">join</span><span class="s4">(</span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">tags</span><span class="s4">))</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>
    <span class="s3">for </span><span class="s1">ref </span><span class="s3">in </span><span class="s1">sorted</span><span class="s4">(</span><span class="s1">tags</span><span class="s4">):</span>
        <span class="s0"># sorting will prefer e.g. &quot;2.0&quot; over &quot;2.0rc1&quot;</span>
        <span class="s3">if </span><span class="s1">ref</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s1">tag_prefix</span><span class="s4">):</span>
            <span class="s1">r </span><span class="s4">= </span><span class="s1">ref</span><span class="s4">[</span><span class="s1">len</span><span class="s4">(</span><span class="s1">tag_prefix</span><span class="s4">) :]</span>
            <span class="s0"># Filter out refs that exactly match prefix or that don't start</span>
            <span class="s0"># with a number once the prefix is stripped (mostly a concern</span>
            <span class="s0"># when prefix is '')</span>
            <span class="s3">if not </span><span class="s1">re</span><span class="s4">.</span><span class="s1">match</span><span class="s4">(</span><span class="s5">r&quot;\d&quot;</span><span class="s4">, </span><span class="s1">r</span><span class="s4">):</span>
                <span class="s3">continue</span>
            <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
                <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;picking </span><span class="s3">{</span><span class="s1">r</span><span class="s3">}</span><span class="s5">&quot;</span><span class="s4">)</span>
            <span class="s3">return </span><span class="s4">{</span>
                <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s1">r</span><span class="s4">,</span>
                <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;full&quot;</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">(),</span>
                <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">False</span><span class="s4">,</span>
                <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
                <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s1">date</span><span class="s4">,</span>
            <span class="s4">}</span>
    <span class="s0"># no suitable tags, so version is &quot;0+unknown&quot;, but full hex is still there</span>
    <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
        <span class="s1">print</span><span class="s4">(</span><span class="s5">&quot;no suitable tags, using unknown + full revision id&quot;</span><span class="s4">)</span>
    <span class="s3">return </span><span class="s4">{</span>
        <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s5">&quot;0+unknown&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s1">keywords</span><span class="s4">[</span><span class="s5">&quot;full&quot;</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">(),</span>
        <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">False</span><span class="s4">,</span>
        <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s5">&quot;no suitable tags&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">}</span>


<span class="s4">@</span><span class="s1">register_vcs_handler</span><span class="s4">(</span><span class="s5">&quot;git&quot;</span><span class="s4">, </span><span class="s5">&quot;pieces_from_vcs&quot;</span><span class="s4">)</span>
<span class="s3">def </span><span class="s1">git_pieces_from_vcs</span><span class="s4">(</span><span class="s1">tag_prefix</span><span class="s4">, </span><span class="s1">root</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">, </span><span class="s1">runner</span><span class="s4">=</span><span class="s1">run_command</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Get version from 'git describe' in the root of the source tree. 
 
    This only gets called if the git-archive 'subst' keywords were *not* 
    expanded, and _version.py hasn't already been rewritten with a short 
    version string, meaning we're inside a checked out source tree. 
    &quot;&quot;&quot;</span>
    <span class="s1">GITS </span><span class="s4">= [</span><span class="s5">&quot;git&quot;</span><span class="s4">]</span>
    <span class="s3">if </span><span class="s1">sys</span><span class="s4">.</span><span class="s1">platform </span><span class="s4">== </span><span class="s5">&quot;win32&quot;</span><span class="s4">:</span>
        <span class="s1">GITS </span><span class="s4">= [</span><span class="s5">&quot;git.cmd&quot;</span><span class="s4">, </span><span class="s5">&quot;git.exe&quot;</span><span class="s4">]</span>

    <span class="s0"># GIT_DIR can interfere with correct operation of Versioneer.</span>
    <span class="s0"># It may be intended to be passed to the Versioneer-versioned project,</span>
    <span class="s0"># but that should not change where we get our version from.</span>
    <span class="s1">env </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">environ</span><span class="s4">.</span><span class="s1">copy</span><span class="s4">()</span>
    <span class="s1">env</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">(</span><span class="s5">&quot;GIT_DIR&quot;</span><span class="s4">, </span><span class="s3">None</span><span class="s4">)</span>
    <span class="s1">runner </span><span class="s4">= </span><span class="s1">functools</span><span class="s4">.</span><span class="s1">partial</span><span class="s4">(</span><span class="s1">runner</span><span class="s4">, </span><span class="s1">env</span><span class="s4">=</span><span class="s1">env</span><span class="s4">)</span>

    <span class="s1">_</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;rev-parse&quot;</span><span class="s4">, </span><span class="s5">&quot;--git-dir&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">, </span><span class="s1">hide_stderr</span><span class="s4">=</span><span class="s3">not </span><span class="s1">verbose</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">rc </span><span class="s4">!= </span><span class="s6">0</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
            <span class="s1">print</span><span class="s4">(</span><span class="s5">f&quot;Directory </span><span class="s3">{</span><span class="s1">root</span><span class="s3">} </span><span class="s5">not under git control&quot;</span><span class="s4">)</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;'git rev-parse --git-dir' returned error&quot;</span><span class="s4">)</span>

    <span class="s0"># if there is a tag matching tag_prefix, this yields TAG-NUM-gHEX[-dirty]</span>
    <span class="s0"># if there isn't one, this yields HEX[-dirty] (no NUM)</span>
    <span class="s1">describe_out</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span>
        <span class="s1">GITS</span><span class="s4">,</span>
        <span class="s4">[</span>
            <span class="s5">&quot;describe&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;--tags&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;--dirty&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;--always&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;--long&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;--match&quot;</span><span class="s4">,</span>
            <span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">tag_prefix</span><span class="s3">}</span><span class="s5">[[:digit:]]*&quot;</span><span class="s4">,</span>
        <span class="s4">],</span>
        <span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">,</span>
    <span class="s4">)</span>
    <span class="s0"># --long was added in git-1.5.5</span>
    <span class="s3">if </span><span class="s1">describe_out </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;'git describe' failed&quot;</span><span class="s4">)</span>
    <span class="s1">describe_out </span><span class="s4">= </span><span class="s1">describe_out</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">()</span>
    <span class="s1">full_out</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;rev-parse&quot;</span><span class="s4">, </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">)</span>
    <span class="s3">if </span><span class="s1">full_out </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;'git rev-parse' failed&quot;</span><span class="s4">)</span>
    <span class="s1">full_out </span><span class="s4">= </span><span class="s1">full_out</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">()</span>

    <span class="s1">pieces </span><span class="s4">= {}</span>
    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;long&quot;</span><span class="s4">] = </span><span class="s1">full_out</span>
    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;short&quot;</span><span class="s4">] = </span><span class="s1">full_out</span><span class="s4">[:</span><span class="s6">7</span><span class="s4">]  </span><span class="s0"># maybe improved later</span>
    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;error&quot;</span><span class="s4">] = </span><span class="s3">None</span>

    <span class="s1">branch_name</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;rev-parse&quot;</span><span class="s4">, </span><span class="s5">&quot;--abbrev-ref&quot;</span><span class="s4">, </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">)</span>
    <span class="s0"># --abbrev-ref was added in git-1.6.3</span>
    <span class="s3">if </span><span class="s1">rc </span><span class="s4">!= </span><span class="s6">0 </span><span class="s3">or </span><span class="s1">branch_name </span><span class="s3">is None</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;'git rev-parse --abbrev-ref' returned error&quot;</span><span class="s4">)</span>
    <span class="s1">branch_name </span><span class="s4">= </span><span class="s1">branch_name</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">()</span>

    <span class="s3">if </span><span class="s1">branch_name </span><span class="s4">== </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">:</span>
        <span class="s0"># If we aren't exactly on a branch, pick a branch which represents</span>
        <span class="s0"># the current commit. If all else fails, we are on a branchless</span>
        <span class="s0"># commit.</span>
        <span class="s1">branches</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;branch&quot;</span><span class="s4">, </span><span class="s5">&quot;--contains&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">)</span>
        <span class="s0"># --contains was added in git-1.5.4</span>
        <span class="s3">if </span><span class="s1">rc </span><span class="s4">!= </span><span class="s6">0 </span><span class="s3">or </span><span class="s1">branches </span><span class="s3">is None</span><span class="s4">:</span>
            <span class="s3">raise </span><span class="s1">NotThisMethod</span><span class="s4">(</span><span class="s5">&quot;'git branch --contains' returned error&quot;</span><span class="s4">)</span>
        <span class="s1">branches </span><span class="s4">= </span><span class="s1">branches</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">)</span>

        <span class="s0"># Remove the first line if we're running detached</span>
        <span class="s3">if </span><span class="s5">&quot;(&quot; </span><span class="s3">in </span><span class="s1">branches</span><span class="s4">[</span><span class="s6">0</span><span class="s4">]:</span>
            <span class="s1">branches</span><span class="s4">.</span><span class="s1">pop</span><span class="s4">(</span><span class="s6">0</span><span class="s4">)</span>

        <span class="s0"># Strip off the leading &quot;* &quot; from the list of branches.</span>
        <span class="s1">branches </span><span class="s4">= [</span><span class="s1">branch</span><span class="s4">[</span><span class="s6">2</span><span class="s4">:] </span><span class="s3">for </span><span class="s1">branch </span><span class="s3">in </span><span class="s1">branches</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s5">&quot;master&quot; </span><span class="s3">in </span><span class="s1">branches</span><span class="s4">:</span>
            <span class="s1">branch_name </span><span class="s4">= </span><span class="s5">&quot;master&quot;</span>
        <span class="s3">elif not </span><span class="s1">branches</span><span class="s4">:</span>
            <span class="s1">branch_name </span><span class="s4">= </span><span class="s3">None</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s0"># Pick the first branch that is returned. Good or bad.</span>
            <span class="s1">branch_name </span><span class="s4">= </span><span class="s1">branches</span><span class="s4">[</span><span class="s6">0</span><span class="s4">]</span>

    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;branch&quot;</span><span class="s4">] = </span><span class="s1">branch_name</span>

    <span class="s0"># parse describe_out. It will be like TAG-NUM-gHEX[-dirty] or HEX[-dirty]</span>
    <span class="s0"># TAG might have hyphens.</span>
    <span class="s1">git_describe </span><span class="s4">= </span><span class="s1">describe_out</span>

    <span class="s0"># look for -dirty suffix</span>
    <span class="s1">dirty </span><span class="s4">= </span><span class="s1">git_describe</span><span class="s4">.</span><span class="s1">endswith</span><span class="s4">(</span><span class="s5">&quot;-dirty&quot;</span><span class="s4">)</span>
    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">] = </span><span class="s1">dirty</span>
    <span class="s3">if </span><span class="s1">dirty</span><span class="s4">:</span>
        <span class="s1">git_describe </span><span class="s4">= </span><span class="s1">git_describe</span><span class="s4">[: </span><span class="s1">git_describe</span><span class="s4">.</span><span class="s1">rindex</span><span class="s4">(</span><span class="s5">&quot;-dirty&quot;</span><span class="s4">)]</span>

    <span class="s0"># now we have TAG-NUM-gHEX or HEX</span>

    <span class="s3">if </span><span class="s5">&quot;-&quot; </span><span class="s3">in </span><span class="s1">git_describe</span><span class="s4">:</span>
        <span class="s0"># TAG-NUM-gHEX</span>
        <span class="s1">mo </span><span class="s4">= </span><span class="s1">re</span><span class="s4">.</span><span class="s1">search</span><span class="s4">(</span><span class="s5">r&quot;^(.+)-(\d+)-g([0-9a-f]+)$&quot;</span><span class="s4">, </span><span class="s1">git_describe</span><span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">mo</span><span class="s4">:</span>
            <span class="s0"># unparsable. Maybe git-describe is misbehaving?</span>
            <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;error&quot;</span><span class="s4">] = </span><span class="s5">f&quot;unable to parse git-describe output: '</span><span class="s3">{</span><span class="s1">describe_out</span><span class="s3">}</span><span class="s5">'&quot;</span>
            <span class="s3">return </span><span class="s1">pieces</span>

        <span class="s0"># tag</span>
        <span class="s1">full_tag </span><span class="s4">= </span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">1</span><span class="s4">)</span>
        <span class="s3">if not </span><span class="s1">full_tag</span><span class="s4">.</span><span class="s1">startswith</span><span class="s4">(</span><span class="s1">tag_prefix</span><span class="s4">):</span>
            <span class="s3">if </span><span class="s1">verbose</span><span class="s4">:</span>
                <span class="s1">fmt </span><span class="s4">= </span><span class="s5">&quot;tag '%s' doesn't start with prefix '%s'&quot;</span>
                <span class="s1">print</span><span class="s4">(</span><span class="s1">fmt </span><span class="s4">% (</span><span class="s1">full_tag</span><span class="s4">, </span><span class="s1">tag_prefix</span><span class="s4">))</span>
            <span class="s1">pieces</span><span class="s4">[</span>
                <span class="s5">&quot;error&quot;</span>
            <span class="s4">] = </span><span class="s5">f&quot;tag '</span><span class="s3">{</span><span class="s1">full_tag</span><span class="s3">}</span><span class="s5">' doesn't start with prefix '</span><span class="s3">{</span><span class="s1">tag_prefix</span><span class="s3">}</span><span class="s5">'&quot;</span>
            <span class="s3">return </span><span class="s1">pieces</span>
        <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">] = </span><span class="s1">full_tag</span><span class="s4">[</span><span class="s1">len</span><span class="s4">(</span><span class="s1">tag_prefix</span><span class="s4">) :]</span>

        <span class="s0"># distance: number of commits since tag</span>
        <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] = </span><span class="s1">int</span><span class="s4">(</span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">2</span><span class="s4">))</span>

        <span class="s0"># commit: short hex revision ID</span>
        <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;short&quot;</span><span class="s4">] = </span><span class="s1">mo</span><span class="s4">.</span><span class="s1">group</span><span class="s4">(</span><span class="s6">3</span><span class="s4">)</span>

    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># HEX: no tags</span>
        <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">] = </span><span class="s3">None</span>
        <span class="s1">out</span><span class="s4">, </span><span class="s1">rc </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;rev-list&quot;</span><span class="s4">, </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">, </span><span class="s5">&quot;--left-right&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">)</span>
        <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] = </span><span class="s1">len</span><span class="s4">(</span><span class="s1">out</span><span class="s4">.</span><span class="s1">split</span><span class="s4">())  </span><span class="s0"># total number of commits</span>

    <span class="s0"># commit date: see ISO-8601 comment in git_versions_from_keywords()</span>
    <span class="s1">date </span><span class="s4">= </span><span class="s1">runner</span><span class="s4">(</span><span class="s1">GITS</span><span class="s4">, [</span><span class="s5">&quot;show&quot;</span><span class="s4">, </span><span class="s5">&quot;-s&quot;</span><span class="s4">, </span><span class="s5">&quot;--format=%ci&quot;</span><span class="s4">, </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">], </span><span class="s1">cwd</span><span class="s4">=</span><span class="s1">root</span><span class="s4">)[</span><span class="s6">0</span><span class="s4">].</span><span class="s1">strip</span><span class="s4">()</span>
    <span class="s0"># Use only the last line.  Previous lines may contain GPG signature</span>
    <span class="s0"># information.</span>
    <span class="s1">date </span><span class="s4">= </span><span class="s1">date</span><span class="s4">.</span><span class="s1">splitlines</span><span class="s4">()[-</span><span class="s6">1</span><span class="s4">]</span>
    <span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;date&quot;</span><span class="s4">] = </span><span class="s1">date</span><span class="s4">.</span><span class="s1">strip</span><span class="s4">().</span><span class="s1">replace</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s5">&quot;T&quot;</span><span class="s4">, </span><span class="s6">1</span><span class="s4">).</span><span class="s1">replace</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s6">1</span><span class="s4">)</span>

    <span class="s3">return </span><span class="s1">pieces</span>


<span class="s3">def </span><span class="s1">plus_or_dot</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">) </span><span class="s1">-&gt; str</span><span class="s4">:</span>
    <span class="s2">&quot;&quot;&quot;Return a + if we don't already have one, else return a .&quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s5">&quot;+&quot; </span><span class="s3">in </span><span class="s1">pieces</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">):</span>
        <span class="s3">return </span><span class="s5">&quot;.&quot;</span>
    <span class="s3">return </span><span class="s5">&quot;+&quot;</span>


<span class="s3">def </span><span class="s1">render_pep440</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Build up version string, with post-release &quot;local version identifier&quot;. 
 
    Our goal: TAG[+DISTANCE.gHEX[.dirty]] . Note that if you 
    get a tagged build and then dirty it, you'll get TAG+0.gHEX.dirty 
 
    Exceptions: 
    1: no tags. git_describe was just HEX. 0+untagged.DISTANCE.gHEX[.dirty] 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] </span><span class="s3">or </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s1">plus_or_dot</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">.g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">f&quot;0+untagged.</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">.g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_pep440_branch</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[[.dev0]+DISTANCE.gHEX[.dirty]] . 
 
    The &quot;.dev0&quot; means not master branch. Note that .dev0 sorts backwards 
    (a feature branch will appear &quot;older&quot; than the master branch). 
 
    Exceptions: 
    1: no tags. 0[.dev0]+untagged.DISTANCE.gHEX[.dirty] 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] </span><span class="s3">or </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;branch&quot;</span><span class="s4">] != </span><span class="s5">&quot;master&quot;</span><span class="s4">:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s1">plus_or_dot</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">.g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">&quot;0&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;branch&quot;</span><span class="s4">] != </span><span class="s5">&quot;master&quot;</span><span class="s4">:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;+untagged.</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">.g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">pep440_split_post</span><span class="s4">(</span><span class="s1">ver</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Split pep440 version string at the post-release segment. 
 
    Returns the release segments before the post-release and the 
    post-release version number (or -1 if no post-release segment is present). 
    &quot;&quot;&quot;</span>
    <span class="s1">vc </span><span class="s4">= </span><span class="s1">str</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s1">ver</span><span class="s4">, </span><span class="s5">&quot;.post&quot;</span><span class="s4">)</span>
    <span class="s3">return </span><span class="s1">vc</span><span class="s4">[</span><span class="s6">0</span><span class="s4">], </span><span class="s1">int</span><span class="s4">(</span><span class="s1">vc</span><span class="s4">[</span><span class="s6">1</span><span class="s4">] </span><span class="s3">or </span><span class="s6">0</span><span class="s4">) </span><span class="s3">if </span><span class="s1">len</span><span class="s4">(</span><span class="s1">vc</span><span class="s4">) == </span><span class="s6">2 </span><span class="s3">else None</span>


<span class="s3">def </span><span class="s1">render_pep440_pre</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[.postN.devDISTANCE] -- No -dirty. 
 
    Exceptions: 
    1: no tags. 0.post0.devDISTANCE 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">]:</span>
            <span class="s0"># update the post release segment</span>
            <span class="s1">tag_version</span><span class="s4">, </span><span class="s1">post_version </span><span class="s4">= </span><span class="s1">pep440_split_post</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">])</span>
            <span class="s1">rendered </span><span class="s4">= </span><span class="s1">tag_version</span>
            <span class="s3">if </span><span class="s1">post_version </span><span class="s3">is not None</span><span class="s4">:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;.post</span><span class="s3">{</span><span class="s1">post_version </span><span class="s4">+ </span><span class="s6">1</span><span class="s3">}</span><span class="s5">.dev</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">else</span><span class="s4">:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;.post0.dev</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">else</span><span class="s4">:</span>
            <span class="s0"># no commits, use the tag as the version</span>
            <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">f&quot;0.post0.dev</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_pep440_post</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[.postDISTANCE[.dev0]+gHEX] . 
 
    The &quot;.dev0&quot; means dirty. Note that .dev0 sorts backwards 
    (a dirty tree will appear &quot;older&quot; than the corresponding clean one), 
    but you shouldn't be releasing software with -dirty anyways. 
 
    Exceptions: 
    1: no tags. 0.postDISTANCE[.dev0] 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] </span><span class="s3">or </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s1">plus_or_dot</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">f&quot;0.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;+g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_pep440_post_branch</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[.postDISTANCE[.dev0]+gHEX[.dirty]] . 
 
    The &quot;.dev0&quot; means not master branch. 
 
    Exceptions: 
    1: no tags. 0.postDISTANCE[.dev0]+gHEX[.dirty] 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] </span><span class="s3">or </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;branch&quot;</span><span class="s4">] != </span><span class="s5">&quot;master&quot;</span><span class="s4">:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s1">plus_or_dot</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">f&quot;0.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;branch&quot;</span><span class="s4">] != </span><span class="s5">&quot;master&quot;</span><span class="s4">:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;+g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dirty&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_pep440_old</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[.postDISTANCE[.dev0]] . 
 
    The &quot;.dev0&quot; means dirty. 
 
    Exceptions: 
    1: no tags. 0.postDISTANCE[.dev0] 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">] </span><span class="s3">or </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;0.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
            <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
                <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s5">f&quot;0.post</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;.dev0&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_git_describe</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG[-DISTANCE-gHEX][-dirty]. 
 
    Like 'git describe --tags --dirty --always'. 
 
    Exceptions: 
    1: no tags. HEX[-dirty]  (note: no 'g' prefix) 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;distance&quot;</span><span class="s4">]:</span>
            <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;-</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">-g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;short&quot;</span><span class="s4">]</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;-dirty&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render_git_describe_long</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;TAG-DISTANCE-gHEX[-dirty]. 
 
    Like 'git describe --tags --dirty --always -long'. 
    The distance/hash is unconditional. 
 
    Exceptions: 
    1: no tags. HEX[-dirty]  (note: no 'g' prefix) 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;closest-tag&quot;</span><span class="s4">]</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">f&quot;-</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'distance'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">-g</span><span class="s3">{</span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">'short'</span><span class="s4">]</span><span class="s3">}</span><span class="s5">&quot;</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s0"># exception #1</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;short&quot;</span><span class="s4">]</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">]:</span>
        <span class="s1">rendered </span><span class="s4">+= </span><span class="s5">&quot;-dirty&quot;</span>
    <span class="s3">return </span><span class="s1">rendered</span>


<span class="s3">def </span><span class="s1">render</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">, </span><span class="s1">style</span><span class="s4">):</span>
    <span class="s2">&quot;&quot;&quot;Render the given version pieces into the requested style.&quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;error&quot;</span><span class="s4">]:</span>
        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s5">&quot;unknown&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s1">pieces</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;long&quot;</span><span class="s4">),</span>
            <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;error&quot;</span><span class="s4">],</span>
            <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s4">}</span>

    <span class="s3">if not </span><span class="s1">style </span><span class="s3">or </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;default&quot;</span><span class="s4">:</span>
        <span class="s1">style </span><span class="s4">= </span><span class="s5">&quot;pep440&quot;  </span><span class="s0"># the default</span>

    <span class="s3">if </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440-branch&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440_branch</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440-pre&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440_pre</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440-post&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440_post</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440-post-branch&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440_post_branch</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;pep440-old&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_pep440_old</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;git-describe&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_git_describe</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">elif </span><span class="s1">style </span><span class="s4">== </span><span class="s5">&quot;git-describe-long&quot;</span><span class="s4">:</span>
        <span class="s1">rendered </span><span class="s4">= </span><span class="s1">render_git_describe_long</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">)</span>
    <span class="s3">else</span><span class="s4">:</span>
        <span class="s3">raise </span><span class="s1">ValueError</span><span class="s4">(</span><span class="s5">f&quot;unknown style '</span><span class="s3">{</span><span class="s1">style</span><span class="s3">}</span><span class="s5">'&quot;</span><span class="s4">)</span>

    <span class="s3">return </span><span class="s4">{</span>
        <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s1">rendered</span><span class="s4">,</span>
        <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;long&quot;</span><span class="s4">],</span>
        <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s1">pieces</span><span class="s4">[</span><span class="s5">&quot;dirty&quot;</span><span class="s4">],</span>
        <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s1">pieces</span><span class="s4">.</span><span class="s1">get</span><span class="s4">(</span><span class="s5">&quot;date&quot;</span><span class="s4">),</span>
    <span class="s4">}</span>


<span class="s3">def </span><span class="s1">get_versions</span><span class="s4">():</span>
    <span class="s2">&quot;&quot;&quot;Get version information or return default if unable to do so.&quot;&quot;&quot;</span>
    <span class="s0"># I am in _version.py, which lives at ROOT/VERSIONFILE_SOURCE. If we have</span>
    <span class="s0"># __file__, we can work backwards from there to the root. Some</span>
    <span class="s0"># py2exe/bbfreeze/non-CPython implementations don't do __file__, in which</span>
    <span class="s0"># case we can only use expanded keywords.</span>

    <span class="s1">cfg </span><span class="s4">= </span><span class="s1">get_config</span><span class="s4">()</span>
    <span class="s1">verbose </span><span class="s4">= </span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">verbose</span>

    <span class="s3">try</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s1">git_versions_from_keywords</span><span class="s4">(</span><span class="s1">get_keywords</span><span class="s4">(), </span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">tag_prefix</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">NotThisMethod</span><span class="s4">:</span>
        <span class="s3">pass</span>

    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">root </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">realpath</span><span class="s4">(</span><span class="s1">__file__</span><span class="s4">)</span>
        <span class="s0"># versionfile_source is the relative path from the top of the source</span>
        <span class="s0"># tree (where the .git directory might live) to this file. Invert</span>
        <span class="s0"># this to find the root from __file__.</span>
        <span class="s3">for </span><span class="s1">_ </span><span class="s3">in </span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">versionfile_source</span><span class="s4">.</span><span class="s1">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">):</span>
            <span class="s1">root </span><span class="s4">= </span><span class="s1">os</span><span class="s4">.</span><span class="s1">path</span><span class="s4">.</span><span class="s1">dirname</span><span class="s4">(</span><span class="s1">root</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">NameError</span><span class="s4">:</span>
        <span class="s3">return </span><span class="s4">{</span>
            <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s5">&quot;0+unknown&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
            <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s5">&quot;unable to find root of source tree&quot;</span><span class="s4">,</span>
            <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s4">}</span>

    <span class="s3">try</span><span class="s4">:</span>
        <span class="s1">pieces </span><span class="s4">= </span><span class="s1">git_pieces_from_vcs</span><span class="s4">(</span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">tag_prefix</span><span class="s4">, </span><span class="s1">root</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">)</span>
        <span class="s3">return </span><span class="s1">render</span><span class="s4">(</span><span class="s1">pieces</span><span class="s4">, </span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">style</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">NotThisMethod</span><span class="s4">:</span>
        <span class="s3">pass</span>

    <span class="s3">try</span><span class="s4">:</span>
        <span class="s3">if </span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">parentdir_prefix</span><span class="s4">:</span>
            <span class="s3">return </span><span class="s1">versions_from_parentdir</span><span class="s4">(</span><span class="s1">cfg</span><span class="s4">.</span><span class="s1">parentdir_prefix</span><span class="s4">, </span><span class="s1">root</span><span class="s4">, </span><span class="s1">verbose</span><span class="s4">)</span>
    <span class="s3">except </span><span class="s1">NotThisMethod</span><span class="s4">:</span>
        <span class="s3">pass</span>

    <span class="s3">return </span><span class="s4">{</span>
        <span class="s5">&quot;version&quot;</span><span class="s4">: </span><span class="s5">&quot;0+unknown&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;full-revisionid&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s5">&quot;dirty&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
        <span class="s5">&quot;error&quot;</span><span class="s4">: </span><span class="s5">&quot;unable to compute version&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;date&quot;</span><span class="s4">: </span><span class="s3">None</span><span class="s4">,</span>
    <span class="s4">}</span>
</pre>
</body>
</html>